Package: dpkg-bootstrap
Version: 1.16.3
Revision: 1
GCC: 4.0
Maintainer: Fink Core Group <fink-core@lists.sourceforge.net>

Source: mirror:debian:/pool/main/d/dpkg/dpkg_%v.tar.bz2
SourceDirectory: dpkg-%v
Source-MD5: 20189e2926ada3dda4f77ef2e36999af

PatchFile: dpkg.patch
PatchFile-MD5: e0909efaff7e0faf7f337c5128e8b565

PatchScript: <<
sed -e 's,@FINKPREFIX@,%p,g' %{PatchFile} | patch -p1

# Fix for msgmerge 0.17, this won't be required with 0.18+
perl -pi -e 's,--previous,--backup=off --previous,g' dselect/po/Makevars man/Makefile.am man/Makefile.in po/Makevars scripts/po/Makevars

# Make sure all scripts have use lib %p/lib/perl5 to find the modules it needs
perl -pi -e 's,^(\#\!/usr/bin/perl.*)$,$1\nuse lib "%p/lib/perl5";,' %b/scripts/*.pl

# fix paths
for i in %b/po/*.po %b/po/*.pot %b/doc/triggers.txt %b/man/*.[13578] %b/man/*/*.[13578]; do \
  perl -pi -e 's,/usr,%p,g' $i; \
  perl -pi -e 's,/var,%p/var,g' $i; \
  perl -pi -e 's,/etc,%p/etc,g' $i; \
  perl -pi -e 's,amd64,x86_64,g' $i; \
done 

cp scripts/t/200_Dpkg_Shlibs/objdump.basictags-amd64 scripts/t/200_Dpkg_Shlibs/objdump.basictags-x86_64

# Fink uses "x86_64" instead of "amd64"
perl -pi -e 's,amd64,x86_64,g' *table debian/archtable scripts/Makefile.in scripts/Makefile.am scripts/t/200_Dpkg_Shlibs/basictags.c scripts/t/200_Dpkg_Shlibs/basictags.symbols scripts/t/200_Dpkg_Shlibs/objdump.basictags-x86_64 scripts/t/200_Dpkg_Shlibs.t

# Fix for gnutar (Slightly modified for bootstrap version)
perl -pi -e 's,\"tar\",\"/usr/bin/gnutar\",g' dpkg-deb/build.c dpkg-deb/extract.c lib/dpkg/dpkg.h
perl -pi -e 's,--warning=no-timestamp,--quoting-style=escape,g' dpkg-deb/extract.c
<<

SetCFLAGS: -I%p/include -F/System/Library/Frameworks/CoreFoundation.framework -Wall -Wextra -Wno-unused-parameter -Wno-missing-field-initializers -Wno-cast-align -Wno-incompatible-pointer-types -Wno-format-security
SetLDFLAGS: -framework CoreFoundation

ConfigureParams: --without-sgml-doc --without-bz2 --without-zlib --disable-install-info --disable-dselect --disable-start-stop-daemon --with-admindir=%P/var/lib/dpkg --with-logdir=%P/var/log --srcdir=%b

CompileScript: <<
PERL_LIBDIR=%p/lib/perl5 PERL=/usr/bin/perl ./configure --build=%m-apple-darwin %c
/usr/bin/make
<<

InstallScript: <<
install -d -m 0755 %i/share/doc/dpkg

/usr/bin/make install DESTDIR=%d

### Just a precaution
mkdir -p %i/var/log
touch %i/var/log/alternatives.log
<<
Description: The Debian package manager (bootstrap package)
DescDetail: <<
This package provides the low-level infrastructure for handling the
installation and removal of Debian software packages.
.
For Debian package development tools, install dpkg-dev.
<<
DescPort: <<
See dpkg DescPort
<<
License: GPL
Homepage: http://packages.qa.debian.org/d/dpkg.html
