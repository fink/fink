Index: Makefile.in
===================================================================
RCS file: /cvsroot/fink/3rdparty/dpkg/Makefile.in,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -r1.1.1.2 -r1.3
--- Makefile.in	2 May 2006 17:55:47 -0000	1.1.1.2
+++ Makefile.in	2 May 2006 17:58:43 -0000	1.3
@@ -238,7 +238,6 @@
 @WITH_DSELECT_TRUE@MAYBE_DSELECT = dselect
 SUBDIRS = \
 	intl \
-	getopt \
 	lib \
 	src \
 	$(MAYBE_DSELECT) \
Index: dpkg-deb/build.c
===================================================================
RCS file: /cvsroot/fink/3rdparty/dpkg/dpkg-deb/build.c,v
retrieving revision 1.1.1.1
retrieving revision 1.5
diff -u -r1.1.1.1 -r1.5
--- dpkg-deb/build.c	17 Mar 2006 01:54:10 -0000	1.1.1.1
+++ dpkg-deb/build.c	20 Mar 2006 05:00:33 -0000	1.5
@@ -221,9 +221,13 @@
       warns++;
     }
     for (field= checkedinfo->available.arbs; field; field= field->next) {
-      fprintf(stderr, _("warning, `%s' contains user-defined field `%s'\n"),
+      /* Don't warn for fink-owned fields */
+      if (strncmp("BuildDependsOnly",field->name,16) != 0 &&
+          strncmp("Fink-",field->name,5) != 0) {
+        fprintf(stderr, _("warning, `%s' contains user-defined field `%s'\n"),
               controlfile, field->name);
-      warns++;
+        warns++;
+      }
     }
     checkversion(checkedinfo->available.version.version,"(upstream) version",&errs);
     checkversion(checkedinfo->available.version.revision,"Debian revision",&errs);
Index: fink/dpkg.info
===================================================================
RCS file: fink/dpkg.info
diff -N fink/dpkg.info
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ fink/dpkg.info	2 May 2006 18:04:58 -0000
@@ -0,0 +1,110 @@
+Package: dpkg
+Version: 1.13.16
+Revision: 1024
+GCC: 4.0
+# NOTE: Dpkg does *NOT* always build properly in unstable. It is essential, yet
+# it BuildDepends on gettext-tools which is not essential in unstable.
+# 
+# This applies to the current dpkg as well, and will only be remedied if we
+# either include gettext-tools 0.10.x in unstable, or make gettext-tools 0.14.x
+# and all its deps essential.
+BuildDepends: gettext-dev, gettext-tools, libiconv-dev
+Depends: gettext, libiconv, gzip, tar
+Essential: yes
+Maintainer: Fink Core Group <fink-core@lists.sourceforge.net>
+#Source: mirror:sourceforge:fink/dpkg_%v.tar.gz
+Source: http://debian.ethz.ch/debian/pool/main/d/%n/%n_%v.tar.gz
+SourceDirectory: dpkg-%v
+Source-MD5: bf16c7c5efe5025320c73c862ffeb1d3
+Source2: http://alioth.debian.org/download.php/1496/po4a-0.24.tar.gz
+Source2-MD5: 8f3edbc9df9a7f960d123c3dd5aa13c7
+PatchScript: <<
+	#!/bin/sh -ev
+	sed 's|@PREFIX@|%p|g' <%a/dpkg.patch | patch -p0
+	find man -type f | xargs perl -pi -e 's,/usr,%p,g; s,/var,%p/var,g; s,/etc,%p/etc,g;'
+	ls scripts/*.pl* scripts/*.sh | xargs perl -i -pe 's,([\047`"])/(etc|var),$1%p/$2,g; s,([\047`"])/usr,$1/%p,g; s,([\047`"])(dpkg[\w-]*|822-date|md5sum|gpg)([\s\047`"]),$1%p/bin/$2$3,g'
+<<
+SetCPPFLAGS: -fconstant-cfstrings
+SetCFLAGS: -I%p/include
+SetLDFLAGS: -Wl,-framework,CoreFoundation
+CompileScript: <<
+#!/bin/sh -ev
+
+	export PERL5LIB=`pwd`/../po4a-0.24/lib:"$PERL5LIB"
+	export PATH=`pwd`/../po4a-0.24:"$PATH"
+	chmod a+x ../po4a-0.24/po4a*
+	mv getopt/obstack.* lib/
+	PERL=/usr/bin/perl ./configure --build=%m-apple-darwin %c
+	make
+<<
+ConfigureParams: --without-start-stop-daemon --without-sgml-doc --with-admindir=%p/var/lib/dpkg --mandir=%p/share/man --infodir=%p/share/info --srcdir=%b --disable-linker-optimisations --without-dselect
+InstallScript: <<
+#!/bin/sh -ev
+
+	export PERL5LIB=`pwd`/../po4a-0.24/lib:"$PERL5LIB"
+	export PATH=`pwd`/../po4a-0.24:"$PATH"
+	chmod a+x ../po4a-0.24/po4a*
+	mkdir -p %i/share/doc/dpkg
+	make install DESTDIR=%d
+	for lang in de es ja sv; do
+		install -d -m 755 %i/share/man/$lang/man1
+		install -c -m 644 man/$lang/md5sum.1 %i/share/man/$lang/man1/
+	done
+	install -d -m 755 %i/var/backups
+	rm -rf %i/lib/dpkg/methods/*
+<<
+Description: The Debian package manager
+DescDetail: <<
+dpkg installs and removes binary packages; it is the base of the
+distribution. This package also contains some helper programs and
+dselect, a full-screen console frontend to dpkg.
+<<
+DescPort: <<
+1.13.18
+- forward-ported changes to 1.13.18
+
+1.13.16
+- forward-ported changes to 1.13.16
+- remove dselect and curses dependency (will be split into another pkg)
+- remove the getopt stuff (except for obstack, move that to lib)
+- ignore Fink-owned fields
+- use search-and-replace for scripts and man prefix patching
+
+1.13.11
+- forward-ported changes to 1.13.11
+  - md5sum was removed, had to be re-added
+  - getopt was needed, but not automatically included, so had to be added to the Makefile.in's
+
+1.10.9 
+- Removed --without-zlib flag
+- Gets confused about top_srcdir without the --srcdir arg.
+- Fixed bug with BR manpage
+- Patched update-rc.d out of the app check code, not needed on OS X.
+
+Pre-Jaguar: Needed fixes to use the right architecture, disable code that uses
+unimplemented functions on Darwin and other stuff.
+
+Added code to support the pseudo package 'macosx' and 'darwin'.
+
+Fix to install-info script to prevent a certain problem with section titles.
+
+Patched to run 'fink-virtual-pkgs' to see what packages we have outside of $prefix.
+
+Patched to suppress warning about BuildDependsOnly control field.
+
+Previous versions by Christoph Pfisterer.
+
+Patched to not remove Darwin's system-critical symlinks (/etc /tmp /var)
+
+Patched to hardcode complete paths to our component executables
+instead of relying on PATH
+<<
+#
+PostInstScript: <<
+if [ ! -f %p/var/lib/dpkg/diversions ]; then
+  touch %p/var/lib/dpkg/diversions
+  chmod 644 %p/var/lib/dpkg/diversions
+fi
+<<
+License: GPL
+Homepage: http://packages.qa.debian.org/d/dpkg.html
Index: fink/md5sum
===================================================================
RCS file: fink/md5sum
diff -N fink/md5sum
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ fink/md5sum	19 Mar 2006 01:17:16 -0000	1.2
@@ -0,0 +1,121 @@
+#!/usr/bin/perl
+
+$|++;
+
+use strict;
+use Getopt::Long;
+use IO::Handle;
+
+Getopt::Long::Configure qw(bundling);
+my ($binary, $check, $help, $verbose);
+my $result = GetOptions(
+	'b'	=> \$binary,
+	'c' => \$check,
+	'h' => \$help,
+	'v' => \$verbose,
+);
+usage() if $help;
+$binary = $binary ? '*' : ' ';
+
+if ($check) {
+	usage() if scalar(@ARGV) != 1;
+	$check = shift;
+
+	my (@items, %file_checksums);
+	open my $input, $check or die "$check: $!\n";
+	while (my $line = <$input>) {
+		chomp $line;
+		if ($line =~ /^(.{32}) (?:\*| )(.*)$/) {
+			$file_checksums{$2} = $1;
+			push @items, { file => $2 };
+		} else {
+			push @items, { err => "$0: unrecognized line\n" };
+		}
+	}
+	close($input);
+
+	my $checksums = md5sum_files(keys %file_checksums);
+	my ($failed, $tot) = (0, 0);
+	for my $item (@items) {
+		if ($item->{err}) {
+			print $item->{err};
+			next;
+		} else {
+			$tot++;
+			my $file = $item->{file};
+			if (exists $checksums->{$file}
+					&& lc $checksums->{$file} eq lc $file_checksums{$file}) {
+				printf STDERR "%-14s OK\n", $file if $verbose;
+			} else {
+				$failed++;
+				if ($verbose) {
+					printf STDERR "%-14s FAILED\n", $file;
+				} else {
+					print STDERR "$0: MD5 check failed for '$file'\n";
+				}
+			}
+		}
+	}
+	if ($failed) {
+		printf STDERR "$0: %d of %d file(s) failed MD5 check\n", $failed, $tot
+			if $verbose;
+		exit 1;
+	}
+	unless ($tot) {
+		print STDERR "$0: no files checked\n";
+		exit 3;
+	}
+} elsif (not @ARGV) {
+	my $checksum = md5sum_stdin();
+	print_checksum($checksum, '-');
+} else {
+	my $checksums = md5sum_files(@ARGV);
+	for my $file (@ARGV) {
+		# Errors were already output by md5sum_files to stderr
+		print_checksum($checksums->{$file}, $file) if (exists $checksums->{$file});
+	}
+}
+
+exit 0;
+
+sub usage {
+	print <<END;
+usage: md5sum [-bv] [-c [file]] | [file...]
+Generates or checks MD5 Message Digests
+    -c  check message digests (default is generate)
+    -v  verbose, print file names when checking
+    -b  read files in binary mode
+The input for -c should be the list of message digests and file names
+that is printed on stdout by this program when it generates digests.
+END
+	exit 2;
+}
+
+sub print_checksum {
+	my ($checksum, $file) = @_;
+
+	print $checksum, " ", $binary, $file, "\n";
+}
+
+sub md5sum_stdin {
+	open my $reader, '-|', '/sbin/md5'
+		or die "Can't run /sbin/md5 on standard input: $!\n";
+	chomp(my $checksum = <$reader>);
+	close $reader;
+	return $checksum;
+}
+
+sub md5sum_files {
+	my @files = @_;
+	my %return;
+
+	open my $reader, '-|', '/sbin/md5', @files
+		or die "Can't run /sbin/md5 @files: $!\n";
+	while (my $line = <$reader>) {
+		$line =~ /^MD5\s*\(([^\)]+)\)\s*=\s*(\S+)\s*$/
+			or die "Can't interpret /sbin/md5 output:\n$line\n";
+		$return{$1} = $2;
+	}
+	close $reader;
+	return \%return;
+}
Index: lib/Makefile.in
===================================================================
RCS file: /cvsroot/fink/3rdparty/dpkg/lib/Makefile.in,v
retrieving revision 1.1.1.2
retrieving revision 1.4
diff -u -r1.1.1.2 -r1.4
--- lib/Makefile.in	2 May 2006 17:55:50 -0000	1.1.1.2
+++ lib/Makefile.in	2 May 2006 17:58:44 -0000	1.4
@@ -75,7 +75,7 @@
 	md5.$(OBJEXT) mlib.$(OBJEXT) myopt.$(OBJEXT) \
 	nfmalloc.$(OBJEXT) parse.$(OBJEXT) parsehelp.$(OBJEXT) \
 	showcright.$(OBJEXT) showpkg.$(OBJEXT) tarfn.$(OBJEXT) \
-	utils.$(OBJEXT) varbuf.$(OBJEXT) vercmp.$(OBJEXT)
+	utils.$(OBJEXT) varbuf.$(OBJEXT) vercmp.$(OBJEXT) obstack.$(OBJEXT)
 libdpkg_a_OBJECTS = $(am_libdpkg_a_OBJECTS)
 DEFAULT_INCLUDES = -I. -I$(srcdir) -I$(top_builddir)
 depcomp = $(SHELL) $(top_srcdir)/config/depcomp
Index: lib/dpkg.h
===================================================================
RCS file: /cvsroot/fink/3rdparty/dpkg/lib/dpkg.h,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -r1.1.1.1 -r1.2
--- lib/dpkg.h	17 Mar 2006 01:54:27 -0000	1.1.1.1
+++ lib/dpkg.h	17 Mar 2006 02:29:33 -0000	1.2
@@ -107,7 +107,7 @@
 #define SHELLENV            "SHELL"
 #define DEFAULTSHELL        "sh"
 #define PAGERENV            "PAGER"
-#define DEFAULTPAGER        "pager"
+#define DEFAULTPAGER        "less"
 
 #define IMETHODMAXLEN        50
 #define IOPTIONMAXLEN        IMETHODMAXLEN
@@ -129,12 +129,12 @@
 
 #define ARCHIVE_FILENAME_PATTERN "*.deb"
 
-#define BACKEND		"dpkg-deb"
-#define DPKGQUERY	"dpkg-query"
-#define SPLITTER	"dpkg-split"
-#define DSELECT		"dselect"
-#define DPKG		"dpkg"
-#define DEBSIGVERIFY	"/usr/bin/debsig-verify"
+#define BACKEND		"@PREFIX@/bin/dpkg-deb"
+#define DPKGQUERY	"@PREFIX@/bin/dpkg-query"
+#define SPLITTER	"@PREFIX@/bin/dpkg-split"
+#define DSELECT		"@PREFIX@/bin/dselect"
+#define DPKG		"@PREFIX@/bin/dpkg"
+#define DEBSIGVERIFY	"@PREFIX@/bin/debsig-verify"
 
 #define TAR		"tar"
 #define GZIP		"gzip"
Index: lib/nfmalloc.c
===================================================================
RCS file: /cvsroot/fink/3rdparty/dpkg/lib/nfmalloc.c,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -r1.1.1.1 -r1.2
--- lib/nfmalloc.c	17 Mar 2006 01:54:27 -0000	1.1.1.1
+++ lib/nfmalloc.c	17 Mar 2006 02:29:33 -0000	1.2
@@ -26,7 +26,7 @@
 #include <dpkg.h>
 #include <dpkg-db.h>
 
-#include <obstack.h>
+#include "obstack.h"
 
 #define obstack_chunk_alloc m_malloc
 #define obstack_chunk_free free
Index: lib/tarfn.c
===================================================================
RCS file: /cvsroot/fink/3rdparty/dpkg/lib/tarfn.c,v
retrieving revision 1.1.1.1
retrieving revision 1.3
diff -u -r1.1.1.1 -r1.3
--- lib/tarfn.c	17 Mar 2006 01:54:28 -0000	1.1.1.1
+++ lib/tarfn.c	19 Mar 2006 02:53:57 -0000	1.3
@@ -58,9 +58,9 @@
 StoC(const char *s, int size)
 {
 	int	len;
-	char *	str;
-
-	len = strnlen(s, size);
+	char *	str, *p;
+	for (p = s; p < s + size && *p; ++p) ;
+	len = p - s;
 	str = malloc(len + 1);
 	memcpy(str, s, len);
 	str[len] = 0;
Index: man/de/md5sum.1
===================================================================
RCS file: man/de/md5sum.1
diff -N man/de/md5sum.1
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ man/de/md5sum.1	17 Mar 2006 02:29:34 -0000	1.1
@@ -0,0 +1,74 @@
+.\" Hey, Emacs!  This is an -*- nroff -*- source file.
+.hw ge-knackt
+.TH MD5SUM 1 "29. November 1995" "Lankester et al" "Debian GNU/Linux"
+.SH NAME
+md5sum \- generiert oder überprüft MD5-Prüfsummen
+
+.SH "ÜBERSICHT"
+.B md5sum
+[-bv] [-c [datei]] | [datei...]
+
+.SH BESCHREIBUNG
+.B md5sum
+generiert oder überprüft MD5-Prüfsummen. Der Algorithmus zur Generierung
+der Prüfsummen ist ausreichend schnell und sicher genug für die meisten
+Fälle. Die genaue Spezifikation der Algorithmus findet sich in
+.I RFC 1321.
+
+Normalerweise generiert
+.B md5sum
+Prüfsummen aller als Parameter übergebenen Dateien und gibt die Prüfsummen
+gefolgt von den entsprechenden Dateinamen aus. Wenn allerdings
+.B -c
+angegeben wird, ist nur ein Dateiname erlaubt. Diese Datei sollte Prüfsummen
+und zu ihnen gehörende Dateinamen enthalten; die aufgeführten Dateien werden
+dann mit den angegebenen Prüfsummen gegengeprüft. Siehe Option
+.B -c
+für mehr Information.
+
+.SH OPTIONEN
+.TP
+.B -b
+Binärmodus benutzen. In einer UNIX-Umgebung ist der einzige Unterschied zwischen
+diesem und dem Normalmodus ein Sternchen, das dem Dateinamen in der Ausgabe
+vorangeht.
+.TP
+.B -c
+Die Prüfsummen aller Dateien, die in
+.I datei
+aufgeführt sind, nachprüfen. Das Format dieser Datei ist das gleiche wie die
+Ausgabe von
+.B md5sum.
+Es beschreibt also jede Zeile eine Datei. Eine Zeile sieht so aus:
+
+.B <MD5-Prüfsumme>  <Dateiname>
+
+Wenn also beispielsweise eine Datei erstellt und ihre Prüfsumme berechnet wird,
+etwa so:
+
+.B echo foo > md5-test-file; md5sum md5-test-file
+
+dann würde
+.B md5sum
+Folgendes melden:
+
+.B d3b07384d113edec49eaa6238ad5ff00\  md5-test-file
+
+.TP
+.B -v
+Wortreicher sein. Gibt Dateinamen während der Überprüfung (mit \fB-c\fR) aus.
+
+.SH BUGS
+Der verwandte MD4-Prüfsummen-Algorithmus wurde im Oktober 1995 geknackt. MD5
+sieht nicht mehr so sicher aus wie früher.
+
+.B md5sum
+akzeptiert keine Standardoptionen wie
+.BR --help .
+
+.SH AUTOR
+
+.B md5sum
+wurde ursprünglich von Branko Lankester geschrieben und hiernach von
+Colin Plumb und Ian Jackson (ijackson@gnu.ai.mit.edu) geändert. Die Man-Seite
+wurde von Juho Vuori (javuori@cc.helsinki.fi) hinzugefügt.
Index: man/es/md5sum.1
===================================================================
RCS file: man/es/md5sum.1
diff -N man/es/md5sum.1
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ man/es/md5sum.1	17 Mar 2006 02:29:34 -0000	1.1
@@ -0,0 +1,78 @@
+.\" Hey, Emacs!  This is an -*- nroff -*- source file.
+.TH MD5SUM 1 "29 de Noviembre de 1995" "Lankester et al" "Debian GNU/Linux"
+.SH NOMBRE
+md5sum \- genera o comprueba las sumas de control MD5
+
+.SH SINOPSIS
+.B md5sum
+[-bv] [-c [nombre_archivo]] | [nombre_archivo...]
+
+.SH DESCRIPCIÓN
+.B md5sum
+genera o comprueba las sumas de control MD5. El algoritmo que genera las
+sumas de control es razonablemente rápido y robusto para la mayoría de 
+los casos. Las especificaciones exactas del algoritmo están en 
+.I RFC 1321.
+
+Normalmente
+.B md5sum
+genera las sumas de control de todos los archivos que se le pasan como 
+argumentos e imprime las sumas de control seguidas de los nombres de 
+los archivos. Sin embargo si se especifica el parámetro
+.B -c
+, solo un nombre de archivo es permitido como parámetro.
+Este fichero debe de contener las sumas de control y los nombres de archivo
+a las que estas se refieren, entonces los ficheros listados en el archivo
+son comprobados con las sumas de control especificadas. Ver opción
+.B -c
+para mas información.
+
+.SS OPCIONES
+.TP
+.B -b
+Usar modo binario. En Unix, la única diferencia entre este modo y el normal
+es un asterisco que precede al nombre del fichero en la salida de la
+ejecución del comando.
+.TP
+.B -c
+Comprueba la suma de control md5 de todos los archivos listados en el
+.I archivo
+con la suma de control que aparece listada en el mismo fichero. El
+formato actual de este archivo es el mismo que la salida de
+.B md5sum.
+Esto es, cada linea en el archivo describe un fichero, y tiene
+dos campos, que son:
+
+.B <Suma de control MD5>  <nombre_archivo>
+
+Entonces, por ejemplo, si se crea un fichero y se calcula su suma de control como sigue:
+
+.B echo foo > md5-fichero-prueba; md5sum md5-fichero-prueba
+
+.B md5sum
+devolverá:
+
+.B d3b07384d113edec49eaa6238ad5ff00\  md5-fichero-prueba
+
+.TP
+.B -v
+Ser mas explicativo. Imprimir nombres de archivo (con -c).
+
+.SH FALLOS
+El relacionado algoritmo MD4 fue crackeado en octubre de 1995.
+MD5 no parece tan seguro como antes.
+
+Esta pagina del manual no es muy precisa y tiene un formato inconsistente
+con otras paginas del manual.
+
+.B md5sum
+no acepta opciones estándar como
+.BR --help .
+
+.SH AUTOR
+
+.B md5sum
+fue originalmente escrito por Branko Lankester, y modificado después por
+Colin Plumb y Ian Jackson (ijackson@gnu.ai.mit.edu). La pagina del manual
+fue agregada por  Juho Vuori (javuori@cc.helsinki.fi) y traducida por Rubén
+Porras (nahoo@inicia.es)
Index: man/ja/md5sum.1
===================================================================
RCS file: man/ja/md5sum.1
diff -N man/ja/md5sum.1
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ man/ja/md5sum.1	17 Mar 2006 02:29:34 -0000	1.1
@@ -0,0 +1,86 @@
+.\" Hey, Emacs!  This is an -*- nroff -*- source file.
+.\"WORD:  message digest	¥á¥Ã¥»¡¼¥¸¥À¥¤¥¸¥§¥¹¥È
+.\"WORD:  checksum		¥Á¥§¥Ã¥¯¥µ¥à
+.\"WORD:  check			¾È¹ç
+.\"original revision: 1.2
+.TH MD5SUM 1 "29th November 1995" "Lankester et al" "Debian GNU/Linux"
+.SH Ì¾Á°
+md5sum \- MD5 ¥á¥Ã¥»¡¼¥¸¥À¥¤¥¸¥§¥¹¥È¤òºîÀ®¡¦¾È¹ç¤¹¤ë¡£
+
+.SH ½ñ¼°
+.B md5sum
+[-bv] [-c [file]] | [file...]
+
+.SH ÀâÌÀ
+.B md5sum
+¤Ï¡¢MD5 ¥Á¥§¥Ã¥¯¥µ¥à¤òºîÀ®¡¢¤â¤·¤¯¤Ï MD5 ¥Á¥§¥Ã¥¯¥µ¥à¤Î¾È¹ç¤ò¹Ô¤¦¡£
+¥Á¥§¥Ã¥¯¥µ¥à¤òÀ¸À®¤¹¤ë¥¢¥ë¥´¥ê¥º¥à¤ÏÈæ³ÓÅª¹âÂ®¤Ç¤¢¤ê¡¢¤Û¤È¤ó¤É¤Î
+¾ì¹ç¤Ç½½Ê¬·øÏ´¤Ç¤¢¤ë¡£¤³¤Î¥¢¥ë¥´¥ê¥º¥à¤Î¸·Ì©¤Ê»ÅÍÍ¤Ë¤Ä¤¤¤Æ¤Ï
+.I RFC 1321
+¤ò»²¾È¤µ¤ì¤¿¤¤¡£
+
+ÄÌ¾ï
+.B md5sum
+¤Ï¡¢°ú¿ô¤ËÍ¿¤¨¤é¤ì¤¿¤¹¤Ù¤Æ¤Î¥Õ¥¡¥¤¥ë¤Î¥Á¥§¥Ã¥¯¥µ¥à¤òºîÀ®¤·¡¢
+¥Á¥§¥Ã¥¯¥µ¥à¤È¤½¤Î¥Õ¥¡¥¤¥ëÌ¾¤ò°ì¹Ô¤º¤Ä½ÐÎÏ¤¹¤ë¡£¤·¤«¤·¡¢
+.B -c
+¥ª¥×¥·¥ç¥ó¤¬»ØÄê¤µ¤ì¤¿¾ì¹ç¡¢°ú¿ô¤Ë¤Ï¥Õ¥¡¥¤¥ëÌ¾¤¬¤Ò¤È¤Ä¤À¤±µö¤µ¤ì¤ë¡£
+°ú¿ô¤ËÍ¿¤¨¤é¤ì¤¿¥Õ¥¡¥¤¥ë¤Ë¤Ï¡¢¥Á¥§¥Ã¥¯¥µ¥à¤È¤½¤Î¥Õ¥¡¥¤¥ëÌ¾¤¬µ­½Ò¤µ
+¤ì¤Æ¤¤¤Ê¤±¤ì¤Ð¤Ê¤é¤Ê¤¤¡£µ­½Ò¤µ¤ì¤¿¥Õ¥¡¥¤¥ë¤ËÂÐ¤¹¤ë¼ÂºÝ¤Î¥Á¥§¥Ã¥¯¥µ
+¥à¤¬¡¢µ­½Ò¤µ¤ì¤¿¥Á¥§¥Ã¥¯¥µ¥à¤È¾È¹ç¤µ¤ì¤ë¡£¾ÜºÙ¤Ï¥ª¥×¥·¥ç¥ó
+.B -c
+¤Î¹àÌÜ¤ò»²¾È¤µ¤ì¤¿¤¤¡£
+
+.SS ¥ª¥×¥·¥ç¥ó
+.TP
+.B -b
+¥Ð¥¤¥Ê¥ê¥â¡¼¥É¤ò»ÈÍÑ¤¹¤ë¡£UNIX ´Ä¶­¤Ç¤Ï¡¢¥Ð¥¤¥Ê¥ê¥â¡¼¥É¤È¥Î¡¼¥Þ¥ë¥â¡¼
+¥É¤Î°ã¤¤¤Ï¡¢½ÐÎÏ¤µ¤ì¤ë¥Õ¥¡¥¤¥ëÌ¾¤ÎÁ°¤Ë¥¢¥¹¥¿¥ê¥¹¥¯¤¬ÉÕ¤¯¤Î¤ß¤Ç¤¢¤ë¡£
+.TP
+.B -c
+.I file
+Ãæ¤Ëµ­½Ò¤µ¤ì¤¿Á´¤Æ¤Î¥Õ¥¡¥¤¥ë¤Î md5sum ¤ò¼ÂºÝ¤Î¥Á¥§¥Ã¥¯¥µ¥à¤È
+¾È¹ç¤¹¤ë¡£°ú¿ô¤ËÍ¿¤¨¤ë¥Õ¥¡¥¤¥ë¤Î·Á¼°¤Ï
+.B md5sum
+¤Î½ÐÎÏ¤ÈÆ±¤¸¤Ç¤¢¤ë¡£¤Ä¤Þ¤ê¡¢¥Õ¥¡¥¤¥ëÃæ¤Î³Æ¹Ô¤Ë¤Ä¤­¤Ò¤È¤Ä¤Î¥Õ¥¡¥¤¥ë
+¤¬µ­½Ò¤µ¤ì¤ë¡£¤½¤Î·Á¼°¤Ï¡¢
+
+.B <MD5 checksum>  <filename>
+
+¤Ç¤¢¤ë¡£Îã¤¨¤Ð¡¢¼¡¤Î¤è¤¦¤Ë¥Õ¥¡¥¤¥ë¤òºîÀ®¤·¤Æ¡¢¤½¤Î¥á¥Ã¥»¡¼¥¸¥À¥¤¥¸¥§¥¹¥È
+¤ò·×»»¤¹¤ë¡£
+
+.B echo foo > md5-test-file; md5sum md5-test-file
+
+¤³¤Î¾ì¹ç¡¢
+.B md5sum
+¤Ï¼¡¤Î¤è¤¦¤ÊÊó¹ð¤ò¤¹¤ë¡£
+
+.B d3b07384d113edec49eaa6238ad5ff00\  md5-test-file
+
+.TP
+.B -v
+¾ÜºÙÉ½¼¨¡£(-c ¥ª¥×¥·¥ç¥ó¤Ç)¾È¹ç¤¹¤ë¾ì¹ç¤Ï¥Õ¥¡¥¤¥ëÌ¾¤ò½ÐÎÏ¤¹¤ë¡£
+
+.SH ¥Ð¥°
+MD4 ¥á¥Ã¥»¡¼¥¸¥À¥¤¥¸¥§¥¹¥È¥¢¥ë¥´¥ê¥º¥à¤¬ 1995 Ç¯ 10 ·î¤ËÇË¤é¤ì¤¿¡£
+Æ±·Ï¤Ç¤¢¤ë MD5 ¤â°ÊÁ°¤Û¤É°ÂÁ´¤È¤Ï¸À¤¨¤Ê¤¤¤Ç¤¢¤í¤¦¡£
+
+¤³¤Î¥Þ¥Ë¥å¥¢¥ë¥Ú¡¼¥¸¤ÏÉÔÀµ³Î¤Ç¤¢¤ê¡¢Â¾¤Î¥Þ¥Ë¥å¥¢¥ë¥Ú¡¼¥¸¤ÈÀ°¹çÀ­
+¤Î¤¢¤ë½ñ¼°¤Ç¤Ê¤¤¡£
+
+.B md5sum
+¤Ï
+.BR --help 
+¤Î¤è¤¦¤ÊÉ¸½àÅª¤Ê¥ª¥×¥·¥ç¥ó¤¬»È¤¨¤Ê¤¤¡£
+
+.SH Ãø¼Ô
+
+.B md5sum
+¤Ï¡¢¸µ¡¹ by Branko Lankester ¤Ë¤è¤ê½ñ¤«¤ì¡¢¤½¤Î¸å Colin Plumb ¤È
+ Ian Jackson (ijackson@gnu.ai.mit.edu) ¤Ë¤è¤ê½ñ¤­ÊÑ¤¨¤é¤ì¤¿¡£
+¥Þ¥Ë¥å¥¢¥ë¥Ú¡¼¥¸¤Ï Juho Vuori (javuori@cc.helsinki.fi) ¤Ë¤è¤êÄÉ²Ã¤µ¤ì¤¿¡£
+
+.SH ËÝÌõ¼Ô
+
+ÆéÃ« ±ÉÅ¸ <nabe@debian.or.jp>
Index: man/sv/md5sum.1
===================================================================
RCS file: man/sv/md5sum.1
diff -N man/sv/md5sum.1
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ man/sv/md5sum.1	17 Mar 2006 02:29:34 -0000	1.1
@@ -0,0 +1,83 @@
+.\" Hey, Emacs!  This is an -*- nroff -*- source file.
+.\" Translation of CVS revision 1.2
+.TH MD5SUM 1 "29 november 1995" "Lankester m fl" "Debian GNU/Linux"
+.SH NAMN
+md5sum \- genererar eller kontrollerar MD5-meddelandesamlingar
+
+.SH SYNOPS
+.B md5sum
+[-bv] [-c [fil]] | [fil...]
+
+.SH BESKRIVNING
+.B md5sum
+genererar eller kontrollerar MD5-kontrollsummor.
+Algoritmen som genererar kontrollsumman är hyfsat snabb och tillräckligt
+stark för de flesta fallen.
+En exakt specifikation av algoritmen finns i
+.I RFC 1321.
+
+Normalt genererar
+.B md5sum
+kontrollsummor för samtliga filer som anges som flaggor och skriver
+kontrollsummorna följt av filnamnen.
+Om däremot flaggan
+.B -c
+anges tillåts endast en filnamnsparameter.
+Denna fil innehåller kontrollsummor och tillhörande filnamn, och filerna som
+listas i den filen kommer att kontrolleras gentemot kontrollsumman som står
+där.
+Se flaggan
+.B -c
+för ytterligare information.
+
+.SS FLAGGOR
+.TP
+.B -b
+Använd binärt läge.
+I en unixmiljö är den enda skillnaden mellan detta och det normala läget en
+asterisk framför filnamnet i utdata.
+.TP
+.B -c
+Kontrollera md5-summan för samtliga filer som listas i
+.I fil
+mot kontrollsummorna som står i filen.
+Formatet som används för denna fil är detsamma som utdata för
+.B md5sum.
+Det betyder att varje rad i filen beskriver en fil, på formen:
+
+.B <MD5-kontrollsumma>  <filnamn>
+
+Så, till exempel, om en fil skapats och dess meddelandesamlingar (message
+digest) beräknats enligt
+
+.B echo foo > md5-testfil; md5sum md5-testfil
+
+kommer
+.B md5sum
+rapportera:
+
+.B d3b07384d113edec49eaa6238ad5ff00\  md5-testfil
+
+.TP
+.B -v
+Var mer pratsam.
+Skriv ut filnamn när de kontrolleras (med -c).
+
+.SH PROGRAMFEL
+Den relaterade meddelandesamlingsalgoritmen MD4 knäcktes i oktober 1995.
+MD5 verkar inte vara lika säker som den en gång var.
+
+Denna manualsida är inte helt korrekt och har formatering som inte är
+konsistent med andra manualsidor.
+
+.B md5sum
+tillåter inte standardflaggor såsom
+.BR --help .
+
+.SH FÖRFATTARE
+
+.B md5sum
+skrevs ursprungligen av Branko Lankester och modifierades sedan av
+Colin Plumb och Ian Jackson (ijackson@gnu.ai.mit.edu).
+Manualsidan lades till av Juho Vuori (javuori@cc.helsinki.fi)
+och översattes av Peter Karlsson.
Index: origins/Makefile.in
===================================================================
RCS file: /cvsroot/fink/3rdparty/dpkg/origins/Makefile.in,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -r1.1.1.2 -r1.3
--- origins/Makefile.in	2 May 2006 17:55:53 -0000	1.1.1.2
+++ origins/Makefile.in	2 May 2006 17:58:44 -0000	1.3
@@ -210,7 +210,7 @@
 target_vendor = @target_vendor@
 pkgconfdir = $(sysconfdir)/@PACKAGE@
 originsdir = $(pkgconfdir)/origins
-dist_origins_DATA = debian
+dist_origins_DATA = debian fink
 all: all-am
 
 .SUFFIXES:
Index: origins/fink
===================================================================
RCS file: origins/fink
diff -N origins/fink
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ origins/fink	17 Mar 2006 03:44:02 -0000	1.1
@@ -0,0 +1,3 @@
+Vendor: Fink
+Vendor-URL: http://fink.sourceforge.net/
+Bugs: http://fink.sourceforge.net/
Index: src/archives.c
===================================================================
RCS file: /cvsroot/fink/3rdparty/dpkg/src/archives.c,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -r1.1.1.1 -r1.2
--- src/archives.c	17 Mar 2006 01:55:09 -0000	1.1.1.1
+++ src/archives.c	17 Mar 2006 02:29:34 -0000	1.2
@@ -655,6 +655,7 @@
     if (symlink(ti->LinkName,fnamenewvb.buf))
       ohshite(_("error creating symbolic link `%.255s'"),ti->Name);
     debug(dbg_eachfiledetail,"tarobject SymbolicLink creating");
+#ifndef __APPLE__
 #ifdef HAVE_LCHOWN
     if (lchown(fnamenewvb.buf,
 	    nifd->namenode->statoverride ? nifd->namenode->statoverride->uid : ti->UserID,
@@ -666,6 +667,7 @@
 	    nifd->namenode->statoverride ? nifd->namenode->statoverride->gid : ti->GroupID))
       ohshite(_("error setting ownership of symlink `%.255s'"),ti->Name);
 #endif
+#endif
     break;
   case Directory:
     /* We've already checked for an existing directory. */
@@ -719,6 +721,7 @@
       symlinkfn.used= r; varbufaddc(&symlinkfn,0);
       if (symlink(symlinkfn.buf,fnametmpvb.buf))
         ohshite(_("unable to make backup symlink for `%.255s'"),ti->Name);
+#ifndef __APPLE__
 #ifdef HAVE_LCHOWN
       if (lchown(fnametmpvb.buf,stab.st_uid,stab.st_gid))
         ohshite(_("unable to chown backup symlink for `%.255s'"),ti->Name);
@@ -726,6 +729,7 @@
       if (chown(fnametmpvb.buf,stab.st_uid,stab.st_gid))
         ohshite(_("unable to chown backup symlink for `%.255s'"),ti->Name);
 #endif
+#endif
     } else {
       debug(dbg_eachfiledetail,"tarobject nondirectory, `link' backup");
       if (link(fnamevb.buf,fnametmpvb.buf))
Index: src/configure.c
===================================================================
RCS file: /cvsroot/fink/3rdparty/dpkg/src/configure.c,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -r1.1.1.1 -r1.2
--- src/configure.c	17 Mar 2006 01:55:09 -0000	1.1.1.1
+++ src/configure.c	17 Mar 2006 02:29:34 -0000	1.2
@@ -483,9 +483,10 @@
 static void suspend(void) {
 	const char*	s;
 	int		pid;
-
+#ifndef __APPLE__
 	s= getenv(NOJOBCTRLSTOPENV);
 	if (s && *s) {
+#endif
 		/* Do not job control to suspend but fork and start a new shell
 		 * instead.
 		 */
@@ -513,11 +514,13 @@
 			onerr_abort++;
 			ohshite(_("wait for shell failed"));
 		}
+#ifndef __APPLE__
 	} else {
 		fputs(_("Don't forget to foreground (`fg') this "
 					"process when you're done !\n"), stderr);
 		kill(-getpgid(0),SIGTSTP);
 	}
+#endif
 }
 
 
Index: src/help.c
===================================================================
RCS file: /cvsroot/fink/3rdparty/dpkg/src/help.c,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -r1.1.1.1 -r1.2
--- src/help.c	17 Mar 2006 01:55:09 -0000	1.1.1.1
+++ src/help.c	17 Mar 2006 02:29:34 -0000	1.2
@@ -69,11 +69,18 @@
 
 void checkpath(void) {
 /* Verify that some programs can be found in the PATH. */
-  static const char *const checklist[]= { "ldconfig", 
-#ifdef WITH_START_STOP_DAEMON
+  static const char *const checklist[]= {
+#ifndef __APPLE__
+    "ldconfig", 
+#endif
+#if WITH_START_STOP_DAEMON
     "start-stop-daemon",
 #endif    
-    "install-info", "update-rc.d", 0
+    "install-info",
+#ifndef __APPLE__
+    "update-rc.d",
+#endif
+    0
   };
 
   struct stat stab;
@@ -410,6 +417,26 @@
     
   debug(dbg_veryverbose, "isdirectoryinuse `%s' (except %s)", file->name,
         pkg ? pkg->name : "<none>");
+
+  /* FINK LOCAL begin */
+
+  /*
+   * Darwin has symlinks /etc -> /private/etc and /var -> /private/var
+   * instead of actual /etc and /var dirs. If dpkg removes the last
+   * pkg that it has record of having installed a file in one of those
+   * top-level dirs, it will try to remove the dir (since it thinks
+   * it's an empty dir) and it will succeed (since it's just unlinking
+   * a symlink, not trying to remove a dir that is not actually
+   * empty). That's Bad. Here we make sure these top-level dirs are
+   * never thought to be empty.
+   */
+  if( !strcmp(file->name,"/etc") || !strcmp(file->name,"/tmp") || !strcmp(file->name,"/var") ) {
+    debug(dbg_veryverbose, "isdirectoryinuse precious!");
+    return 1;
+  }
+
+  /* FINK LOCAL end */
+
   for (packageslump= file->packages; packageslump; packageslump= packageslump->more) {
     debug(dbg_veryverbose, "isdirectoryinuse packageslump %s ...",
           packageslump->pkgs[0] ? packageslump->pkgs[0]->name : "<none>");
Index: src/main.c
===================================================================
RCS file: /cvsroot/fink/3rdparty/dpkg/src/main.c,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -r1.1.1.2 -r1.3
--- src/main.c	2 May 2006 17:55:57 -0000	1.1.1.2
+++ src/main.c	2 May 2006 17:58:44 -0000	1.3
@@ -38,6 +38,12 @@
 #include <dpkg-db.h>
 #include <myopt.h>
 
+/* FINK LOCAL begin */
+#include <sys/utsname.h>
+#include <CoreFoundation/CoreFoundation.h>
+static void finkinit();
+/* FINK LOCAL end */
+
 #include "main.h"
 
 static void printversion(void) {
@@ -594,6 +600,153 @@
   }
 }
 
+/* FINK LOCAL begin */
+struct FinkVirtualPkgs {
+  struct FinkVirtualPkgs *next;
+  char *pkgname;
+  struct versionrevision version;
+};
+
+struct FinkVirtualPkgs *fink_virt_pkg = NULL;
+static void finkinit()
+{
+	FILE *virt_pkg_stream = NULL;
+	struct stat sb;
+	struct FinkVirtualPkgs *pkg;
+	char name[256];
+	char version[256];
+	char revision[256];
+	unsigned long  epoch;
+    Boolean status;
+    SInt32 errorCode;
+    CFURLRef fileURL = NULL;
+    CFDataRef resourceData = NULL;
+    CFPropertyListRef propertyList = NULL;
+    CFStringRef string;
+    static char buffer[256];	// This is static, to ensure the buffer stays around
+
+    static struct utsname ver;	// This is static, to ensure the buffer stays around
+	if (0 == stat("@PREFIX@/bin/fink-virtual-pkgs", &sb))
+	{
+	  virt_pkg_stream =popen("@PREFIX@/bin/fink-virtual-pkgs --dpkg","r");
+  	  if (virt_pkg_stream)
+	  {
+	    while (fscanf(virt_pkg_stream,"%s\t%u\t%s\t%s\n",name,&epoch,version, revision) == 4)
+	    {
+	      pkg = (struct FinkVirtualPkgs *)malloc(sizeof(struct FinkVirtualPkgs));
+	      if (pkg)
+	      {
+			  pkg->next = fink_virt_pkg;
+			  pkg->pkgname = strdup(name);
+			  pkg->version.epoch = epoch;
+			  pkg->version.version = strdup(version);
+			  pkg->version.revision = strdup(revision);
+			  /* Quick and simple sanity check */
+			  if ((NULL != pkg->pkgname) && (0 != strlen(pkg->pkgname)) &&
+			      (NULL != pkg->version.version) && (0 != strlen(pkg->version.version)) &&
+			      (NULL != pkg->version.revision) && (0 != strlen(pkg->version.revision)))
+			  {
+			  	/* We are leaking here if something fails the sanity check above */
+			  	fink_virt_pkg = pkg;
+			  }
+	      }
+	    }
+	    if (pclose(virt_pkg_stream))
+	    {
+	    	/* The fink-virtual-pkgs script returned a non zero exit status *
+	    	 * clean up and try the old way.                                */
+	    	while(NULL != fink_virt_pkg)
+	    	{
+	    		pkg = fink_virt_pkg;
+	    		if (NULL != pkg->pkgname) free(pkg->pkgname);
+	    		if (NULL != pkg->version.version) free(pkg->version.version);
+	    		if (NULL != pkg->version.revision) free(pkg->version.revision);
+	    		fink_virt_pkg = pkg->next;
+	    		free(pkg);
+	    	}
+                fink_virt_pkg = NULL;
+	    }
+	  }
+	} 
+	if (NULL == fink_virt_pkg)
+	{
+	  /* Determine system version */
+	  /* TODO - should maybe check if this is really Darwin? */
+	  if (!uname(&ver)) {
+	      pkg = (struct FinkVirtualPkgs *)malloc(sizeof(struct FinkVirtualPkgs));
+	      if (pkg) {
+			  pkg->next = fink_virt_pkg;
+			  pkg->pkgname = strdup("darwin");
+			  pkg->version.epoch = 0;
+			  pkg->version.version = ver.release;
+			  pkg->version.revision = NULL;
+			  fink_virt_pkg = pkg;
+	      }  
+	  }
+	
+	  /* Check whether this is Mac OS X, and which version of it */
+
+	  fileURL = CFURLCreateWithFileSystemPath( NULL, 	
+			CFSTR("/System/Library/CoreServices/SystemVersion.plist"),
+			kCFURLPOSIXPathStyle,				
+			false );
+	  if (!fileURL)
+		goto BAIL;
+	  
+	  /* Read the XML */
+	  status = CFURLCreateDataAndPropertiesFromResource(
+			NULL,
+			fileURL,
+			&resourceData,
+			NULL,		
+			NULL,
+			&errorCode);
+	  if (!status || errorCode != 0)
+		goto BAIL;
+	  
+	  /* Reconstitute the dictionary using the XML data. */
+	  propertyList = CFPropertyListCreateFromXMLData( NULL,
+			resourceData,
+			kCFPropertyListImmutable,
+			&string);
+	  if (!propertyList)
+		goto BAIL;
+	  
+	  /* Try to read the system version from it. */
+	  status = CFDictionaryGetValueIfPresent( propertyList,
+			CFSTR("ProductVersion"),
+			(void*)&string);
+	  if (!status)
+		goto BAIL;
+	  
+	  /* Convert into a C string */
+	  status = CFStringGetCString( string,
+			buffer,
+			sizeof(buffer),
+			kCFStringEncodingISOLatin1);
+	  if (!status)
+		goto BAIL;
+	  pkg = (struct FinkVirtualPkgs *)malloc(sizeof(struct FinkVirtualPkgs));
+	  if (pkg)
+	  {
+		  pkg->next = fink_virt_pkg;
+		  pkg->pkgname = strdup("macosx");
+		  pkg->version.epoch = 0;
+		  pkg->version.version = buffer;
+		  pkg->version.revision = NULL;
+		  fink_virt_pkg = pkg;
+	  }
+	BAIL:
+	  // Release all of the CF objects we're responsible for.
+	  if (fileURL)
+		CFRelease(fileURL);
+	  if (resourceData)
+		CFRelease(resourceData);
+	  if (propertyList)
+		CFRelease(propertyList);
+	}
+}
+/* FINK LOCAL end */
 
 int main(int argc, const char *const *argv) {
   jmp_buf ejbuf;
@@ -604,7 +757,9 @@
 
   setvbuf(stdout,0,_IONBF,0);
   filesdbinit();
-
+  /* FINK LOCAL begin */
+  finkinit();
+  /* FINK LOCAL end */
   actionfunction= (void (*)(const char* const*))cipaction->farg;
 
   actionfunction(argv);
Index: src/main.h
===================================================================
RCS file: /cvsroot/fink/3rdparty/dpkg/src/main.h,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -r1.1.1.2 -r1.3
--- src/main.h	2 May 2006 17:55:57 -0000	1.1.1.2
+++ src/main.h	2 May 2006 17:58:44 -0000	1.3
@@ -96,6 +96,11 @@
 extern const char *instdir;
 extern struct packageinlist *ignoredependss;
 extern const char architecture[];
+ 
+/* FINK LOCAL begin */
+extern struct versionrevision darwin_version;
+extern struct versionrevision macosx_version;
+/* FINK LOCAL end */
 
 /* from filesdb.c */
 
Index: src/packages.c
===================================================================
RCS file: /cvsroot/fink/3rdparty/dpkg/src/packages.c,v
retrieving revision 1.1.1.1
retrieving revision 1.2
diff -u -r1.1.1.1 -r1.2
--- src/packages.c	17 Mar 2006 01:55:10 -0000	1.1.1.1
+++ src/packages.c	17 Mar 2006 02:29:34 -0000	1.2
@@ -334,6 +334,30 @@
     return thisf;
   }
 }
+ 
+/* FINK LOCAL begin */
+static int check_pseudo_package(const struct versionrevision *versrev, const struct deppossi *possi,
+                                int *interestingwarnings, struct varbuf *oemsgs) {
+
+  if (versionsatisfied3(versrev,&possi->version,possi->verrel)) {
+    return 3;
+  } else {
+    varbufaddstr(oemsgs, _("  Version of "));
+    varbufaddstr(oemsgs, possi->ed->name);
+    varbufaddstr(oemsgs, _(" on system is "));
+    varbufaddstr(oemsgs, versiondescribe(versrev, vdew_nonambig));
+    varbufaddstr(oemsgs, ".\n");
+    (*interestingwarnings)++;
+    return 0;
+  }
+}
+struct FinkVirtualPkgs {
+  struct FinkVirtualPkgs *next;
+  char *pkgname;
+  struct versionrevision version;
+};
+extern struct FinkVirtualPkgs *fink_virt_pkg;
+/* FINK LOCAL end */
 
 int dependencies_ok(struct pkginfo *pkg, struct pkginfo *removing,
                     struct varbuf *aemsgs) {
@@ -341,7 +365,7 @@
   struct varbuf oemsgs;
   struct dependency *dep;
   struct deppossi *possi, *provider;
-
+  struct FinkVirtualPkgs *virt_pkg = NULL; 
   varbufinit(&oemsgs);
   interestingwarnings= 0;
   ok= 2; /* 2=ok, 1=defer, 0=halt */
@@ -355,6 +379,29 @@
     found= 0; /* 0=none, 1=defer, 2=withwarning, 3=ok */
     for (possi= dep->list; found != 3 && possi; possi= possi->next) {
       debug(dbg_depcondetail,"    checking possibility  -> %s",possi->ed->name);
+      /* FINK LOCAL begin */
+      virt_pkg = fink_virt_pkg;
+      while (virt_pkg)
+      {
+        if (0==strcmp(possi->ed->name,virt_pkg->pkgname)) {
+          debug(dbg_depcondetail,"        pseudo package");
+          found= check_pseudo_package(&virt_pkg->version,possi,&interestingwarnings,&oemsgs);
+        }
+        virt_pkg = virt_pkg->next;
+      }
+/*      
+      if (0==strcmp(possi->ed->name,"darwin") && darwin_version.version) {
+        debug(dbg_depcondetail,"        pseudo package darwin");
+        found= check_pseudo_package(&darwin_version,possi,&interestingwarnings,&oemsgs);
+        break;
+      }
+      else if (0==strcmp(possi->ed->name,"macosx") && macosx_version.version) {
+        debug(dbg_depcondetail,"        pseudo package macosx");
+        found= check_pseudo_package(&macosx_version,possi,&interestingwarnings,&oemsgs);
+        break;
+      }
+*/      
+      /* FINK LOCAL end */
       if (possi->cyclebreak) {
         debug(dbg_depcondetail,"      break cycle so ok and found");
         found= 3; break;
Index: utils/Makefile.in
===================================================================
RCS file: /cvsroot/fink/3rdparty/dpkg/utils/Makefile.in,v
retrieving revision 1.1.1.2
retrieving revision 1.3
diff -u -r1.1.1.2 -r1.3
--- utils/Makefile.in	2 May 2006 17:55:57 -0000	1.1.1.2
+++ utils/Makefile.in	2 May 2006 17:58:44 -0000	1.3
@@ -40,6 +40,7 @@
 @WITH_START_STOP_DAEMON_TRUE@sbin_PROGRAMS =  \
 @WITH_START_STOP_DAEMON_TRUE@	start-stop-daemon$(EXEEXT)
 pkglib_PROGRAMS = enoent$(EXEEXT)
+bin_PROGRAMS = md5sum$(EXEEXT)
 subdir = utils
 DIST_COMMON = $(srcdir)/Makefile.am $(srcdir)/Makefile.in
 ACLOCAL_M4 = $(top_srcdir)/aclocal.m4
@@ -67,10 +68,14 @@
 mkinstalldirs = $(SHELL) $(top_srcdir)/config/mkinstalldirs
 CONFIG_HEADER = $(top_builddir)/config.h
 CONFIG_CLEAN_FILES =
-am__installdirs = "$(DESTDIR)$(pkglibdir)" "$(DESTDIR)$(sbindir)"
+am__installdirs = "$(DESTDIR)$(pkglibdir)" "$(DESTDIR)$(sbindir)" "$(DESTDIR)$(bindir)"
 pkglibPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
 sbinPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
-PROGRAMS = $(pkglib_PROGRAMS) $(sbin_PROGRAMS)
+binPROGRAMS_INSTALL = $(INSTALL_PROGRAM)
+PROGRAMS = $(pkglib_PROGRAMS) $(sbin_PROGRAMS) $(bin_PROGRAMS)
+am_md5sum_OBJECTS = md5sum.$(OBJEXT)
+md5sum_OBJECTS = $(am_md5sum_OBJECTS)
+md5sum_LDADD = $(LDADD) $(LIBINTL) ../lib/libdpkg.a
 am_enoent_OBJECTS = enoent.$(OBJEXT)
 enoent_OBJECTS = $(am_enoent_OBJECTS)
 enoent_LDADD = $(LDADD)
@@ -89,8 +94,8 @@
 	$(CPPFLAGS) $(AM_CFLAGS) $(CFLAGS)
 CCLD = $(CC)
 LINK = $(CCLD) $(AM_CFLAGS) $(CFLAGS) $(AM_LDFLAGS) $(LDFLAGS) -o $@
-SOURCES = $(enoent_SOURCES) $(start_stop_daemon_SOURCES)
-DIST_SOURCES = $(enoent_SOURCES) $(am__start_stop_daemon_SOURCES_DIST)
+SOURCES = $(enoent_SOURCES) $(start_stop_daemon_SOURCES) $(md5sum_SOURCES)
+DIST_SOURCES = $(enoent_SOURCES) $(am__start_stop_daemon_SOURCES_DIST) $(md5sum_SOURCES)
 ETAGS = etags
 CTAGS = ctags
 DISTFILES = $(DIST_COMMON) $(DIST_SOURCES) $(TEXINFOS) $(EXTRA_DIST)
@@ -237,6 +242,8 @@
 @WITH_START_STOP_DAEMON_TRUE@start_stop_daemon_LDADD = ../getopt/libopt.a $(SSD_LIBS)
 enoent_SOURCES = \
 	enoent.c
+md5sum_SOURCES = \
+	md5sum.c
 
 all: all-am
 
@@ -294,6 +301,20 @@
 
 clean-pkglibPROGRAMS:
 	-test -z "$(pkglib_PROGRAMS)" || rm -f $(pkglib_PROGRAMS)
+
+install-binPROGRAMS: $(bin_PROGRAMS)
+	@$(NORMAL_INSTALL)
+	test -z "$(bindir)" || $(mkdir_p) "$(DESTDIR)$(bindir)"
+	@list='$(bin_PROGRAMS)'; for p in $$list; do \
+	  p1=`echo $$p|sed 's/$(EXEEXT)$$//'`; \
+	  if test -f $$p \
+	  ; then \
+	    f=`echo "$$p1" | sed 's,^.*/,,;$(transform);s/$$/$(EXEEXT)/'`; \
+	   echo " $(INSTALL_PROGRAM_ENV) $(binPROGRAMS_INSTALL) '$$p' '$(DESTDIR)$(bindir)/$$f'"; \
+	   $(INSTALL_PROGRAM_ENV) $(binPROGRAMS_INSTALL) "$$p" "$(DESTDIR)$(bindir)/$$f" || exit 1; \
+	  else :; fi; \
+	done
+
 install-sbinPROGRAMS: $(sbin_PROGRAMS)
 	@$(NORMAL_INSTALL)
 	test -z "$(sbindir)" || $(mkdir_p) "$(DESTDIR)$(sbindir)"
@@ -307,6 +328,14 @@
 	  else :; fi; \
 	done
 
+uninstall-binPROGRAMS:
+	@$(NORMAL_UNINSTALL)
+	@list='$(bin_PROGRAMS)'; for p in $$list; do \
+	  f=`echo "$$p" | sed 's,^.*/,,;s/$(EXEEXT)$$//;$(transform);s/$$/$(EXEEXT)/'`; \
+	  echo " rm -f '$(DESTDIR)$(bindir)/$$f'"; \
+	  rm -f "$(DESTDIR)$(bindir)/$$f"; \
+	done
+
 uninstall-sbinPROGRAMS:
 	@$(NORMAL_UNINSTALL)
 	@list='$(sbin_PROGRAMS)'; for p in $$list; do \
@@ -315,8 +344,16 @@
 	  rm -f "$(DESTDIR)$(sbindir)/$$f"; \
 	done
 
+clean-binPROGRAMS:
+	-test -z "$(bin_PROGRAMS)" || rm -f $(bin_PROGRAMS)
+
 clean-sbinPROGRAMS:
 	-test -z "$(sbin_PROGRAMS)" || rm -f $(sbin_PROGRAMS)
+
+md5sum$(EXEEXT): $(md5sum_OBJECTS) $(md5sum_DEPENDENCIES) 
+	@rm -f md5sum$(EXEEXT)
+	$(LINK) $(md5sum_LDFLAGS) $(md5sum_OBJECTS) $(md5sum_LDADD) $(LIBS)
+
 enoent$(EXEEXT): $(enoent_OBJECTS) $(enoent_DEPENDENCIES) 
 	@rm -f enoent$(EXEEXT)
 	$(LINK) $(enoent_LDFLAGS) $(enoent_OBJECTS) $(enoent_LDADD) $(LIBS)
@@ -330,6 +367,7 @@
 distclean-compile:
 	-rm -f *.tab.c
 
+
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/enoent.Po@am__quote@
 @AMDEP_TRUE@@am__include@ @am__quote@./$(DEPDIR)/start-stop-daemon.Po@am__quote@
 
@@ -427,7 +465,7 @@
 check: check-am
 all-am: Makefile $(PROGRAMS)
 installdirs:
-	for dir in "$(DESTDIR)$(pkglibdir)" "$(DESTDIR)$(sbindir)"; do \
+	for dir in "$(DESTDIR)$(pkglibdir)" "$(DESTDIR)$(sbindir)" "$(DESTDIR)$(bindir)"; do \
 	  test -z "$$dir" || $(mkdir_p) "$$dir"; \
 	done
 install: install-am
@@ -456,7 +494,7 @@
 	@echo "it deletes files that may require special tools to rebuild."
 clean: clean-am
 
-clean-am: clean-generic clean-pkglibPROGRAMS clean-sbinPROGRAMS \
+clean-am: clean-generic clean-pkglibPROGRAMS clean-sbinPROGRAMS clean-binPROGRAMS \
 	mostlyclean-am
 
 distclean: distclean-am
@@ -477,7 +515,7 @@
 
 install-data-am:
 
-install-exec-am: install-pkglibPROGRAMS install-sbinPROGRAMS
+install-exec-am: install-pkglibPROGRAMS install-sbinPROGRAMS install-binPROGRAMS
 
 install-info: install-info-am
 
@@ -503,20 +541,20 @@
 ps-am:
 
 uninstall-am: uninstall-info-am uninstall-pkglibPROGRAMS \
-	uninstall-sbinPROGRAMS
+	uninstall-sbinPROGRAMS uninstall-binPROGRAMS
 
 .PHONY: CTAGS GTAGS all all-am check check-am clean clean-generic \
-	clean-pkglibPROGRAMS clean-sbinPROGRAMS ctags distclean \
+	clean-pkglibPROGRAMS clean-sbinPROGRAMS clean-binPROGRAMS ctags distclean \
 	distclean-compile distclean-generic distclean-tags distdir dvi \
 	dvi-am html html-am info info-am install install-am \
 	install-data install-data-am install-exec install-exec-am \
 	install-info install-info-am install-man \
-	install-pkglibPROGRAMS install-sbinPROGRAMS install-strip \
+	install-pkglibPROGRAMS install-sbinPROGRAMS install-binPROGRAMS install-strip \
 	installcheck installcheck-am installdirs maintainer-clean \
 	maintainer-clean-generic mostlyclean mostlyclean-compile \
 	mostlyclean-generic pdf pdf-am ps ps-am tags uninstall \
 	uninstall-am uninstall-info-am uninstall-pkglibPROGRAMS \
-	uninstall-sbinPROGRAMS
+	uninstall-sbinPROGRAMS uninstall-binPROGRAMS
 
 # Tell versions [3.59,3.63) of GNU make to not export all variables.
 # Otherwise a system limit (for SysV at least) may be exceeded.
Index: utils/md5sum.1
===================================================================
RCS file: utils/md5sum.1
diff -N utils/md5sum.1
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ utils/md5sum.1	17 Mar 2006 02:29:34 -0000	1.1
@@ -0,0 +1,75 @@
+.\" Hey, Emacs!  This is an -*- nroff -*- source file.
+.TH MD5SUM 1 "29th November 1995" "Lankester et al" "Debian GNU/Linux"
+.SH NAME
+md5sum \- generates or checks MD5 message digests
+
+.SH SYNOPSIS
+.B md5sum
+[-bv] [-c [file]] | [file...]
+
+.SH DESCRIPTION
+.B md5sum
+generates or checks MD5 checksums. The algorithm to generate the
+checksum is reasonably fast and strong enough for most cases. Exact
+specification of the algorithm is in
+.I RFC 1321.
+
+Normally
+.B md5sum
+generates checksums of all files given to it as a parameter and prints
+the checksums followed by the filenames. If, however,
+.B -c
+is specified, only one filename parameter is allowed. This file should
+contain checksums and filenames to which these checksums refer to, and
+the files listed in that file are checked against the checksums listed
+there. See option
+.B -c
+for more information.
+
+.SS OPTIONS
+.TP
+.B -b
+Use binary mode. In unix environment, only difference between this and
+the normal mode is an asterix preceding the filename in the output.
+.TP
+.B -c
+Check md5sum of all files listed in
+.I file
+against the checksum listed in the same file. The actual format of that
+file is the same as output of
+.B md5sum.
+That is, each line in the file describes a file. A line looks like:
+
+.B <MD5 checksum>  <filename>
+
+So, for example, if a file was created and its message digest calculated
+like so:
+
+.B echo foo > md5-test-file; md5sum md5-test-file
+
+.B md5sum
+would report:
+
+.B d3b07384d113edec49eaa6238ad5ff00\  md5-test-file
+
+.TP
+.B -v
+Be more verbose. Print filenames when checking (with -c).
+
+.SH BUGS
+The related MD4 message digest algorithm was broken in October 1995.
+MD5 isn't looking as secure as it used to.
+
+This manpage is not quite accurate and has formatting inconsistent
+with other manpages.
+
+.B md5sum
+does not accept standard options like
+.BR --help .
+
+.SH AUTHOR
+
+.B md5sum
+was originally written by Branko Lankester, and modified afterwards by
+Colin Plumb and Ian Jackson (ijackson@gnu.ai.mit.edu). Manual page was
+added by Juho Vuori (javuori@cc.helsinki.fi)
Index: utils/md5sum.c
===================================================================
RCS file: utils/md5sum.c
diff -N utils/md5sum.c
--- /dev/null	1 Jan 1970 00:00:00 -0000
+++ utils/md5sum.c	17 Mar 2006 02:29:34 -0000	1.1
@@ -0,0 +1,312 @@
+/*
+ * md5sum.c	- Generate/check MD5 Message Digests
+ *
+ * Compile and link with md5.c.  If you don't have getopt() in your library
+ * also include getopt.c.  For MSDOS you can also link with the wildcard
+ * initialization function (wildargs.obj for Turbo C and setargv.obj for MSC)
+ * so that you can use wildcards on the commandline.
+ *
+ * Written March 1993 by Branko Lankester
+ * Modified June 1993 by Colin Plumb for altered md5.c.
+ * Modified Feburary 1995 by Ian Jackson for use with Colin Plumb's md5.c.
+ * Hacked (modified is too nice a word) January 1997 by Galen Hazelwood
+ *   to support GNU gettext.
+ * This file is in the public domain.
+ */
+
+#include "config.h"
+
+#include <stdio.h>
+#include <stdlib.h>
+#include <string.h>
+#include <getopt.h>
+#include <unistd.h>
+
+/* Take care of NLS matters.  */
+
+//#if HAVE_LOCALE_H
+//# include <locale.h>
+//#endif
+//#if !HAVE_SETLOCALE
+//# define setlocale(Category, Locale) /* empty */
+//#endif
+//
+//#if ENABLE_NLS
+//# include <libintl.h>
+//# define _(Text) gettext (Text)
+//#else
+//# undef bindtextdomain
+//# define bindtextdomain(Domain, Directory) /* empty */
+//# undef textdomain
+//# define textdomain(Domain) /* empty */
+//# define _(Text) Text
+//#endif
+
+#include <dpkg.h>
+
+#ifdef UNIX
+#define	FOPRTXT	"r"
+#define	FOPRBIN	"r"
+#else
+#ifdef VMS
+#define	FOPRTXT	"r","ctx=stm"
+#define	FOPRBIN	"rb","ctx=stm"
+#else
+#define	FOPRTXT	"r"
+#define	FOPRBIN	"rb"
+#endif
+#endif
+
+const char printforhelp[]= N_("Type md5sum --help for help.");
+const char thisname[]= "@PREFIX@/bin/md5sum";
+
+void usage(void) NONRETURNING;
+void print_digest(unsigned char *p);
+int mdfile(int fd, unsigned char **digest);
+int do_check(FILE *chkf);
+int hex_digit(int c);
+int get_md5_line(FILE *fp, unsigned char *digest, char *file);
+int process_arg(const char* arg, int bin_mode, unsigned char **digest);
+
+char *progname;
+int verbose = 0;
+int bin_mode = 0;
+
+static
+void
+print_md5sum_error(const char* emsg, const char* arg) {
+	fprintf(stderr, _("error processing %s: %s\n"), arg, emsg);
+}
+
+static void cu_closefile(int argc, void** argv) {
+	FILE *f = (FILE*)(argv[0]);
+	fclose(f);
+}
+
+int
+main(int argc, char **argv)
+{
+	jmp_buf ejbuf;
+	int opt, rc = 0;
+	int check = 0;
+	FILE *fp = NULL;
+	unsigned char *digest = NULL;
+
+	setlocale(LC_ALL, "");
+	bindtextdomain(PACKAGE, LOCALEDIR);
+	textdomain(PACKAGE);
+
+	progname = *argv;
+	while ((opt = getopt(argc, argv, "cbvp:h")) != EOF) {
+		switch (opt) {
+			case 'c': check = 1; break;
+			case 'v': verbose = 1; break;
+			case 'b': bin_mode = 1; break;
+			default: usage();
+		}
+	}
+	argc -= optind;
+	argv += optind;
+	if (check) {
+		switch (argc) {
+			case 0: fp = stdin; break;
+			case 1: if ((fp = fopen(*argv, FOPRTXT)) == NULL) {
+					perror(*argv);
+					exit(2);
+				}
+				break;
+			default: usage();
+		}
+		exit(do_check(fp));
+	}
+	if (argc == 0) {
+		if (setjmp(ejbuf)) {
+			error_unwind(ehflag_bombout);
+			exit(1);
+		}
+		push_error_handler(&ejbuf, print_md5sum_error, "stdin");
+
+		mdfile(fileno(stdin), &digest);
+		printf("%s %c-\n", digest, bin_mode ? '*' : ' ');
+		set_error_display(0, 0);
+		error_unwind(ehflag_normaltidy);
+		exit(0);
+	}
+	for ( ; argc > 0; --argc, ++argv) {
+		switch (process_arg(*argv, bin_mode, &digest)) {
+			case 1:
+				rc++;
+				break;
+			case 2:
+				perror(*argv);
+				rc++;
+				break;
+			case 3:
+				perror(*argv);
+				rc++;
+				break;
+			default:
+				printf("%s %c%s\n", digest, bin_mode ? '*' : ' ', *argv);
+		}
+	}
+	return rc;
+}
+
+int process_arg(const char* arg, int bin_mode, unsigned char **digest)
+{
+	jmp_buf ejbuf;
+	FILE *fp = NULL;
+
+	if (setjmp(ejbuf)) {
+		error_unwind(ehflag_bombout);
+		return 1;
+	}
+	push_error_handler(&ejbuf, print_md5sum_error, arg);
+	if (bin_mode)
+		fp = fopen(arg, FOPRBIN);
+	else
+		fp = fopen(arg, FOPRTXT);
+	if (fp == NULL)
+		return 2;
+	push_cleanup(cu_closefile,ehflag_bombout, 0,0, 1,(void*)fp);
+	if (mdfile(fileno(fp), digest)) {
+		fclose(fp);
+		return 3;
+	}
+	pop_cleanup(ehflag_normaltidy); /* fd= fopen() */
+	fclose(fp);
+	set_error_display(0, 0);
+	error_unwind(ehflag_normaltidy);
+	return 0;
+}
+
+void
+usage(void)
+{
+        fputs(_("usage: md5sum [-bv] [-c [file]] | [file...]\n\
+Generates or checks MD5 Message Digests\n\
+    -c  check message digests (default is generate)\n\
+    -v  verbose, print file names when checking\n\
+    -b  read files in binary mode\n\
+The input for -c should be the list of message digests and file names\n\
+that is printed on stdout by this program when it generates digests.\n"), stderr);
+	exit(2);
+}
+
+int
+mdfile(int fd, unsigned char **digest)
+{
+	off_t ret = fd_md5(fd, digest, -1, _("mdfile"));
+	if ( ret >= 0 )
+		return 0;
+	else
+		return ret;
+}
+
+int
+hex_digit(int c)
+{
+	if (c >= '0' && c <= '9')
+		return c - '0';
+	if (c >= 'a' && c <= 'f')
+		return c - 'a' + 10;
+	return -1;
+}
+
+int
+get_md5_line(FILE *fp, unsigned char *digest, char *file)
+{
+	char buf[1024];
+	int i, rc;
+	char *p = buf;
+
+	if (fgets(buf, sizeof(buf), fp) == NULL)
+		return -1;
+
+        /* A line must have: a digest (32), a separator (2), and a
+         * filename (at least 1)
+         *
+         * That means it must be at least 35 characters long.
+         */
+	if (strlen(buf) < 35)
+		return 0;
+
+	memcpy(digest, p, 32);
+	p += 32;
+	if (*p++ != ' ')
+		return 0;
+	/*
+	 * next char is an attribute char, space means text file
+	 * if it's a '*' the file should be checked in binary mode.
+	 */
+	if (*p == ' ')
+		rc = 1;
+	else if (*p == '*')
+		rc = 2;
+	else {
+		/* Don't print the buffer; we might be dealing with a
+		 * non-text file.
+		 */
+		fprintf(stderr, _("%s: unrecognized line\n"), progname);
+		return 0;
+	}
+	++p;
+	i = strlen(p);
+	if (i < 2 || i > 255)
+		return 0;
+
+        /* Strip the trailing newline, if present */
+        if (p[i-1] == '\n')
+          p[i-1] = '\0';
+
+	strcpy(file, p);
+	return rc;
+}
+
+int
+do_check(FILE *chkf)
+{
+	int rc, ex = 0, failed = 0, checked = 0;
+	unsigned char chk_digest[32], *file_digest = NULL;
+	char filename[256];
+	size_t flen = 14;
+
+	while ((rc = get_md5_line(chkf, chk_digest, filename)) >= 0) {
+		if (rc == 0)	/* not an md5 line */
+			continue;
+		if (verbose) {
+			if (strlen(filename) > flen)
+				flen = strlen(filename);
+			fprintf(stderr, "%-*s ", (int)flen, filename);
+		}
+		switch (process_arg(filename, bin_mode || rc == 2, &file_digest)) {
+			case 2:
+				fprintf(stderr, _("%s: can't open %s\n"), progname, filename);
+				ex = 2;
+				continue;
+			case 3:
+				fprintf(stderr, _("%s: error reading %s\n"), progname, filename);
+				ex = 2;
+				continue;
+		}
+		if (memcmp(chk_digest, file_digest, 32) != 0) {
+			if (verbose)
+				fprintf(stderr, _("FAILED\n"));
+			else
+				fprintf(stderr, _("%s: MD5 check failed for '%s'\n"), progname, filename);
+			++failed;
+		} else if (verbose)
+			fprintf(stderr, _("OK\n"));
+		++checked;
+	}
+	if (verbose && failed)
+		fprintf(stderr, _("%s: %d of %d file(s) failed MD5 check\n"), progname, failed, checked);
+	if (!checked) {
+		fprintf(stderr, _("%s: no files checked\n"), progname);
+		return 3;
+	}
+	if (!ex && failed)
+		ex = 1;
+	return ex;
+}
+
