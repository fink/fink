diff -urN dpkg-1.10.21.orig/Makefile.conf.in dpkg-1.10.21/Makefile.conf.in
--- dpkg-1.10.21.orig/Makefile.conf.in	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/Makefile.conf.in	2012-07-13 02:13:27.000000000 +0200
@@ -60,13 +60,13 @@
 
 CPPFLAGS		= @CPPFLAGS@
 LD			= @LD@
-LDFLAGS			= @LDFLAGS@ -L../lib -L../optlib
+LDFLAGS			= @LDFLAGS@ -L../lib -L../optlib -framework CoreFoundation
 LIBS			= @LIBS@ -ldpkg -lopt $(ZLIB_LIBS)
 
 RANLIB			= @RANLIB@
 
 DEFS			= @DEFS@ -D_GNU_SOURCE
-INCLUDE_CFLAGS		= -I$(top_srcdir)/include -I$(top_srcdir) -I$(srcdir) -I../include -I.. -I. -I$(top_srcdir)/optlib
+INCLUDE_CFLAGS		= -I$(top_srcdir)/include -I$(top_srcdir) -I$(srcdir) -I../include -I.. -I. -I$(top_srcdir)/optlib -F/System/Library/Frameworks/CoreFoundation.framework
 
 NLS_CFLAGS		= -DLOCALEDIR=\"$(localedir)\" -I$(top_srcdir)/intl -I../intl
 NLS_LIBS		= @INTLLIBS@ 
diff -urN dpkg-1.10.21.orig/dpkg-deb/Makefile.in dpkg-1.10.21/dpkg-deb/Makefile.in
--- dpkg-1.10.21.orig/dpkg-deb/Makefile.in	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/dpkg-deb/Makefile.in	2012-07-13 02:13:27.000000000 +0200
@@ -51,5 +51,5 @@
 dpkg-deb-static: LDFLAGS += -static
 dpkg-deb-static: ZLIB_LIBS = $(ZLIB_LIBS_ALSO_STATIC)
 dpkg-deb dpkg-deb-static: $(OBJECTS) ../lib/libdpkg.a
-	$(CC) $(LDFLAGS) -o $@ $(OBJECTS) $(LIBS) $(NLS_LIBS)
+	$(CC) $(LDFLAGS) $(EXEFLAGS) -o $@ $(OBJECTS) $(LIBS) $(NLS_LIBS)
 
diff -urN dpkg-1.10.21.orig/dpkg-deb/build.c dpkg-1.10.21/dpkg-deb/build.c
--- dpkg-1.10.21.orig/dpkg-deb/build.c	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/dpkg-deb/build.c	2012-07-13 02:13:27.000000000 +0200
@@ -275,9 +275,11 @@
       warns++;
     }
     for (field= checkedinfo->available.arbs; field; field= field->next) {
+	  if (strncmp("BuildDependsOnly",field->name,16)) {
       fprintf(stderr, _("warning, `%s' contains user-defined field `%s'\n"),
               controlfile, field->name);
       warns++;
+	  }
     }
     checkversion(checkedinfo->available.version.version,"(upstream) version",&errs);
     checkversion(checkedinfo->available.version.revision,"Debian revision",&errs);
@@ -445,7 +447,7 @@
     m_dup2(p1[0],0); close(p1[0]); close(p1[1]);
     m_dup2(p2[1],1); close(p2[0]); close(p2[1]);
     if (chdir(directory)) ohshite(_("failed to chdir to `%.255s'"),directory);
-    execlp(TAR,"tar","-cf", "-", "-T", "-", "--null", "--no-recursion", (char*)0);
+    execlp(TAR,"tar","-cf", "-", "--null", "-T", "-", "--no-recursion", (char*)0);
     ohshite(_("failed to exec tar -cf"));
   }
   close(p1[0]);
diff -urN dpkg-1.10.21.orig/dpkg-deb/build.c.orig dpkg-1.10.21/dpkg-deb/build.c.orig
--- dpkg-1.10.21.orig/dpkg-deb/build.c.orig	1970-01-01 01:00:00.000000000 +0100
+++ dpkg-1.10.21/dpkg-deb/build.c.orig	2012-07-13 02:13:27.000000000 +0200
@@ -0,0 +1,518 @@
+/*
+ * dpkg-deb - construction and deconstruction of *.deb archives
+ * build.c - building archives
+ *
+ * Copyright (C) 1994,1995 Ian Jackson <ian@chiark.greenend.org.uk>
+ * Copyright (C) 2000,2001 Wichert Akkerman <wakkerma@debian.org>
+ *
+ * This is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as
+ * published by the Free Software Foundation; either version 2,
+ * or (at your option) any later version.
+ *
+ * This is distributed in the hope that it will be useful, but
+ * WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public
+ * License along with dpkg; if not, write to the Free Software
+ * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
+ */
+
+#include <config.h>
+
+#include <stdio.h>
+#include <string.h>
+#include <stdlib.h>
+#include <signal.h>
+#include <sys/stat.h>
+#include <sys/types.h>
+#include <sys/wait.h>
+#include <time.h>
+#include <errno.h>
+#include <unistd.h>
+#include <dirent.h>
+#include <limits.h>
+#include <ctype.h>
+#include <assert.h>
+#ifdef USE_ZLIB
+#include <zlib.h>
+#endif
+
+#include <dpkg.h>
+#include <dpkg-db.h>
+#include "dpkg-deb.h"
+
+#ifndef S_ISLNK
+# define S_ISLNK(mode) ((mode&0xF000) == S_IFLNK)
+#endif
+
+/* Simple structure to store information about a file.
+ */
+struct _finfo {
+  struct stat	st;
+  char*	fn;
+  struct _finfo* next;
+};
+
+/* Do a quick check if vstring is a valid versionnumber. Valid in this case
+ * means it contains at least one digit. If an error is found increment
+ * *errs.
+ */
+static void checkversion(const char *vstring, const char *valuename, int *errs) {
+  const char *p;
+  if (!vstring || !*vstring) return;
+  for (p=vstring; *p; p++) if (cisdigit(*p)) return;
+  fprintf(stderr, _("dpkg-deb - error: %s (`%s') doesn't contain any digits\n"),
+          valuename, vstring);
+  (*errs)++;
+}
+
+/* Read the next filename from a filedescriptor and create a _info struct
+ * for it. If there is nothing to read return NULL.
+ */
+static struct _finfo* getfi(const char* root, int fd) {
+  static char* fn = NULL;
+  static size_t fnlen = 0;
+  size_t i= 0;
+  struct _finfo *fi;
+  size_t rl = strlen(root);
+
+  if (fn == NULL) {
+    fnlen=rl+2048;
+    fn=(char*)malloc(fnlen);
+  } else if (fnlen < (rl+2048)) {
+    fnlen=rl+2048;
+    fn=(char*)realloc(fn,fnlen);
+  }
+  i=sprintf(fn,"%s/",root);
+  
+  while (1) {
+    int	res;
+    if (i>=fnlen) {
+      fnlen+=2048;
+      fn=(char*)realloc(fn,fnlen);
+    }
+    if ((res=read(fd, (fn+i), sizeof(*fn)))<0) {
+      if ((errno==EINTR) || (errno==EAGAIN))
+	continue;
+      else
+	return NULL;
+    }
+    if (res==0)	// EOF -> parent died
+      return NULL;
+    if (fn[i]==0)
+      break;
+
+    i++;
+    assert(i<2048);
+  }
+
+  fi=(struct _finfo*)malloc(sizeof(struct _finfo));
+  lstat(fn, &(fi->st));
+  fi->fn=strdup(fn+rl+1);
+  fi->next=NULL;
+  return fi;
+}
+
+/* Add a new _finfo struct to a single linked list of _finfo structs.
+ * We perform a slight optimization to work around a `feature' in tar: tar
+ * always recurses into subdirectories if you list a subdirectory. So if an
+ * entry is added and the previous entry in the list is its subdirectory we
+ * remove the subdirectory. 
+ *
+ * After a _finfo struct is added to a list it may no longer be freed, we
+ * assume full responsibility for its memory.
+ */
+static void add_to_filist(struct _finfo* fi, struct _finfo** start, struct _finfo **end) {
+  if (*start==NULL)
+    *start=*end=fi;
+  else 
+    *end=(*end)->next=fi;
+}
+
+/* Free the memory for all entries in a list of _finfo structs
+ */
+static void free_filist(struct _finfo* fi) {
+  while (fi) {
+    struct _finfo* fl;
+    free(fi->fn);
+    fl=fi; fi=fi->next;
+    free(fl);
+  }
+}
+
+int internalGzip(int fd1, int fd2, const char *compression, char *desc, ...) NONRETURNING;
+int internalGzip(int fd1, int fd2, const char *compression, char *desc, ...) {
+  va_list al;
+  struct varbuf v;
+#ifdef USE_ZLIB
+  gzFile gzfile;
+  char gzbuffer[4096];
+  int gzactualwrite, actualread;
+#endif
+  char combuf[6];
+
+  varbufinit(&v);
+
+  va_start(al,desc);
+  varbufvprintf(&v, desc, al);
+  va_end(al);
+
+  
+  if(compression == NULL) compression= "9";
+  if(*compression == '0') {
+    fd_fd_copy(0, 1, -1, _("%s: no compression copy loop"), v.buf);
+    exit(0);
+  }
+#ifdef USE_ZLIB
+  strncpy(combuf, "w9", sizeof(combuf));
+  combuf[1]= *compression;
+  gzfile = gzdopen(1, combuf);
+  while((actualread = read(0,gzbuffer,sizeof(gzbuffer))) > 0) {
+    if (actualread < 0 ) {
+      if (errno == EINTR) continue;
+      ohshite(_("%s: internal gzip error: read: `%s'"), v.buf, strerror(errno));
+    }
+    gzactualwrite= gzwrite(gzfile,gzbuffer,actualread);
+    if (gzactualwrite < 0 ) {
+      int gzerr = 0;
+      const char *errmsg = gzerror(gzfile, &gzerr);
+      if (gzerr == Z_ERRNO) {
+        if (errno == EINTR) continue;
+        errmsg= strerror(errno);
+      }
+      ohshite(_("%s: internal gzip error: write: `%s'"), v.buf, errmsg);
+    }
+    if (gzactualwrite != actualread)
+      ohshite(_("%s: internal gzip error: read(%i) != write(%i)"), v.buf, actualread, gzactualwrite);
+  }
+  gzclose(gzfile);
+  exit(0);
+#else
+  strncpy(combuf, "-9c", sizeof(combuf));
+  combuf[1]= *compression;
+  execlp(GZIP,"gzip",combuf,(char*)0); ohshit(_("%s: failed to exec gzip %s"), v.buf, combuf);
+#endif
+}
+
+/* Overly complex function that builds a .deb file
+ */
+void do_build(const char *const *argv) {
+  static const char *const maintainerscripts[]= {
+    PREINSTFILE, POSTINSTFILE, PRERMFILE, POSTRMFILE, 0
+  };
+  
+  char *m;
+  const char *debar, *directory, *const *mscriptp, *versionstring, *arch;
+  char *controlfile, *tfbuf;
+  const char *envbuf;
+  struct pkginfo *checkedinfo;
+  struct arbitraryfield *field;
+  FILE *ar, *gz, *cf;
+  int p1[2],p2[2],p3[2], warns, errs, n, c, subdir, gzfd;
+  pid_t c1,c2,c3;
+  struct stat controlstab, datastab, mscriptstab, debarstab;
+  char conffilename[MAXCONFFILENAME+1];
+  time_t thetime= 0;
+  struct _finfo *fi;
+  struct _finfo *symlist = NULL;
+  struct _finfo *symlist_end = NULL;
+  
+/* Decode our arguments */
+  directory= *argv++; if (!directory) badusage(_("--build needs a directory argument"));
+  /* template for our tempfiles */
+  if ((envbuf= getenv("TMPDIR")) == NULL)
+    envbuf= P_tmpdir;
+  tfbuf = (char *)malloc(strlen(envbuf)+13);
+  strcpy(tfbuf,envbuf);
+  strcat(tfbuf,"/dpkg.XXXXXX");
+  subdir= 0;
+  if ((debar= *argv++) !=0) {
+    if (*argv) badusage(_("--build takes at most two arguments"));
+    if (debar) {
+      if (stat(debar,&debarstab)) {
+        if (errno != ENOENT)
+          ohshite(_("unable to check for existence of archive `%.250s'"),debar);
+      } else if (S_ISDIR(debarstab.st_mode)) {
+        subdir= 1;
+      }
+    }
+  } else {
+    m= m_malloc(strlen(directory) + sizeof(DEBEXT));
+    strcpy(m,directory); strcat(m,DEBEXT);
+    debar= m;
+  }
+    
+  /* Perform some sanity checks on the to-be-build package.
+   */
+  if (nocheckflag) {
+    if (subdir)
+      ohshit(_("target is directory - cannot skip control file check"));
+    printf(_("dpkg-deb: warning, not checking contents of control area.\n"
+           "dpkg-deb: building an unknown package in `%s'.\n"), debar);
+  } else {
+    controlfile= m_malloc(strlen(directory) + sizeof(BUILDCONTROLDIR) +
+                          sizeof(CONTROLFILE) + sizeof(CONFFILESFILE) +
+                          sizeof(POSTINSTFILE) + sizeof(PREINSTFILE) +
+                          sizeof(POSTRMFILE) + sizeof(PRERMFILE) +
+                          MAXCONFFILENAME + 5);
+    /* Lets start by reading in the control-file so we can check its contents */
+    strcpy(controlfile, directory);
+    strcat(controlfile, "/" BUILDCONTROLDIR "/" CONTROLFILE);
+    warns= 0; errs= 0;
+    parsedb(controlfile, pdb_recordavailable|pdb_rejectstatus,
+            &checkedinfo, stderr, &warns);
+    assert(checkedinfo->available.valid);
+    if (strspn(checkedinfo->name,
+               "abcdefghijklmnopqrstuvwxyz0123456789+-.")
+        != strlen(checkedinfo->name))
+      ohshit(_("package name has characters that aren't lowercase alphanums or `-+.'"));
+    if (checkedinfo->priority == pri_other) {
+      fprintf(stderr, _("warning, `%s' contains user-defined Priority value `%s'\n"),
+              controlfile, checkedinfo->otherpriority);
+      warns++;
+    }
+    for (field= checkedinfo->available.arbs; field; field= field->next) {
+	  if (strncmp("BuildDependsOnly",field->name,16)) {
+      fprintf(stderr, _("warning, `%s' contains user-defined field `%s'\n"),
+              controlfile, field->name);
+      warns++;
+	  }
+    }
+    checkversion(checkedinfo->available.version.version,"(upstream) version",&errs);
+    checkversion(checkedinfo->available.version.revision,"Debian revision",&errs);
+    if (errs) ohshit(_("%d errors in control file"),errs);
+
+    if (subdir) {
+      versionstring= versiondescribe(&checkedinfo->available.version,vdew_never);
+      arch= checkedinfo->available.architecture; if (!arch) arch= "";
+      m= m_malloc(sizeof(DEBEXT)+1+strlen(debar)+1+strlen(checkedinfo->name)+
+                  strlen(versionstring)+1+strlen(arch));
+      sprintf(m,"%s/%s_%s%s%s" DEBEXT,debar,checkedinfo->name,versionstring,
+              arch[0] ? "_" : "", arch);
+      debar= m;
+    }
+    printf(_("dpkg-deb: building package `%s' in `%s'.\n"), checkedinfo->name, debar);
+
+    /* Check file permissions */
+    strcpy(controlfile, directory);
+    strcat(controlfile, "/" BUILDCONTROLDIR "/");
+    if (lstat(controlfile,&mscriptstab)) ohshite("unable to stat control directory");
+    if (!S_ISDIR(mscriptstab.st_mode)) ohshit("control directory is not a directory");
+    if ((mscriptstab.st_mode & 07757) != 0755)
+      ohshit(_("control directory has bad permissions %03lo (must be >=0755 "
+             "and <=0775)"), (unsigned long)(mscriptstab.st_mode & 07777));
+
+    for (mscriptp= maintainerscripts; *mscriptp; mscriptp++) {
+      strcpy(controlfile, directory);
+      strcat(controlfile, "/" BUILDCONTROLDIR "/");
+      strcat(controlfile, *mscriptp);
+
+      if (!lstat(controlfile,&mscriptstab)) {
+        if (S_ISLNK(mscriptstab.st_mode)) continue;
+        if (!S_ISREG(mscriptstab.st_mode))
+          ohshit(_("maintainer script `%.50s' is not a plain file or symlink"),*mscriptp);
+        if ((mscriptstab.st_mode & 07557) != 0555)
+          ohshit(_("maintainer script `%.50s' has bad permissions %03lo "
+                 "(must be >=0555 and <=0775)"),
+                 *mscriptp, (unsigned long)(mscriptstab.st_mode & 07777));
+      } else if (errno != ENOENT) {
+        ohshite(_("maintainer script `%.50s' is not stattable"),*mscriptp);
+      }
+    }
+
+    /* Check if conffiles contains sane information */
+    strcpy(controlfile, directory);
+    strcat(controlfile, "/" BUILDCONTROLDIR "/" CONFFILESFILE);
+    if ((cf= fopen(controlfile,"r"))) {
+      while (fgets(conffilename,MAXCONFFILENAME+1,cf)) {
+        n= strlen(conffilename);
+        if (!n) ohshite(_("empty string from fgets reading conffiles"));
+        if (conffilename[n-1] != '\n') {
+          fprintf(stderr, _("warning, conffile name `%.50s...' is too long, or missing final newline\n"), 
+		  conffilename);
+          warns++;
+          while ((c= getc(cf)) != EOF && c != '\n');
+          continue;
+        }
+        conffilename[n-1]= 0;
+        strcpy(controlfile, directory);
+        strcat(controlfile, "/");
+        strcat(controlfile, conffilename);
+        if (lstat(controlfile,&controlstab)) {
+          if (errno == ENOENT)
+            ohshit(_("conffile `%.250s' does not appear in package"),conffilename);
+          else
+            ohshite(_("conffile `%.250s' is not stattable"),conffilename);
+        } else if (!S_ISREG(controlstab.st_mode)) {
+          fprintf(stderr, _("warning, conffile `%s'"
+                  " is not a plain file\n"), conffilename);
+          warns++;
+        }
+      }
+      if (ferror(cf)) ohshite(_("error reading conffiles file"));
+      fclose(cf);
+    } else if (errno != ENOENT) {
+      ohshite(_("error opening conffiles file"));
+    }
+    if (warns) {
+      if (fprintf(stderr, _("dpkg-deb: ignoring %d warnings about the control"
+                  " file(s)\n"), warns) == EOF) werr("stderr");
+    }
+  }
+  if (ferror(stdout)) werr("stdout");
+  
+  /* Now that we have verified everything its time to actually
+   * build something. Lets start by making the ar-wrapper.
+   */
+  if (!(ar=fopen(debar,"wb"))) ohshite(_("unable to create `%.255s'"),debar);
+  if (setvbuf(ar, 0, _IONBF, 0)) ohshite(_("unable to unbuffer `%.255s'"),debar);
+  /* Fork a tar to package the control-section of the package */
+  m_pipe(p1);
+  if (!(c1= m_fork())) {
+    m_dup2(p1[1],1); close(p1[0]); close(p1[1]);
+    if (chdir(directory)) ohshite(_("failed to chdir to `%.255s'"),directory);
+    if (chdir(BUILDCONTROLDIR)) ohshite(_("failed to chdir to .../DEBIAN"));
+    execlp(TAR,"tar","-cf","-",".",(char*)0); ohshite(_("failed to exec tar -cf"));
+  }
+  close(p1[1]);
+  /* Create a temporary file to store the control data in. Immediately unlink
+   * our temporary file so others can't mess with it.
+   */
+  if ((gzfd= mkstemp(tfbuf)) == -1) ohshite(_("failed to make tmpfile (control)"));
+  if ((gz= fdopen(gzfd,"a")) == NULL) ohshite(_("failed to open tmpfile "
+      "(control), %s"), tfbuf);
+  /* make sure it's gone, the fd will remain until we close it */
+  if (unlink(tfbuf)) ohshit(_("failed to unlink tmpfile (control), %s"),
+      tfbuf);
+  /* reset this, so we can use it elsewhere */
+  strcpy(tfbuf,envbuf);
+  strcat(tfbuf,"/dpkg.XXXXXX");
+  /* And run gzip to compress our control archive */
+  if (!(c2= m_fork())) {
+    m_dup2(p1[0],0); m_dup2(gzfd,1); close(p1[0]); close(gzfd);
+    internalGzip(0, 1, "9", _("control"));
+  }
+  close(p1[0]);
+  waitsubproc(c2,"gzip -9c",0);
+  waitsubproc(c1,"tar -cf",0);
+  if (fstat(gzfd,&controlstab)) ohshite(_("failed to fstat tmpfile (control)"));
+  /* We have our first file for the ar-archive. Write a header for it to the
+   * package and insert it.
+   */
+  if (oldformatflag) {
+    if (fprintf(ar, "%-8s\n%ld\n", OLDARCHIVEVERSION, (long)controlstab.st_size) == EOF)
+      werr(debar);
+  } else {
+    thetime= time(0);
+    if (fprintf(ar,
+                "!<arch>\n"
+                "debian-binary   %-12lu0     0     100644  %-10ld`\n"
+                ARCHIVEVERSION "\n"
+                "%s"
+                ADMINMEMBER "%-12lu0     0     100644  %-10ld`\n",
+                thetime,
+                (long)sizeof(ARCHIVEVERSION),
+                (sizeof(ARCHIVEVERSION)&1) ? "\n" : "",
+                (unsigned long)thetime,
+                (long)controlstab.st_size) == EOF)
+      werr(debar);
+  }                
+                
+  if (lseek(gzfd,0,SEEK_SET)) ohshite(_("failed to rewind tmpfile (control)"));
+  fd_fd_copy(gzfd, fileno(ar), -1, _("control"));
+
+  /* Control is done, now we need to archive the data. Start by creating
+   * a new temporary file. Immediately unlink the temporary file so others
+   * can't mess with it. */
+  if (!oldformatflag) {
+    fclose(gz);
+    if ((gzfd= mkstemp(tfbuf)) == -1) ohshite(_("failed to make tmpfile (data)"));
+    if ((gz= fdopen(gzfd,"a")) == NULL) ohshite(_("failed to open tmpfile "
+        "(data), %s"), tfbuf);
+    /* make sure it's gone, the fd will remain until we close it */
+    if (unlink(tfbuf)) ohshit(_("failed to unlink tmpfile (data), %s"),
+        tfbuf);
+    /* reset these, in case we want to use the later */
+    strcpy(tfbuf,envbuf);
+    strcat(tfbuf,"/dpkg.XXXXXX");
+  }
+  /* Fork off a tar. We will feed it a list of filenames on stdin later.
+   */
+  m_pipe(p1);
+  m_pipe(p2);
+  if (!(c1= m_fork())) {
+    m_dup2(p1[0],0); close(p1[0]); close(p1[1]);
+    m_dup2(p2[1],1); close(p2[0]); close(p2[1]);
+    if (chdir(directory)) ohshite(_("failed to chdir to `%.255s'"),directory);
+    execlp(TAR,"tar","-cf", "-", "-T", "-", "--null", "--no-recursion", (char*)0);
+    ohshite(_("failed to exec tar -cf"));
+  }
+  close(p1[0]);
+  close(p2[1]);
+  /* Of course we should not forget to compress the archive as well.. */
+  if (!(c2= m_fork())) {
+    close(p1[1]);
+    m_dup2(p2[0],0); close(p2[0]);
+    m_dup2(oldformatflag ? fileno(ar) : gzfd,1);
+    internalGzip(0, 1, compression, _("control"));
+  }
+  close(p2[0]);
+  /* All the pipes are set, now lets run find, and start feeding
+   * filenames to tar.
+   */
+
+  m_pipe(p3);
+  if (!(c3= m_fork())) {
+    m_dup2(p3[1],1); close(p3[0]); close(p3[1]);
+    if (chdir(directory)) ohshite(_("failed to chdir to `%.255s'"),directory);
+    execlp(FIND,"find",".","-path","./" BUILDCONTROLDIR,"-prune","-o","-print0",(char*)0);
+    ohshite(_("failed to exec find"));
+  }
+  close(p3[1]);
+  /* We need to reorder the files so we can make sure that symlinks
+   * will not appear before their target.
+   */
+  while ((fi=getfi(directory, p3[0]))!=NULL)
+    if (S_ISLNK(fi->st.st_mode))
+      add_to_filist(fi,&symlist,&symlist_end);
+    else {
+      if (write(p1[1], fi->fn, strlen(fi->fn)+1) ==- 1)
+	ohshite(_("failed to write filename to tar pipe (data)"));
+    }
+  close(p3[0]);
+  waitsubproc(c3,"find",0);
+
+  for (fi= symlist;fi;fi= fi->next)
+    if (write(p1[1], fi->fn, strlen(fi->fn)+1) == -1)
+      ohshite(_("failed to write filename to tar pipe (data)"));
+  /* All done, clean up wait for tar and gzip to finish their job */
+  close(p1[1]);
+  free_filist(symlist);
+  waitsubproc(c2,"gzip -9c from tar -cf",0);
+  waitsubproc(c1,"tar -cf",0);
+  /* Okay, we have data.tar.gz as well now, add it to the ar wrapper */
+  if (!oldformatflag) {
+    if (fstat(gzfd,&datastab)) ohshite("_(failed to fstat tmpfile (data))");
+    if (fprintf(ar,
+                "%s"
+                DATAMEMBER "%-12lu0     0     100644  %-10ld`\n",
+                (controlstab.st_size & 1) ? "\n" : "",
+                (unsigned long)thetime,
+                (long)datastab.st_size) == EOF)
+      werr(debar);
+
+    if (lseek(gzfd,0,SEEK_SET)) ohshite(_("failed to rewind tmpfile (data)"));
+    fd_fd_copy(gzfd, fileno(ar), -1, _("cat (data)"));
+
+    if (datastab.st_size & 1)
+      if (putc('\n',ar) == EOF)
+        werr(debar);
+  }
+  if (fclose(ar)) werr(debar);
+                             
+  exit(0);
+}
+
diff -urN dpkg-1.10.21.orig/dpkg-deb/dpkg-deb.1 dpkg-1.10.21/dpkg-deb/dpkg-deb.1
--- dpkg-1.10.21.orig/dpkg-deb/dpkg-deb.1	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/dpkg-deb/dpkg-deb.1	2012-07-13 02:13:27.000000000 +0200
@@ -244,7 +244,8 @@
 Copyright (C)1995-1996
 by him and released under the GNU General Public Licence; there is NO
 WARRANTY.  See
-.B /usr/share/doc/dpkg/copyright
+.B @PREFIX@/share/doc/dpkg/copyright
 and
-.B /usr/share/common-licenses/GPL
+.B @PREFIX@/share/common-licenses/GPL
 for details.
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
diff -urN dpkg-1.10.21.orig/dselect/Makefile.in dpkg-1.10.21/dselect/Makefile.in
--- dpkg-1.10.21.orig/dselect/Makefile.in	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/dselect/Makefile.in	2012-07-13 02:13:27.000000000 +0200
@@ -47,7 +47,7 @@
 	done
 
 dselect: $(OBJECTS) ../lib/libdpkg.a
-	$(CXX) $(LDFLAGS) -o $@ $(OBJECTS) $(CURSES_LIBS) $(LIBS) $(NLS_LIBS)
+	$(CXX) $(LDFLAGS) $(EXEFLAGS) -o $@ $(OBJECTS) $(CURSES_LIBS) $(LIBS) $(NLS_LIBS)
 
 basecmds.o: helpmsgs.h
 curkeys.o: curkeys.h
diff -urN dpkg-1.10.21.orig/dselect/dselect.8 dpkg-1.10.21/dselect/dselect.8
--- dpkg-1.10.21.orig/dselect/dselect.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/dselect/dselect.8	2012-07-13 02:13:27.000000000 +0200
@@ -34,7 +34,7 @@
 of \fBdselect\fP or show additional information about the program.
 .SH OPTIONS 
 All options can be specified both on the commandline and in the \fBdselect\fP 
-configuration file \fI/etc/dpkg/dselect.cfg\fP. Each line in the 
+configuration file \fI@PREFIX@/etc/dpkg/dselect.cfg\fP. Each line in the 
 configuration file is either an option (exactly the same as the
 commandline option but without leading dashes) or a comment (if it starts
 with a \fB#\fR).
@@ -42,7 +42,7 @@
 .TP
 .B --admindir <directory>
 Changes the directory where the dpkg `status', `available' and similar
-files are located. This defaults to \fI/var/lib/dpkg\fP
+files are located. This defaults to \fI@PREFIX@/var/lib/dpkg\fP
 and normally there shouldn't be any need to change it.
 .TP
 .B --debug <file> | -D<file>
@@ -437,4 +437,5 @@
 .br
 This manual page was written by Juho Vuori <javuori@cc.helsinki.fi>,
 Josip Rodin and Joost kooij.
-
+.br
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
diff -urN dpkg-1.10.21.orig/dselect/main.cc dpkg-1.10.21/dselect/main.cc
--- dpkg-1.10.21.orig/dselect/main.cc	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/dselect/main.cc	2012-07-13 02:13:27.000000000 +0200
@@ -43,6 +43,11 @@
 #include <dpkg-db.h>
 #include <version.h>
 #include <myopt.h>
+/* FINK LOCAL begin */
+#include <sys/utsname.h>
+#include <CoreFoundation/CoreFoundation.h>
+static void finkinit();
+/* FINK LOCAL end */
 }
 #include "dselect.h"
 #include "bindings.h"
@@ -466,6 +471,155 @@
   return urqr_quitmenu;
   /* fixme: check packages OK */
 }
+/* FINK LOCAL begin */
+extern "C" {
+struct FinkVirtualPkgs {
+  struct FinkVirtualPkgs *next;
+  char *pkgname;
+  struct versionrevision version;
+};
+
+struct FinkVirtualPkgs *fink_virt_pkg = NULL;
+}
+static void finkinit()
+{
+	FILE *virt_pkg_stream = NULL;
+	struct stat sb;
+	struct FinkVirtualPkgs *pkg;
+	char name[256];
+	char version[256];
+	char revision[256];
+	unsigned int  epoch;
+    Boolean status;
+    SInt32 errorCode;
+    CFURLRef fileURL = NULL;
+    CFDataRef resourceData = NULL;
+    CFPropertyListRef propertyList = NULL;
+    CFStringRef string;
+    static char buffer[256];	// This is static, to ensure the buffer stays around
+
+    static struct utsname ver;	// This is static, to ensure the buffer stays around
+	if (0 == stat("@PREFIX@/bin/fink-virtual-pkgs", &sb))
+	{
+	  virt_pkg_stream =popen("@PREFIX@/bin/fink-virtual-pkgs --dpkg","r");
+  	  if (virt_pkg_stream)
+	  {
+	    while (fscanf(virt_pkg_stream,"%s\t%u\t%s\t%s\n",name,&epoch,version, revision) == 4)
+	    {
+	      pkg = (struct FinkVirtualPkgs *)malloc(sizeof(struct FinkVirtualPkgs));
+	      if (pkg)
+	      {
+			  pkg->next = fink_virt_pkg;
+			  pkg->pkgname = strdup(name);
+			  pkg->version.epoch = epoch;
+			  pkg->version.version = strdup(version);
+			  pkg->version.revision = strdup(revision);
+			  /* Quick and simple sanity check */
+			  if ((NULL != pkg->pkgname) && (0 != strlen(pkg->pkgname)) &&
+			      (NULL != pkg->version.version) && (0 != strlen(pkg->version.version)) &&
+			      (NULL != pkg->version.revision) && (0 != strlen(pkg->version.revision)))
+			  {
+			  	/* We are leaking here if something fails the sanity check above */
+			  	fink_virt_pkg = pkg;
+			  }
+	      }
+	    }
+	    if (pclose(virt_pkg_stream))
+	    {
+	    	/* The fink-virtual-pkgs script returned a non zero exit status *
+	    	 * clean up and try the old way.                                */
+	    	while(NULL != fink_virt_pkg)
+	    	{
+	    		pkg = fink_virt_pkg;
+	    		if (NULL != pkg->pkgname) free(pkg->pkgname);
+	    		if (NULL != pkg->version.version) free((void*)pkg->version.version);
+	    		if (NULL != pkg->version.revision) free((void*)pkg->version.revision);
+	    		fink_virt_pkg = pkg->next;
+	    		free(pkg);
+	    	}
+	    }
+	  }
+	} 
+	if (NULL == fink_virt_pkg)
+	{
+	  /* Determine system version */
+	  /* TODO - should maybe check if this is really Darwin? */
+	  if (!uname(&ver)) {
+	      pkg = (struct FinkVirtualPkgs *)malloc(sizeof(struct FinkVirtualPkgs));
+	      if (pkg) {
+			  pkg->next = fink_virt_pkg;
+			  pkg->pkgname = strdup("darwin");
+			  pkg->version.epoch = 0;
+			  pkg->version.version = ver.release;
+			  pkg->version.revision = NULL;
+			  fink_virt_pkg = pkg;
+	      }  
+	  }
+	
+	  /* Check whether this is Mac OS X, and which version of it */
+
+	  fileURL = CFURLCreateWithFileSystemPath( NULL, 	
+			CFSTR("/System/Library/CoreServices/SystemVersion.plist"),
+			kCFURLPOSIXPathStyle,				
+			false );
+	  if (!fileURL)
+		goto BAIL;
+	  
+	  /* Read the XML */
+	  status = CFURLCreateDataAndPropertiesFromResource(
+			NULL,
+			fileURL,
+			&resourceData,
+			NULL,		
+			NULL,
+			&errorCode);
+	  if (!status || errorCode != 0)
+		goto BAIL;
+	  
+	  /* Reconstitute the dictionary using the XML data. */
+	  propertyList = CFPropertyListCreateFromXMLData( NULL,
+			resourceData,
+			kCFPropertyListImmutable,
+			&string);
+	  if (!propertyList)
+		goto BAIL;
+	  
+	  /* Try to read the system version from it. */
+	  status = CFDictionaryGetValueIfPresent( 
+			(CFDictionaryRef)propertyList,
+			(const void*)CFSTR("ProductVersion"),
+			(const void**)&string);
+	  if (!status)
+		goto BAIL;
+	  
+	  /* Convert into a C string */
+	  status = CFStringGetCString( string,
+			buffer,
+			sizeof(buffer),
+			kCFStringEncodingISOLatin1);
+	  if (!status)
+		goto BAIL;
+	  pkg = (struct FinkVirtualPkgs *)malloc(sizeof(struct FinkVirtualPkgs));
+	  if (pkg)
+	  {
+		  pkg->next = fink_virt_pkg;
+		  pkg->pkgname = strdup("macosx");
+		  pkg->version.epoch = 0;
+		  pkg->version.version = buffer;
+		  pkg->version.revision = NULL;
+		  fink_virt_pkg = pkg;
+	  }
+	BAIL:
+	  // Release all of the CF objects we're responsible for.
+	  if (fileURL)
+		CFRelease(fileURL);
+	  if (resourceData)
+		CFRelease(resourceData);
+	  if (propertyList)
+		CFRelease(propertyList);
+	}
+}
+/* FINK LOCAL end */
 
 int main(int, const char *const *argv) {
   jmp_buf ejbuf;
@@ -473,7 +627,9 @@
   setlocale(LC_ALL, "");
   bindtextdomain(PACKAGE, LOCALEDIR);
   textdomain(PACKAGE);
-
+  /* FINK LOCAL begin */
+  finkinit();
+  /* FINK LOCAL end */
   if (setjmp(ejbuf)) { /* expect warning about possible clobbering of argv */
     cursesoff();
     error_unwind(ehflag_bombout); exit(2);
diff -urN dpkg-1.10.21.orig/dselect/pkgdepcon.cc dpkg-1.10.21/dselect/pkgdepcon.cc
--- dpkg-1.10.21.orig/dselect/pkgdepcon.cc	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/dselect/pkgdepcon.cc	2012-07-13 02:13:27.000000000 +0200
@@ -198,12 +198,20 @@
 
   return 2;
 }
-
+/* FINK LOCAL begin */
+extern "C" {
+struct FinkVirtualPkgs {
+  struct FinkVirtualPkgs *next;
+  char *pkgname;
+  struct versionrevision version;
+};
+extern struct FinkVirtualPkgs *fink_virt_pkg;
+}
+/* FINK LOCAL end */
 int packagelist::resolvedepcon(dependency *depends) {
   perpackagestate *best, *fixbyupgrade;
   deppossi *possi, *provider;
   int r, foundany;
-
   if (depdebug && debug) {
     fprintf(debug,"packagelist[%p]::resolvedepcon([%p] %s --%s-->",
           this,depends,depends->up->name,gettext(relatestrings[depends->type]));
@@ -214,7 +222,7 @@
             ? gettext(wantstrings[depends->up->clientdata->suggested])
             : _("(no clientdata)"));
   }
-  
+
   if (!depends->up->clientdata) return 0;
 
   switch (depends->type) {
@@ -354,7 +362,28 @@
 int packagelist::deppossatisfied(deppossi *possi, perpackagestate **fixbyupgrade) {
   int would;
   pkginfo::pkgwant want= pkginfo::want_purge;
-  
+/* FINK LOCAL begin */
+  {
+      int interestingwarnings;
+      struct varbuf oemsgs;
+      struct FinkVirtualPkgs *virt_pkg = NULL; 
+      varbufinit(&oemsgs);
+      interestingwarnings= 0;
+      virt_pkg = fink_virt_pkg;
+      while (virt_pkg)
+      {
+            if (0==strcmp(possi->ed->name,virt_pkg->pkgname)) {
+            if (depdebug && debug)
+                fprintf(debug,"Found package : %s from VirtPackages.pm, depended by %s\n",virt_pkg->pkgname, possi->up->up->name);
+            if (versionsatisfied3(&virt_pkg->version,&possi->version,possi->verrel))
+            {
+                return 1;
+            }
+            }
+        virt_pkg = virt_pkg->next;
+      }
+  }    
+// FINK_LOCAL_END      
   if (possi->ed->clientdata) {
     want= possi->ed->clientdata->selected;
     would= would_like_to_install(want,possi->ed);
@@ -413,5 +442,6 @@
         *fixbyupgrade= provider->up->up->clientdata;
     }
   }
+
   return 0;
 }
diff -urN dpkg-1.10.21.orig/include/dpkg.h.in dpkg-1.10.21/include/dpkg.h.in
--- dpkg-1.10.21.orig/include/dpkg.h.in	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/include/dpkg.h.in	2012-07-13 02:13:27.000000000 +0200
@@ -96,7 +96,7 @@
 #define SHELLENV            "SHELL"
 #define DEFAULTSHELL        "sh"
 #define PAGERENV            "PAGER"
-#define DEFAULTPAGER        "pager"
+#define DEFAULTPAGER        "less"
 
 #define IMETHODMAXLEN        50
 #define IOPTIONMAXLEN        IMETHODMAXLEN
@@ -118,13 +118,13 @@
 
 #define ARCHIVE_FILENAME_PATTERN "*.deb"
 
-#define BACKEND		"dpkg-deb"
-#define DPKGQUERY	"dpkg-query"
-#define SPLITTER	"dpkg-split"
-#define MD5SUM		"md5sum"
-#define DSELECT		"dselect"
-#define DPKG		"dpkg"
-#define DEBSIGVERIFY	"/usr/bin/debsig-verify"
+#define BACKEND		"@PREFIX@/bin/dpkg-deb"
+#define DPKGQUERY	"@PREFIX@/bin/dpkg-query"
+#define SPLITTER	"@PREFIX@/bin/dpkg-split"
+#define MD5SUM		"@PREFIX@/bin/md5sum"
+#define DSELECT		"@PREFIX@/bin/dselect"
+#define DPKG		"@PREFIX@/bin/dpkg"
+#define DEBSIGVERIFY	"@PREFIX@/bin/debsig-verify"
 
 #define TAR		"tar"
 #define GZIP		"gzip"
diff -urN dpkg-1.10.21.orig/include/parsedump.h dpkg-1.10.21/include/parsedump.h
--- dpkg-1.10.21.orig/include/parsedump.h	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/include/parsedump.h	2012-07-13 02:13:27.000000000 +0200
@@ -30,7 +30,6 @@
   const char *canon;
 };
 
-extern const struct fieldinfo fieldinfos[];
 extern const struct nickname nicknames[];
 extern const int nfields; /* = elements in fieldinfos, including the sentinels */
 
@@ -68,6 +67,8 @@
   unsigned int integer;
 };
 
+extern const struct fieldinfo fieldinfos[];
+
 void parseerr(FILE *file, const char *filename, int lno, FILE *warnto, int *warncount,
               const struct pkginfo *pigp, int warnonly,
               const char *fmt, ...) PRINTFFORMAT(8,9);
diff -urN dpkg-1.10.21.orig/lib/mlib.c dpkg-1.10.21/lib/mlib.c
--- dpkg-1.10.21.orig/lib/mlib.c	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/lib/mlib.c	2012-07-13 02:13:27.000000000 +0200
@@ -110,7 +110,9 @@
   if (WIFEXITED(status)) {
     n= WEXITSTATUS(status); if (!n) return n;
     if(!(flags & PROCNOERR)) {
-      if(flags & PROCWARN)
+      /* FINK LOCAL: Tar status 1 is a warning. */
+      if((flags & PROCWARN) || (n == 1 && strncmp(description, "tar", 3) == 0))
+      /* FINK LOCAL */
         fprintf(stderr, _("dpkg: warning - %s returned error exit status %d\n"),description,n);
       else
         ohshit(_("subprocess %s returned error exit status %d"),description,n);
@@ -189,7 +191,7 @@
   switch(data->type) {
     case BUFFER_WRITE_BUF:
       memcpy(data->data.ptr, buf, length);
-      (char*)data->data.ptr += length;
+      data->data.ptr = (char*)data->data.ptr + length;
       break;
     case BUFFER_WRITE_VBUF:
       varbufaddbuf((struct varbuf *)data->data.ptr, buf, length);
diff -urN dpkg-1.10.21.orig/lib/nfmalloc.c dpkg-1.10.21/lib/nfmalloc.c
--- dpkg-1.10.21.orig/lib/nfmalloc.c	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/lib/nfmalloc.c	2012-07-13 02:13:27.000000000 +0200
@@ -26,7 +26,7 @@
 #include <dpkg.h>
 #include <dpkg-db.h>
 
-#include <obstack.h>
+#include "obstack.h"
 
 #define obstack_chunk_alloc m_malloc
 #define obstack_chunk_free free
diff -urN dpkg-1.10.21.orig/lib/tarfn.c dpkg-1.10.21/lib/tarfn.c
--- dpkg-1.10.21.orig/lib/tarfn.c	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/lib/tarfn.c	2012-07-13 02:13:27.000000000 +0200
@@ -57,8 +57,12 @@
 {
 	int	len;
 	char *	str;
-
-	len = strnlen(s, size);
+	char * cpystr;
+	cpystr = malloc(size +1);
+	memcpy(cpystr, s, size);
+	cpystr[size] = 0;
+	len = strlen(cpystr);
+	free(cpystr);
 	str = malloc(len + 1);
 	memcpy(str, s, len);
 	str[len] = 0;
diff -urN dpkg-1.10.21.orig/main/Makefile.in dpkg-1.10.21/main/Makefile.in
--- dpkg-1.10.21.orig/main/Makefile.in	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/main/Makefile.in	2012-07-13 02:13:27.000000000 +0200
@@ -63,10 +63,10 @@
 dpkg-static: LDFLAGS += -static
 dpkg-static: ZLIB_LIBS = $(ZLIBS_LIBS_ALSO_STATIC)
 dpkg dpkg-static: $(OBJECTS) ../lib/libdpkg.a
-	$(CC) $(LDFLAGS) -o $@ $(OBJECTS) $(LIBS) $(NLS_LIBS)
+	$(CC) $(LDFLAGS) $(EXEFLAGS) -o $@ $(OBJECTS) $(LIBS) $(NLS_LIBS)
 
 dpkg-query: $(QUERY_OBJECTS) ../lib/libdpkg.a
-	$(CC) $(LDFLAGS) -o $@ $(QUERY_OBJECTS) $(LIBS) $(NLS_LIBS)
+	$(CC) $(LDFLAGS) $(EXEFLAGS) -o $@ $(QUERY_OBJECTS) $(LIBS) $(NLS_LIBS)
 
 enquiry.o: archtable.h
 
diff -urN dpkg-1.10.21.orig/main/archives.c dpkg-1.10.21/main/archives.c
--- dpkg-1.10.21.orig/main/archives.c	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/main/archives.c	2012-07-13 02:13:27.000000000 +0200
@@ -553,12 +553,10 @@
     debug(dbg_eachfiledetail,"tarobject SymbolicLink creating");
 #ifdef HAVE_LCHOWN
     if (lchown(fnamenewvb.buf,
-#else
-    if (chown(fnamenewvb.buf,
-#endif
 	    nifd->namenode->statoverride ? nifd->namenode->statoverride->uid : ti->UserID,
 	    nifd->namenode->statoverride ? nifd->namenode->statoverride->gid : ti->GroupID))
       ohshite(_("error setting ownership of symlink `%.255s'"),ti->Name);
+#endif
     break;
   case Directory:
     /* We've already checked for an existing directory. */
@@ -614,10 +612,8 @@
         ohshite(_("unable to make backup symlink for `%.255s'"),ti->Name);
 #ifdef HAVE_LCHOWN
       if (lchown(fnametmpvb.buf,stab.st_uid,stab.st_gid))
-#else
-      if (chown(fnametmpvb.buf,stab.st_uid,stab.st_gid))
-#endif
         ohshite(_("unable to chown backup symlink for `%.255s'"),ti->Name);
+#endif
     } else {
       debug(dbg_eachfiledetail,"tarobject nondirectory, `link' backup");
       if (link(fnamevb.buf,fnametmpvb.buf))
diff -urN dpkg-1.10.21.orig/main/configure.c dpkg-1.10.21/main/configure.c
--- dpkg-1.10.21.orig/main/configure.c	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/main/configure.c	2012-07-13 02:13:27.000000000 +0200
@@ -476,9 +476,10 @@
 static void suspend(void) {
 	const char*	s;
 	int		pid;
-
+#ifndef __APPLE__
 	s= getenv(NOJOBCTRLSTOPENV);
 	if (s && *s) {
+#endif
 		/* Do not job control to suspend but fork and start a new shell
 		 * instead.
 		 */
@@ -506,11 +507,13 @@
 			onerr_abort++;
 			ohshite(_("wait for shell failed"));
 		}
+#ifndef __APPLE__
 	} else {
 		fputs(_("Don't forget to foreground (`fg') this "
 					"process when you're done !\n"), stderr);
 		kill(-getpgid(0),SIGTSTP);
 	}
+#endif
 }
 
 
diff -urN dpkg-1.10.21.orig/main/dpkg-query.8 dpkg-1.10.21/main/dpkg-query.8
--- dpkg-1.10.21.orig/main/dpkg-query.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/main/dpkg-query.8	2012-07-13 02:13:27.000000000 +0200
@@ -14,7 +14,7 @@
 .TP
 \fB-l\fP | \fB--list\fP \fIpackage-name-pattern\fP ...
 List packages matching given pattern. If no \fIpackage-name-pattern\fP
-is given, list all packages in \fI/var/lib/dpkg/available\fP.  Normal
+is given, list all packages in \fI@PREFIX@/var/lib/dpkg/available\fP.  Normal
 shell wildchars are allowed in \fIpackage-name-pattern\fP. Please note
 you will probably have to quote \fIpackage-name-pattern\fP to prevent
 the shell from performing filename expansion. For example this will
@@ -47,7 +47,7 @@
 .TP
 \fB-p\fP |\fB--print-avail\fP package
 Display details about \fIpackage\fP, as found in
-\fI/var/lib/dpkg/available\fP.
+\fI@PREFIX@/var/lib/dpkg/available\fP.
 .TP
 \fB--licence\fP | \fB--license\fP
 Display licence and copyright information.
@@ -59,7 +59,7 @@
 .TP
 \fB--admindir=\fIdir\fP
 Change the location of the \fBdpkg\fR database. The default location is
-\fI/var/lib/dpkg\fP.
+\fI@PREFIX@/var/lib/dpkg\fP.
 .TP
 \fB--showformat=\fP\fIformat\fR
 This option is used to specify the format of the output \fB--show\fP
@@ -81,6 +81,7 @@
 .UR mailto:wakkerma@debian.org
 <wakkerma@debian.org>
 .UE
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
 .sp
 This is free software; see the GNU General Public Licence version 2 or
 later for copying conditions.  There is NO warranty.
diff -urN dpkg-1.10.21.orig/main/dpkg.8 dpkg-1.10.21/main/dpkg.8
--- dpkg-1.10.21.orig/main/dpkg.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/main/dpkg.8	2012-07-13 02:13:27.000000000 +0200
@@ -154,7 +154,7 @@
 file).  \fB-P\fP or \fB--purge\fP removes everything, including configuration
 files.  If \fB-a\fP or \fB--pending\fP is given instead of a package
 name, then all packages unpacked, but marked to be removed or purged
-in file \fI/var/lib/dpkg/status\fP, are removed or purged,
+in file \fI@PREFIX@/var/lib/dpkg/status\fP, are removed or purged,
 respectively.
 
 Removing of a package consists of the following steps:
@@ -176,7 +176,7 @@
 \fB--update-avail\fP, old information is replaced with the information
 in the \fIPackages-file\fP.  The \fIPackages-file\fP distributed with
 Debian is simply named \fIPackages\fP.  \fBdpkg\fP keeps its
-record of available packages in \fI/var/lib/dpkg/available\fP.
+record of available packages in \fI@PREFIX@/var/lib/dpkg/available\fP.
 .TP
 \fBdpkg -A\fP | \fB--record-avail\fP \fIpackage_file\fP ...
 Update \fBdpkg\fP and \fBdselect\fP's idea of which packages are
@@ -286,14 +286,14 @@
 \fBdpkg -S\fP | \fB--search\fP \fIfilename-search-pattern\fP ...
     Search for a filename from installed packages.
 \fBdpkg -p\fP | \fB--print-avail\fP \fIpackage\fP
-    Display details about \fIpackage\fP, as found in \fI/var/lib/dpkg/available\fP.
+    Display details about \fIpackage\fP, as found in \fI@PREFIX@/var/lib/dpkg/available\fP.
 .fi
 
 
 
 .SH OPTIONS
 All options can be specified both on the commandline and in the \fBdpkg\fP
-configuration file \fI/etc/dpkg/dpkg.cfg\fP. Each line in the configuration
+configuration file \fI@PREFIX@/etc/dpkg/dpkg.cfg\fP. Each line in the configuration
 file is either an option (exactly the same as the commandline option but
 without leading dashes) or a comment (if it starts with a \fB#\fR).
 .br
@@ -453,14 +453,14 @@
 .TP
 \fB--root=\fP\fIdir\fP | \fB--admindir=\fP\fIdir\fP | \fB--instdir=\fP\fIdir\fP
 Change default directories.  \fBadmindir\fP defaults to
-\fI/var/lib/dpkg\fP and contains many files that give information
+\fI@PREFIX@/var/lib/dpkg\fP and contains many files that give information
 about status of installed or uninstalled packages, etc.  \fBinstdir\fP
 defaults to \fI/\fP and refers to the directory where packages are to
 be installed.  \fBinstdir\fP is also the directory passed to
 \fBchroot\fP(2) before running \fIpackage\fP's installation scripts, which
 means that the scripts see \fBinstdir\fP as a root directory.
 Changing \fBroot\fP changes \fBinstdir\fP to \fIdir\fP and
-\fBadmindir\fP to \fIdir\fP\fB/var/lib/dpkg\fP.
+\fBadmindir\fP to \fIdir\fP\fB@PREFIX@/var/lib/dpkg\fP.
 .TP
 \fB-O\fP | \fB--selected-only\fP
 Only process the packages that are selected for installation. The
@@ -477,16 +477,16 @@
 multiple times.  Status updates are of the form `status: <pkg>: <pkg qstate>'.
 .SH FILES
 .TP
-.I /etc/dpkg/dpkg.cfg
+.I @PREFIX@/etc/dpkg/dpkg.cfg
 Configuration file with default options.
 .P
 The other files listed below are in their default directories, see option
 \fB--admindir\fP to see how to change locations of these files.
 .TP
-.I /var/lib/dpkg/available
+.I @PREFIX@/var/lib/dpkg/available
 List of available packages.
 .TP
-.I /var/lib/dpkg/status
+.I @PREFIX@/var/lib/dpkg/status
 Statuses of available packages. This file contains information about
 whether a package is marked for removing or not, whether it is
 installed or not, etc. See section \fBINFORMATION ABOUT PACKAGES\fP
@@ -536,14 +536,14 @@
 \fB     dpkg -l '*vi*'\fP
 .br
 
-To see the entries in \fI/var/lib/dpkg/available\fP on two packages:
+To see the entries in \fI@PREFIX@/var/lib/dpkg/available\fP on two packages:
 .br
 \fB     dpkg --print-avail elvis vim | less\fP
 .br
 
 To search the listing of packages yourself:
 .br
-\fB     less /var/lib/dpkg/available\fP
+\fB     less @PREFIX@/var/lib/dpkg/available\fP
 .br
 
 To remove an installed elvis package:
@@ -590,6 +590,6 @@
 
 .SH AUTHORS
 .nf
-See \fB/usr/share/doc/dpkg/THANKS.gz\fP for the list of people who have
+See \fB@PREFIX@/share/doc/dpkg/THANKS.gz\fP for the list of people who have
 contributed to \fBdpkg\fP .
 .fi
diff -urN dpkg-1.10.21.orig/main/enquiry.c dpkg-1.10.21/main/enquiry.c
--- dpkg-1.10.21.orig/main/enquiry.c	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/main/enquiry.c	2012-07-13 02:13:27.000000000 +0200
@@ -402,7 +402,7 @@
   FILE *ccpipe;
   struct varbuf vb;
   ptrdiff_t ll;
-  char *p, *q;
+  char *p;
 
   if (*argv) badusage(_("--print-architecture does not take any argument"));
 
@@ -445,7 +445,7 @@
   default: internerr("unknown action in printarch");
   }
   if (!arch) {
-    *q= 0; arch= p;
+    arch= p;
     fprintf(stderr, _("dpkg: warning, architecture `%s' not in remapping table\n"),arch);
   }
   if (printf("%s\n",arch) == EOF) werr("stdout");
diff -urN dpkg-1.10.21.orig/main/filesdb.c dpkg-1.10.21/main/filesdb.c
--- dpkg-1.10.21.orig/main/filesdb.c	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/main/filesdb.c	2012-07-13 02:13:27.000000000 +0200
@@ -25,6 +25,7 @@
 #include <unistd.h>
 #include <fcntl.h>
 #include <string.h>
+#include <ctype.h>
 #include <errno.h>
 #include <sys/stat.h>
 
@@ -566,7 +567,7 @@
 
 static int hash(const char *name) {
   int v= 0;
-  while (*name) { v *= 1787; v += *name; name++; }
+  while (*name) { v *= 1787; v += tolower(*name); name++; }
   return v;
 }
 
@@ -581,7 +582,7 @@
   while (*pointerp) {
 /* Why is this assert nescessary?  It is checking already added entries. */
     assert((*pointerp)->name[0] == '/');
-    if (!strcmp((*pointerp)->name+1,name)) break;
+    if (!strcasecmp((*pointerp)->name+1,name)) break;
     pointerp= &(*pointerp)->next;
   }
   if (*pointerp) return *pointerp;
diff -urN dpkg-1.10.21.orig/main/help.c dpkg-1.10.21/main/help.c
--- dpkg-1.10.21.orig/main/help.c	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/main/help.c	2012-07-13 02:13:27.000000000 +0200
@@ -69,11 +69,18 @@
 
 void checkpath(void) {
 /* Verify that some programs can be found in the PATH. */
-  static const char *const checklist[]= { "ldconfig", 
+  static const char *const checklist[]= { 
+#ifndef __APPLE__
+    "ldconfig", 
+#endif
 #ifdef USE_START_STOP_DAEMON
     "start-stop-daemon",
 #endif    
-    "install-info", "update-rc.d", 0
+    "install-info",
+#ifndef __APPLE__
+   "update-rc.d",
+#endif
+    0
   };
 
   struct stat stab;
@@ -180,7 +187,7 @@
   }
   if (f_debug & dbg_scripts) {
     fprintf(stderr,"D0%05o: fork/exec %s (",dbg_scripts,path);
-    while (*argv) fprintf(stderr," %s",*argv++);
+    while (*++argv) fprintf(stderr," %s",*argv);
     fputs(" )\n",stderr);
   }
   instdirl= strlen(instdir);
@@ -256,17 +263,75 @@
 static int do_script(const char *pkg, const char *scriptname, const char *scriptpath, struct stat *stab, char *const arglist[], const char *desc, const char *name, int warn) {
   const char *scriptexec;
   int c1, r;
+  if (scriptpath) // if NULL, just want wrapper side-effect, no actual .deb script present
   setexecute(scriptpath,stab);
 
   c1= m_fork();
   if (!c1) {
     const char **narglist;
+    /* FINK LOCAL begin */
+    const char **full_narglist;
+    char *path_wrapper;
+    struct stat stab_wrapper;
+    const char *null_script_path = "";  // must be blank string (NULL is end-of-array sentinel)
+    /* FINK LOCAL end */
     for (r=0; arglist[r]; r++) ;
-    narglist=nfmalloc((r+1)*sizeof(char*));
+    // narglist=nfmalloc((r+1)*sizeof(char*));
+    /* FINK LOCAL begin */
+    full_narglist=nfmalloc((r+2)*sizeof(char*));  // leave space for wrapper-script-name, add NULL terminator
+    narglist=full_narglist+1;  // orig pointer points to orig array
+    /* FINK LOCAL end */
     for (r=1; arglist[r-1]; r++)
       narglist[r]= arglist[r];
+    if (scriptpath) { // FINK LOCAL
     scriptexec= preexecscript(scriptpath,narglist);
+    } else { scriptexec = null_script_path; }; // FINK LOCAL was called with no actual script path to run
     narglist[0]= scriptexec;
+    /* FINK LOCAL begin */
+    // try to set up with wrapper
+#define FINK_DPKG_SCRIPT_DIR "@PREFIX@/lib/fink/dpkg-base-files"
+    // determine wrapper-script pathname
+    asprintf(&path_wrapper, "%s/%s", FINK_DPKG_SCRIPT_DIR, scriptname);
+    if (path_wrapper == NULL) {
+      ohshite(_("dpkg - error: could not allocate for fink script wrapper for %s.\n"), scriptpath);
+    } else {
+      if (!stat(path_wrapper, &stab_wrapper)) {
+	if ((stab_wrapper.st_mode & 0555) == 0555) {
+	  // only use it if it exists and is chmod a+rx
+	  debug(dbg_scripts,"Wrapper script '%s' will be used around '%s'", path_wrapper, scriptpath);
+	  // it's good! set wrapper as actual runnable thing in narglist array
+	  narglist=full_narglist;
+	  scriptexec= preexecscript(path_wrapper,narglist);
+	  narglist[0]= scriptexec;
+
+	  /*
+	    Global wrapper needs way to introspect name of package
+	    being manipulated. Normal .deb scripts could have this
+	    hard-coded in their script because this info is known at
+	    the time the .deb is constructed. Pass the name as an
+	    env var to the wrapper.
+	  */
+	  setenv("FINK_PACKAGE_NAME", pkg, 1);
+	} else {
+	  debug(dbg_scripts,"Wrapper script '%s' wrong perms", path_wrapper);
+	  if (scriptpath) {
+	    debug(dbg_scripts,"...falling back to real script '%s'", scriptpath);
+	  } else {
+	    debug(dbg_scripts,"...skipping over because no real script '%s'", scriptpath);
+	    exit(0);
+	  }
+	}
+      } else {
+	debug(dbg_scripts,"Wrapper script '%s' does not exist", path_wrapper);
+	if (scriptpath) {
+	  debug(dbg_scripts,"...falling back to real script '%s'", scriptpath);
+	} else {
+	  debug(dbg_scripts,"...skipping over because no real script '%s'", scriptpath);
+	  exit(0);
+	}
+      }
+    }
+    /* FINK LOCAL end */
     execv(scriptexec,narglist);
     ohshite(desc,name);
   }
@@ -294,8 +359,13 @@
   if (stat(scriptpath,&stab)) {
     if (errno == ENOENT) {
       debug(dbg_scripts,"maintainer_script_installed nonexistent %s",scriptname);
-      return 0;
-    }
+//    return 0;
+      /* FINK LOCAL begin */
+      // always call do_script (fink adds side-effects), but pass NULL if no actual script
+      scriptpath = NULL;
+//  }
+    } else
+      /* FINK LOCAL end */
     ohshite(_("unable to stat installed %s script `%.250s'"),description,scriptpath);
   }
   do_script(pkg->name, scriptname, scriptpath, &stab, arglist, _("unable to execute %s"), buf, 0);
@@ -320,8 +390,14 @@
   if (stat(cidir,&stab)) {
     if (errno == ENOENT) {
       debug(dbg_scripts,"maintainer_script_new nonexistent %s `%s'",scriptname,cidir);
-      return 0;
-    }
+//    return 0;
+      //    }
+      /* FINK LOCAL begin */
+      // always call do_script (fink adds side-effects), but pass NULL if no actual script
+      cidir = NULL;
+//  }
+    } else
+      /* FINK LOCAL end */
     ohshite(_("unable to stat new %s script `%.250s'"),description,cidir);
   }
   do_script(pkgname, scriptname, cidir, &stab, arglist, _("unable to execute new %s"), buf, 0);
@@ -348,16 +424,19 @@
     if (errno == ENOENT) {
       debug(dbg_scripts,"maintainer_script_alternative nonexistent %s `%s'",
             scriptname,oldscriptpath);
-      return 0;
-    }
+      /* FINK LOCAL begin */
+      // always call do_script (fink adds side-effects), but pass NULL if no actual script
+      oldscriptpath = NULL;
+    } else {
+      /* FINK LOCAL end */
     fprintf(stderr,
             _("dpkg: warning - unable to stat %s `%.250s': %s\n"),
             buf,oldscriptpath,strerror(errno));
-  } else {
+    }
+  }
     if (!do_script(pkg->name, scriptname, oldscriptpath, &stab, arglist, _("unable to execute %s"), buf, PROCWARN))
       return 1;
     ensure_diversions();
-  }
   fprintf(stderr, _("dpkg - trying script from the new package instead ...\n"));
 
   arglist= buildarglist(scriptname,
@@ -367,6 +446,9 @@
   strcpy(cidirrest,scriptname);
   sprintf(buf,_("new %s script"),description);
 
+  // FINK if old-pkg fails, don't want to allow "success" of new
+  // solely because wrapper worked in new-pkg: loses important
+  // error-state that *should* fail loudly
   if (stat(cidir,&stab)) {
     if (errno == ENOENT)
       ohshit(_("there is no script in the new version of the package - giving up"));
@@ -410,6 +492,26 @@
     
   debug(dbg_veryverbose, "isdirectoryinuse `%s' (except %s)", file->name,
         pkg ? pkg->name : "<none>");
+
+  /* FINK LOCAL begin */
+
+  /*
+   * Darwin has symlinks /etc -> /private/etc and /var -> /private/var
+   * instead of actual /etc and /var dirs. If dpkg removes the last
+   * pkg that it has record of having installed a file in one of those
+   * top-level dirs, it will try to remove the dir (since it thinks
+   * it's an empty dir) and it will succeed (since it's just unlinking
+   * a symlink, not trying to remove a dir that is not actually
+   * empty). That's Bad. Here we make sure these top-level dirs are
+   * never thought to be empty.
+   */
+  if( !strcmp(file->name,"/etc") || !strcmp(file->name,"/tmp") || !strcmp(file->name,"/var") ) {
+    debug(dbg_veryverbose, "isdirectoryinuse precious!");
+    return 1;
+  }
+
+  /* FINK LOCAL end */
+
   for (packageslump= file->packages; packageslump; packageslump= packageslump->more) {
     debug(dbg_veryverbose, "isdirectoryinuse packageslump %s ...",
           packageslump->pkgs[0] ? packageslump->pkgs[0]->name : "<none>");
diff -urN dpkg-1.10.21.orig/main/help.c.orig dpkg-1.10.21/main/help.c.orig
--- dpkg-1.10.21.orig/main/help.c.orig	1970-01-01 01:00:00.000000000 +0100
+++ dpkg-1.10.21/main/help.c.orig	2012-07-13 02:13:27.000000000 +0200
@@ -0,0 +1,508 @@
+/*
+ * dpkg - main program for package management
+ * help.c - various helper routines
+ *
+ * Copyright (C) 1995 Ian Jackson <ian@chiark.greenend.org.uk>
+ *
+ * This is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as
+ * published by the Free Software Foundation; either version 2,
+ * or (at your option) any later version.
+ *
+ * This is distributed in the hope that it will be useful, but
+ * WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public
+ * License along with dpkg; if not, write to the Free Software
+ * Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
+ */
+#include <config.h>
+
+#include <errno.h>
+#include <unistd.h>
+#include <dirent.h>
+#include <assert.h>
+#include <string.h>
+#include <sys/stat.h>
+#include <sys/types.h>
+#include <sys/wait.h>
+#include <signal.h>
+
+#include <dpkg.h>
+#include <version.h>
+#include <dpkg-db.h>
+
+#include "filesdb.h"
+#include "main.h"
+
+const char *const statusstrings[]= {
+  N_("not installed"),
+  N_("unpacked but not configured"),
+  N_("broken due to postinst failure"),
+  N_("installed"),
+  N_("broken due to failed removal"),
+  N_("not installed but configs remain")
+};
+
+struct filenamenode *namenodetouse(struct filenamenode *namenode, struct pkginfo *pkg) {
+  struct filenamenode *r;
+  
+  if (!namenode->divert) return namenode;
+  
+  debug(dbg_eachfile,"namenodetouse namenode=`%s' pkg=%s",
+        namenode->name,pkg->name);
+  
+  r=
+    (namenode->divert->useinstead && namenode->divert->pkg != pkg)
+      ? namenode->divert->useinstead : namenode;
+  
+  debug(dbg_eachfile,
+        "namenodetouse ... useinstead=%s camefrom=%s pkg=%s return %s",
+        namenode->divert->useinstead ? namenode->divert->useinstead->name : "<none>",
+        namenode->divert->camefrom ? namenode->divert->camefrom->name : "<none>",
+        namenode->divert->pkg ? namenode->divert->pkg->name : "<none>",
+        r->name);
+  return r;
+}
+
+void checkpath(void) {
+/* Verify that some programs can be found in the PATH. */
+  static const char *const checklist[]= { 
+#ifndef __APPLE__
+    "ldconfig", 
+#endif
+#ifdef USE_START_STOP_DAEMON
+    "start-stop-daemon",
+#endif    
+    "install-info",
+#ifndef __APPLE__
+   "update-rc.d",
+#endif
+    0
+  };
+
+  struct stat stab;
+  const char *const *clp;
+  const char *path, *s, *p;
+  char* buf;
+  int warned= 0;
+  long l;
+
+  path= getenv("PATH");
+  if (!path) ohshit(_("dpkg - error: PATH is not set.\n"));
+  buf=(char*)m_malloc(strlen(path)+2+strlen("start-stop-daemon"));
+  
+  for (clp=checklist; *clp; clp++) {
+    s= path;
+    while (s) {
+      p= strchr(s,':');
+      l= p ? p-s : (long)strlen(s);
+      memcpy(buf,s,l);
+      if (l) buf[l++]= '/';
+      strcpy(buf+l,*clp);
+      if (stat(buf,&stab) == 0 && (stab.st_mode & 0111)) break;
+      s= p; if (s) s++;
+    }
+    if (!s) {
+      fprintf(stderr,_("dpkg: `%s' not found on PATH.\n"),*clp);
+      warned++;
+    }
+  }
+
+  free(buf);
+  if (warned)
+    forcibleerr(fc_badpath,_("%d expected program(s) not found on PATH.\nNB: root's "
+                "PATH should usually contain /usr/local/sbin, /usr/sbin and /sbin."),
+                warned);
+}
+
+void ensure_package_clientdata(struct pkginfo *pkg) {
+  if (pkg->clientdata) return;
+  pkg->clientdata= nfmalloc(sizeof(struct perpackagestate));
+  pkg->clientdata->istobe= itb_normal;
+  pkg->clientdata->fileslistvalid= 0;
+  pkg->clientdata->files= 0;
+}
+
+void cu_closepipe(int argc, void **argv) {
+  int *p1= (int*)argv[0];
+  close(p1[0]); close(p1[1]);
+}
+
+void cu_closefile(int argc, void **argv) {
+  FILE *f= (FILE*)(argv[0]);
+  fclose(f);
+}
+
+void cu_closedir(int argc, void **argv) {
+  DIR *d= (DIR*)(argv[0]);
+  closedir(d);
+}
+
+void cu_closefd(int argc, void **argv) {
+  int ip= *(int*)argv[0];
+  close(ip);
+}
+
+int ignore_depends(struct pkginfo *pkg) {
+  struct packageinlist *id;
+  for (id= ignoredependss; id; id= id->next)
+    if (id->pkg == pkg) return 1;
+  return 0;
+}
+
+int force_depends(struct deppossi *possi) {
+  return fc_depends ||
+         ignore_depends(possi->ed) ||
+         ignore_depends(possi->up->up);
+}
+
+int force_conflicts(struct deppossi *possi) {
+  return fc_conflicts;
+}
+
+const char *pkgadminfile(struct pkginfo *pkg, const char *whichfile) {
+  static struct varbuf vb;
+  varbufreset(&vb);
+  varbufaddstr(&vb,admindir);
+  varbufaddstr(&vb,"/" INFODIR);
+  varbufaddstr(&vb,pkg->name);
+  varbufaddc(&vb,'.');
+  varbufaddstr(&vb,whichfile);
+  varbufaddc(&vb,0);
+  return vb.buf;
+}
+
+static const char* preexecscript(const char *path, char *const *argv) {
+  /* returns the path to the script inside the chroot
+   * none of the stuff here will work if admindir isn't inside instdir
+   * as expected. - fixme
+   */
+  size_t instdirl;
+
+  if (*instdir) {
+    if (chroot(instdir)) ohshite(_("failed to chroot to `%.250s'"),instdir);
+  }
+  if (f_debug & dbg_scripts) {
+    fprintf(stderr,"D0%05o: fork/exec %s (",dbg_scripts,path);
+    while (*argv) fprintf(stderr," %s",*argv++);
+    fputs(" )\n",stderr);
+  }
+  instdirl= strlen(instdir);
+  if (!instdirl) return path;
+  assert (strlen(path)>=instdirl);
+  return path+instdirl;
+}  
+
+static char *const *vbuildarglist(const char *scriptname, va_list ap) {
+  static char *bufs[PKGSCRIPTMAXARGS+1];
+  char *nextarg;
+  int i;
+
+  i=0;
+  if(bufs[0]) free(bufs[0]);
+  bufs[i++]= strdup(scriptname); /* yes, cast away const because exec wants it that way */
+  for (;;) {
+    assert(i < PKGSCRIPTMAXARGS);
+    nextarg= va_arg(ap,char*);
+    if (!nextarg) break;
+    bufs[i++]= nextarg;
+  }
+  bufs[i]= 0;
+  return bufs;
+}    
+
+static char *const *buildarglist(const char *scriptname, ...) {
+  char *const *arglist;
+  va_list ap;
+  va_start(ap,scriptname);
+  arglist= vbuildarglist(scriptname,ap);
+  va_end(ap);
+  return arglist;
+}
+
+#define NSCRIPTCATCHSIGNALS (int)(sizeof(script_catchsignallist)/sizeof(int)-1)
+static int script_catchsignallist[]= { SIGQUIT, SIGINT, 0 };
+static struct sigaction script_uncatchsignal[NSCRIPTCATCHSIGNALS];
+
+static void cu_restorescriptsignals(int argc, void **argv) {
+  int i;
+  for (i=0; i<NSCRIPTCATCHSIGNALS; i++) {
+    if (sigaction(script_catchsignallist[i],&script_uncatchsignal[i],0)) {
+      fprintf(stderr,_("error un-catching signal %s: %s\n"),
+              strsignal(script_catchsignallist[i]),strerror(errno));
+      onerr_abort++;
+    }
+  }
+}
+
+static void script_catchsignals(void) {
+  int i;
+  struct sigaction catchsig;
+  
+  onerr_abort++;
+  memset(&catchsig,0,sizeof(catchsig));
+  catchsig.sa_handler= SIG_IGN;
+  sigemptyset(&catchsig.sa_mask);
+  catchsig.sa_flags= 0;
+  for (i=0; i<NSCRIPTCATCHSIGNALS; i++)
+    if (sigaction(script_catchsignallist[i],&catchsig,&script_uncatchsignal[i]))
+      ohshite(_("unable to ignore signal %s before running script"),
+              strsignal(script_catchsignallist[i]));
+  push_cleanup(cu_restorescriptsignals,~0, 0,0, 0);
+  onerr_abort--;
+}
+
+static void setexecute(const char *path, struct stat *stab) {
+  if ((stab->st_mode & 0555) == 0555) return;
+  if (!chmod(path,0755)) return;
+  ohshite(_("unable to set execute permissions on `%.250s'"),path);
+}
+static int do_script(const char *pkg, const char *scriptname, const char *scriptpath, struct stat *stab, char *const arglist[], const char *desc, const char *name, int warn) {
+  const char *scriptexec;
+  int c1, r;
+  setexecute(scriptpath,stab);
+
+  c1= m_fork();
+  if (!c1) {
+    const char **narglist;
+    for (r=0; arglist[r]; r++) ;
+    narglist=nfmalloc((r+1)*sizeof(char*));
+    for (r=1; arglist[r-1]; r++)
+      narglist[r]= arglist[r];
+    scriptexec= preexecscript(scriptpath,narglist);
+    narglist[0]= scriptexec;
+    execv(scriptexec,narglist);
+    ohshite(desc,name);
+  }
+  script_catchsignals(); /* This does a push_cleanup() */
+  r= waitsubproc(c1,name,warn);
+  pop_cleanup(ehflag_normaltidy);
+  return r;
+}
+
+int maintainer_script_installed(struct pkginfo *pkg, const char *scriptname,
+                                const char *description, ...) {
+  /* all ...'s are const char*'s */
+  const char *scriptpath;
+  char *const *arglist;
+  struct stat stab;
+  va_list ap;
+  char buf[100];
+
+  scriptpath= pkgadminfile(pkg,scriptname);
+  va_start(ap,description);
+  arglist= vbuildarglist(scriptname,ap);
+  va_end(ap);
+  sprintf(buf,"%s script",description);
+
+  if (stat(scriptpath,&stab)) {
+    if (errno == ENOENT) {
+      debug(dbg_scripts,"maintainer_script_installed nonexistent %s",scriptname);
+      return 0;
+    }
+    ohshite(_("unable to stat installed %s script `%.250s'"),description,scriptpath);
+  }
+  do_script(pkg->name, scriptname, scriptpath, &stab, arglist, _("unable to execute %s"), buf, 0);
+  ensure_diversions();
+  return 1;
+}
+  
+int maintainer_script_new(const char *pkgname,
+			  const char *scriptname, const char *description,
+                          const char *cidir, char *cidirrest, ...) {
+  char *const *arglist;
+  struct stat stab;
+  va_list ap;
+  char buf[100];
+  
+  va_start(ap,cidirrest);
+  arglist= vbuildarglist(scriptname,ap);
+  va_end(ap);
+  sprintf(buf,"%s script",description);
+
+  strcpy(cidirrest,scriptname);
+  if (stat(cidir,&stab)) {
+    if (errno == ENOENT) {
+      debug(dbg_scripts,"maintainer_script_new nonexistent %s `%s'",scriptname,cidir);
+      return 0;
+    }
+    ohshite(_("unable to stat new %s script `%.250s'"),description,cidir);
+  }
+  do_script(pkgname, scriptname, cidir, &stab, arglist, _("unable to execute new %s"), buf, 0);
+  ensure_diversions();
+  return 1;
+}
+
+int maintainer_script_alternative(struct pkginfo *pkg,
+                                  const char *scriptname, const char *description,
+                                  const char *cidir, char *cidirrest,
+                                  const char *ifok, const char *iffallback) {
+  const char *oldscriptpath;
+  char *const *arglist;
+  struct stat stab;
+  char buf[100];
+
+  oldscriptpath= pkgadminfile(pkg,scriptname);
+  arglist= buildarglist(scriptname,
+                        ifok,versiondescribe(&pkg->available.version,
+                                             vdew_nonambig),
+                        (char*)0);
+  sprintf(buf,_("old %s script"),description);
+  if (stat(oldscriptpath,&stab)) {
+    if (errno == ENOENT) {
+      debug(dbg_scripts,"maintainer_script_alternative nonexistent %s `%s'",
+            scriptname,oldscriptpath);
+      return 0;
+    }
+    fprintf(stderr,
+            _("dpkg: warning - unable to stat %s `%.250s': %s\n"),
+            buf,oldscriptpath,strerror(errno));
+  } else {
+    if (!do_script(pkg->name, scriptname, oldscriptpath, &stab, arglist, _("unable to execute %s"), buf, PROCWARN))
+      return 1;
+    ensure_diversions();
+  }
+  fprintf(stderr, _("dpkg - trying script from the new package instead ...\n"));
+
+  arglist= buildarglist(scriptname,
+                        iffallback,versiondescribe(&pkg->installed.version,
+                                                   vdew_nonambig),
+                        (char*)0);
+  strcpy(cidirrest,scriptname);
+  sprintf(buf,_("new %s script"),description);
+
+  if (stat(cidir,&stab)) {
+    if (errno == ENOENT)
+      ohshit(_("there is no script in the new version of the package - giving up"));
+    else
+      ohshite(_("unable to stat %s `%.250s'"),buf,cidir);
+  }
+
+  do_script(pkg->name, scriptname, cidir, &stab, arglist, _("unable to execute %s"), buf, 0);
+  fprintf(stderr, _("dpkg: ... it looks like that went OK.\n"));
+
+  ensure_diversions();
+  return 1;
+}
+
+void clear_istobes(void) {
+  struct pkgiterator *it;
+  struct pkginfo *pkg;
+
+  it= iterpkgstart();
+  while ((pkg= iterpkgnext(it)) != 0) {
+    ensure_package_clientdata(pkg);
+    pkg->clientdata->istobe= itb_normal;
+    pkg->clientdata->replacingfilesandsaid= 0;
+  }
+}
+
+void debug(int which, const char *fmt, ...) {
+  va_list ap;
+  if (!(f_debug & which)) return;
+  fprintf(stderr,"D0%05o: ",which);
+  va_start(ap,fmt);
+  vfprintf(stderr,fmt,ap);
+  va_end(ap);
+  putc('\n',stderr);
+}
+
+int isdirectoryinuse(struct filenamenode *file, struct pkginfo *pkg) {
+  /* Returns 1 if the file is used by packages other than pkg, 0 otherwise. */
+  struct filepackages *packageslump;
+  int i;
+    
+  debug(dbg_veryverbose, "isdirectoryinuse `%s' (except %s)", file->name,
+        pkg ? pkg->name : "<none>");
+
+  /* FINK LOCAL begin */
+
+  /*
+   * Darwin has symlinks /etc -> /private/etc and /var -> /private/var
+   * instead of actual /etc and /var dirs. If dpkg removes the last
+   * pkg that it has record of having installed a file in one of those
+   * top-level dirs, it will try to remove the dir (since it thinks
+   * it's an empty dir) and it will succeed (since it's just unlinking
+   * a symlink, not trying to remove a dir that is not actually
+   * empty). That's Bad. Here we make sure these top-level dirs are
+   * never thought to be empty.
+   */
+  if( !strcmp(file->name,"/etc") || !strcmp(file->name,"/tmp") || !strcmp(file->name,"/var") ) {
+    debug(dbg_veryverbose, "isdirectoryinuse precious!");
+    return 1;
+  }
+
+  /* FINK LOCAL end */
+
+  for (packageslump= file->packages; packageslump; packageslump= packageslump->more) {
+    debug(dbg_veryverbose, "isdirectoryinuse packageslump %s ...",
+          packageslump->pkgs[0] ? packageslump->pkgs[0]->name : "<none>");
+    for (i=0; i < PERFILEPACKAGESLUMP && packageslump->pkgs[i]; i++) {
+      debug(dbg_veryverbose, "isdirectoryinuse considering [%d] %s ...", i,
+            packageslump->pkgs[i]->name);
+      if (packageslump->pkgs[i] == pkg) continue;
+      return 1;
+    }
+  }
+  debug(dbg_veryverbose, "isdirectoryinuse no");
+  return 0;
+}
+
+void oldconffsetflags(const struct conffile *searchconff) {
+  struct filenamenode *namenode;
+  
+  while (searchconff) {
+    namenode= findnamenode(searchconff->name, 0); /* XXX */
+    namenode->flags |= fnnf_old_conff;
+    debug(dbg_conffdetail, "oldconffsetflags `%s' namenode %p flags %o",
+          searchconff->name, namenode, namenode->flags);
+    searchconff= searchconff->next;
+  }
+}
+
+int chmodsafe_unlink(const char *pathname) {
+  struct stat stab;
+
+  if (lstat(pathname,&stab)) return -1;
+  if (S_ISREG(stab.st_mode) ? (stab.st_mode & 07000) :
+      !(S_ISLNK(stab.st_mode) || S_ISDIR(stab.st_mode) ||
+   S_ISFIFO(stab.st_mode) || S_ISSOCK(stab.st_mode))) {
+    /* We chmod it if it is 1. a sticky or set-id file, or 2. an unrecognised
+     * object (ie, not a file, link, directory, fifo or socket
+     */
+    if (chmod(pathname,0600)) return -1;
+  }
+  if (unlink(pathname)) return -1;
+  return 0;
+}
+
+void ensure_pathname_nonexisting(const char *pathname) {
+  int c1;
+  const char *u;
+
+  u= skip_slash_dotslash(pathname);
+  assert(*u);
+
+  debug(dbg_eachfile,"ensure_pathname_nonexisting `%s'",pathname);
+  if (!rmdir(pathname)) return; /* Deleted it OK, it was a directory. */
+  if (errno == ENOENT || errno == ELOOP) return;
+  if (errno == ENOTDIR) {
+    /* Either it's a file, or one of the path components is.  If one
+     * of the path components is this will fail again ...
+     */
+    if (!chmodsafe_unlink(pathname)) return; /* OK, it was */
+    if (errno == ENOTDIR) return;
+  }
+  if (errno != ENOTEMPTY) /* Huh ? */
+    ohshite(_("failed to rmdir/unlink `%.255s'"),pathname);
+  c1= m_fork();
+  if (!c1) {
+    execlp(RM,"rm","-rf","--",pathname,(char*)0);
+    ohshite(_("failed to exec rm for cleanup"));
+  }
+  debug(dbg_eachfile,"ensure_pathname_nonexisting running rm -rf");
+  waitsubproc(c1,"rm cleanup",0);
+}
diff -urN dpkg-1.10.21.orig/main/main.c dpkg-1.10.21/main/main.c
--- dpkg-1.10.21.orig/main/main.c	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/main/main.c	2012-07-13 02:13:27.000000000 +0200
@@ -38,6 +38,12 @@
 #include <version.h>
 #include <myopt.h>
 
+/* FINK LOCAL begin */
+#include <sys/utsname.h>
+#include <CoreFoundation/CoreFoundation.h>
+static void finkinit();
+/* FINK LOCAL end */
+
 #include "main.h"
 
 static void printversion(void) {
@@ -546,6 +552,153 @@
   }
 }
 
+/* FINK LOCAL begin */
+struct FinkVirtualPkgs {
+  struct FinkVirtualPkgs *next;
+  char *pkgname;
+  struct versionrevision version;
+};
+
+struct FinkVirtualPkgs *fink_virt_pkg = NULL;
+static void finkinit()
+{
+	FILE *virt_pkg_stream = NULL;
+	struct stat sb;
+	struct FinkVirtualPkgs *pkg;
+	char name[256];
+	char version[256];
+	char revision[256];
+	unsigned int  epoch;
+    Boolean status;
+    SInt32 errorCode;
+    CFURLRef fileURL = NULL;
+    CFDataRef resourceData = NULL;
+    CFPropertyListRef propertyList = NULL;
+    CFStringRef string;
+    static char buffer[256];	// This is static, to ensure the buffer stays around
+
+    static struct utsname ver;	// This is static, to ensure the buffer stays around
+	if (0 == stat("@PREFIX@/bin/fink-virtual-pkgs", &sb))
+	{
+	  virt_pkg_stream =popen("@PREFIX@/bin/fink-virtual-pkgs --dpkg","r");
+  	  if (virt_pkg_stream)
+	  {
+	    while (fscanf(virt_pkg_stream,"%s\t%u\t%s\t%s\n",name,&epoch,version, revision) == 4)
+	    {
+	      pkg = (struct FinkVirtualPkgs *)malloc(sizeof(struct FinkVirtualPkgs));
+	      if (pkg)
+	      {
+			  pkg->next = fink_virt_pkg;
+			  pkg->pkgname = strdup(name);
+			  pkg->version.epoch = epoch;
+			  pkg->version.version = strdup(version);
+			  pkg->version.revision = strdup(revision);
+			  /* Quick and simple sanity check */
+			  if ((NULL != pkg->pkgname) && (0 != strlen(pkg->pkgname)) &&
+			      (NULL != pkg->version.version) && (0 != strlen(pkg->version.version)) &&
+			      (NULL != pkg->version.revision) && (0 != strlen(pkg->version.revision)))
+			  {
+			  	/* We are leaking here if something fails the sanity check above */
+			  	fink_virt_pkg = pkg;
+			  }
+	      }
+	    }
+	    if (pclose(virt_pkg_stream))
+	    {
+	    	/* The fink-virtual-pkgs script returned a non zero exit status *
+	    	 * clean up and try the old way.                                */
+	    	while(NULL != fink_virt_pkg)
+	    	{
+	    		pkg = fink_virt_pkg;
+	    		if (NULL != pkg->pkgname) free(pkg->pkgname);
+	    		if (NULL != pkg->version.version) free(pkg->version.version);
+	    		if (NULL != pkg->version.revision) free(pkg->version.revision);
+	    		fink_virt_pkg = pkg->next;
+	    		free(pkg);
+	    	}
+                fink_virt_pkg = NULL;
+	    }
+	  }
+	} 
+	if (NULL == fink_virt_pkg)
+	{
+	  /* Determine system version */
+	  /* TODO - should maybe check if this is really Darwin? */
+	  if (!uname(&ver)) {
+	      pkg = (struct FinkVirtualPkgs *)malloc(sizeof(struct FinkVirtualPkgs));
+	      if (pkg) {
+			  pkg->next = fink_virt_pkg;
+			  pkg->pkgname = strdup("darwin");
+			  pkg->version.epoch = 0;
+			  pkg->version.version = ver.release;
+			  pkg->version.revision = NULL;
+			  fink_virt_pkg = pkg;
+	      }  
+	  }
+	
+	  /* Check whether this is Mac OS X, and which version of it */
+
+	  fileURL = CFURLCreateWithFileSystemPath( NULL, 	
+			CFSTR("/System/Library/CoreServices/SystemVersion.plist"),
+			kCFURLPOSIXPathStyle,				
+			false );
+	  if (!fileURL)
+		goto BAIL;
+	  
+	  /* Read the XML */
+	  status = CFURLCreateDataAndPropertiesFromResource(
+			NULL,
+			fileURL,
+			&resourceData,
+			NULL,		
+			NULL,
+			&errorCode);
+	  if (!status || errorCode != 0)
+		goto BAIL;
+	  
+	  /* Reconstitute the dictionary using the XML data. */
+	  propertyList = CFPropertyListCreateFromXMLData( NULL,
+			resourceData,
+			kCFPropertyListImmutable,
+			&string);
+	  if (!propertyList)
+		goto BAIL;
+	  
+	  /* Try to read the system version from it. */
+	  status = CFDictionaryGetValueIfPresent( propertyList,
+			CFSTR("ProductVersion"),
+			(void*)&string);
+	  if (!status)
+		goto BAIL;
+	  
+	  /* Convert into a C string */
+	  status = CFStringGetCString( string,
+			buffer,
+			sizeof(buffer),
+			kCFStringEncodingISOLatin1);
+	  if (!status)
+		goto BAIL;
+	  pkg = (struct FinkVirtualPkgs *)malloc(sizeof(struct FinkVirtualPkgs));
+	  if (pkg)
+	  {
+		  pkg->next = fink_virt_pkg;
+		  pkg->pkgname = strdup("macosx");
+		  pkg->version.epoch = 0;
+		  pkg->version.version = buffer;
+		  pkg->version.revision = NULL;
+		  fink_virt_pkg = pkg;
+	  }
+	BAIL:
+	  // Release all of the CF objects we're responsible for.
+	  if (fileURL)
+		CFRelease(fileURL);
+	  if (resourceData)
+		CFRelease(resourceData);
+	  if (propertyList)
+		CFRelease(propertyList);
+	}
+}
+/* FINK LOCAL end */
 
 int main(int argc, const char *const *argv) {
   jmp_buf ejbuf;
@@ -556,7 +709,9 @@
 
   setvbuf(stdout,0,_IONBF,0);
   filesdbinit();
-
+  /* FINK LOCAL begin */
+  finkinit();
+  /* FINK LOCAL end */
   actionfunction= (void (*)(const char* const*))cipaction->farg;
 
   actionfunction(argv);
diff -urN dpkg-1.10.21.orig/main/main.h dpkg-1.10.21/main/main.h
--- dpkg-1.10.21.orig/main/main.h	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/main/main.h	2012-07-13 02:13:27.000000000 +0200
@@ -93,6 +93,11 @@
 extern const char *instdir;
 extern struct packageinlist *ignoredependss;
 extern const char architecture[];
+ 
+/* FINK LOCAL begin */
+extern struct versionrevision darwin_version;
+extern struct versionrevision macosx_version;
+/* FINK LOCAL end */
 
 /* from filesdb.c */
 
diff -urN dpkg-1.10.21.orig/main/packages.c dpkg-1.10.21/main/packages.c
--- dpkg-1.10.21.orig/main/packages.c	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/main/packages.c	2012-07-13 02:13:27.000000000 +0200
@@ -331,6 +331,30 @@
     return thisf;
   }
 }
+ 
+/* FINK LOCAL begin */
+static int check_pseudo_package(const struct versionrevision *versrev, const struct deppossi *possi,
+                                int *interestingwarnings, struct varbuf *oemsgs) {
+
+  if (versionsatisfied3(versrev,&possi->version,possi->verrel)) {
+    return 3;
+  } else {
+    varbufaddstr(oemsgs, _("  Version of "));
+    varbufaddstr(oemsgs, possi->ed->name);
+    varbufaddstr(oemsgs, _(" on system is "));
+    varbufaddstr(oemsgs, versiondescribe(versrev, vdew_nonambig));
+    varbufaddstr(oemsgs, ".\n");
+    (*interestingwarnings)++;
+    return 0;
+  }
+}
+struct FinkVirtualPkgs {
+  struct FinkVirtualPkgs *next;
+  char *pkgname;
+  struct versionrevision version;
+};
+extern struct FinkVirtualPkgs *fink_virt_pkg;
+/* FINK LOCAL end */
 
 int dependencies_ok(struct pkginfo *pkg, struct pkginfo *removing,
                     struct varbuf *aemsgs) {
@@ -338,7 +362,7 @@
   struct varbuf oemsgs;
   struct dependency *dep;
   struct deppossi *possi, *provider;
-
+  struct FinkVirtualPkgs *virt_pkg = NULL; 
   varbufinit(&oemsgs);
   interestingwarnings= 0;
   ok= 2; /* 2=ok, 1=defer, 0=halt */
@@ -352,6 +376,29 @@
     found= 0; /* 0=none, 1=defer, 2=withwarning, 3=ok */
     for (possi= dep->list; found != 3 && possi; possi= possi->next) {
       debug(dbg_depcondetail,"    checking possibility  -> %s",possi->ed->name);
+      /* FINK LOCAL begin */
+      virt_pkg = fink_virt_pkg;
+      while (virt_pkg)
+      {
+        if (0==strcmp(possi->ed->name,virt_pkg->pkgname)) {
+          debug(dbg_depcondetail,"        pseudo package");
+          found= check_pseudo_package(&virt_pkg->version,possi,&interestingwarnings,&oemsgs);
+        }
+        virt_pkg = virt_pkg->next;
+      }
+/*      
+      if (0==strcmp(possi->ed->name,"darwin") && darwin_version.version) {
+        debug(dbg_depcondetail,"        pseudo package darwin");
+        found= check_pseudo_package(&darwin_version,possi,&interestingwarnings,&oemsgs);
+        break;
+      }
+      else if (0==strcmp(possi->ed->name,"macosx") && macosx_version.version) {
+        debug(dbg_depcondetail,"        pseudo package macosx");
+        found= check_pseudo_package(&macosx_version,possi,&interestingwarnings,&oemsgs);
+        break;
+      }
+*/      
+      /* FINK LOCAL end */
       if (possi->cyclebreak) {
         debug(dbg_depcondetail,"      break cycle so ok and found");
         found= 3; break;
diff -urN dpkg-1.10.21.orig/man/en/dpkg.cfg.5 dpkg-1.10.21/man/en/dpkg.cfg.5
--- dpkg-1.10.21.orig/man/en/dpkg.cfg.5	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/en/dpkg.cfg.5	2012-07-13 02:13:27.000000000 +0200
@@ -8,10 +8,11 @@
 here. Comments are allowed by starting a line with a hash sign
 ("\fB#\fR").
 .SH FILES
-.I /etc/dpkg/dpkg.cfg
+.I @PREFIX@/etc/dpkg/dpkg.cfg
 ~/.dpkg.cfg
 .SH AUTHOR
-See \fB/usr/share/doc/dpkg/THANKS\fP for the list of people who have
+See \fB@PREFIX@/share/doc/dpkg/THANKS\fP for the list of people who have
 contributed to \fBdpkg\fP .
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
 .SH SEE ALSO
 .BR dpkg (8)
diff -urN dpkg-1.10.21.orig/man/en/dselect.cfg.5 dpkg-1.10.21/man/en/dselect.cfg.5
--- dpkg-1.10.21.orig/man/en/dselect.cfg.5	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/en/dselect.cfg.5	2012-07-13 02:13:27.000000000 +0200
@@ -8,10 +8,11 @@
 here. Comments are allowed by starting a line with a hash sign
 ("\fB#\fR").
 .SH FILES
-.I /etc/dpkg/dselect.cfg
+.I @PREFIX@/etc/dpkg/dselect.cfg
 ~/.dselect.cfg
 .SH AUTHOR
-See \fB/usr/share/doc/dpkg/THANKS\fP for the list of people who have
+See \fB@PREFIX@/share/doc/dpkg/THANKS\fP for the list of people who have
 contributed to \fBdselect\fP .
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
 .SH SEE ALSO
 .BR dselect (8)
diff -urN dpkg-1.10.21.orig/man/fr/cleanup-info.8 dpkg-1.10.21/man/fr/cleanup-info.8
--- dpkg-1.10.21.orig/man/fr/cleanup-info.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/fr/cleanup-info.8	2012-07-13 02:13:27.000000000 +0200
@@ -38,7 +38,7 @@
 Affiche la version et se termine normalement.
 .SH FICHIERS
 .TP
-.I "/usr/info/dir ou <nom-de-rep>/dir"
+.I "@PREFIX@/share/info/dir ou <nom-de-rep>/dir"
 Le fichier  dir  du rpertoire  info . Le fichier verrouill porte le mme
 nom suivi de  .lock .
 .SH BOGUES
@@ -54,4 +54,6 @@
 .B pas
 de garantie.
 .SH TRADUCTION
-Philippe Batailler, Janvier 2001.
\ No newline at end of file
+Philippe Batailler, Janvier 2001.
+.PP
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
diff -urN dpkg-1.10.21.orig/man/fr/dpkg-deb.1 dpkg-1.10.21/man/fr/dpkg-deb.1
--- dpkg-1.10.21.orig/man/fr/dpkg-deb.1	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/fr/dpkg-deb.1	2012-07-13 02:13:27.000000000 +0200
@@ -245,9 +245,11 @@
 Le copyright (C) date de 1995-1996 et ils ont paru sous la licence
  GNU General Public Licence  ; il n'y a PAS de garantie.
 Voyez
-.B /usr/share/doc/dpkg/copyright
+.B @PREFIX@/share/doc/dpkg/copyright
 et
-.B /usr/share/common-licenses/GPL
+.B @PREFIX@/share/common-licenses/GPL
 pour des prcisions.
 .SH "TRADUCTION"
-Philippe Batailler, Dec 2000.
\ No newline at end of file
+Philippe Batailler, Dec 2000.
+.PP
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
diff -urN dpkg-1.10.21.orig/man/fr/dpkg-divert.8 dpkg-1.10.21/man/fr/dpkg-divert.8
--- dpkg-1.10.21.orig/man/fr/dpkg-divert.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/fr/dpkg-divert.8	2012-07-13 02:13:27.000000000 +0200
@@ -41,7 +41,7 @@
 .TP
 .I --admindir <rpertoire>
 Dfinit le rpertoire de donnes de Dpkg comme <rpertoire> (par dfaut c'est 
-/var/lib/dpkg).
+@PREFIX@/var/lib/dpkg).
 .TP
 .I --divert <dvier-dans>
 <dvier-dans> est le nom utilis pour les autres versions des paquets.
@@ -76,7 +76,7 @@
 On ne peut pas dvier des rpertoires avec dpkg-divert.
 .SH FICHIERS
 .TP
-.I /var/lib/dpkg/diversions
+.I @PREFIX@/var/lib/dpkg/diversions
 Ce fichier contient la liste actuelle des diversions en oeuvre sur le
 systme. Il se trouve dans le rpertoire d'administration de Dpkg, avec
 d'autres fichiers importants comme \ status\  ou \ available\ .
@@ -94,4 +94,6 @@
 C'est un logiciel libre ; voyez la  GNU General Public Licence 
 version 2 ou suprieure pour le copyright. Il n'y a PAS de garantie.
 .SH TRADUCTION
-Philippe Batailler, Jan 2001.
\ No newline at end of file
+Philippe Batailler, Jan 2001.
+.PP
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
diff -urN dpkg-1.10.21.orig/man/fr/dpkg-query.8 dpkg-1.10.21/man/fr/dpkg-query.8
--- dpkg-1.10.21.orig/man/fr/dpkg-query.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/fr/dpkg-query.8	2012-07-13 02:13:27.000000000 +0200
@@ -15,7 +15,7 @@
 \fB-l\fP | \fB--list\fP \fIpaquet-nom-motif\fP ...
 Liste les paquets correspondant au motif donn. Quand on ne donne aucun
 \fIpaquet-nom-motif\fP, tous les paquets lists dans 
-\fI/var/lib/dpkg/available\fP sont affichs. Les mtacaractres ordinaires du
+\fI@PREFIX@/var/lib/dpkg/available\fP sont affichs. Les mtacaractres ordinaires du
 shell sont autoriss dans \fIpaquet-nom-motif\fP. Il faudra sans doute mettre
 \fIpaquet-nom-motif\fP entre apostrophes pour viter l'expansion des noms de
 fichier par le shell. Par exemple, tous les paquets dont le nom commence par
@@ -48,7 +48,7 @@
 .TP
 \fB-p\fP |\fB--print-avail\fP paquet
 Affiche des renseignements dtaills sur \fIpaquet\fP, tels qu'ils sont
-trouvs dans le fichier \fI/var/lib/dpkg/available\fP.
+trouvs dans le fichier \fI@PREFIX@/var/lib/dpkg/available\fP.
 .TP
 \fB--licence\fP | \fB--license\fP
 Affiche des renseignements sur la licence et le copyright.
@@ -60,7 +60,7 @@
 .TP
 \fB--admindir=\fIdir\fP
 Changer l'endroit o se trouve la base de donnes de \fBdpkg\fR. Par
-dfaut, c'est \fI/var/lib/dpkg\fP.
+dfaut, c'est \fI@PREFIX@/var/lib/dpkg\fP.
 .TP
 \fB--showformat=\fP\fIformat\fR
 On se sert de cette option pour prciser le format de la sortie que produit la
diff -urN dpkg-1.10.21.orig/man/fr/dpkg-scanpackages.8 dpkg-1.10.21/man/fr/dpkg-scanpackages.8
--- dpkg-1.10.21.orig/man/fr/dpkg-scanpackages.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/fr/dpkg-scanpackages.8	2012-07-13 02:13:27.000000000 +0200
@@ -43,7 +43,7 @@
 .PP
 .I rep-de-binaires
 est le nom de l'arborescence binaire (par exemple
-.BR contrib/binary-i386)
+.BR main/binary-darwin-powerpc)
 que l'on veut traiter.
 Il vaut mieux qu'elle soit relative  la racine de l'archive Debian\ ;
 ainsi chaque champ \ Filename\  dans le nouveau fichier \ Packages\ 
diff -urN dpkg-1.10.21.orig/man/fr/dpkg-source.1 dpkg-1.10.21/man/fr/dpkg-source.1
--- dpkg-1.10.21.orig/man/fr/dpkg-source.1	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/fr/dpkg-source.1	2012-07-13 02:13:27.000000000 +0200
@@ -58,13 +58,13 @@
 lit les informations concernant les dpendances envers les bibliothques 
 partages dans les fichiers suivants :
 .BR debian/shlibs.local,
-.BR /etc/dpkg/shlibs.override,
+.BR @PREFIX@/etc/dpkg/shlibs.override,
 le fichier
 .B shlibs,
 (fichier du paquet contenant un fichier qui, selon
 .B objdump,
 satisfait au systme de dpendance envers les bibliothques) ou bien
-.BR /etc/dpkg/shlibs.default.
+.BR @PREFIX@/etc/dpkg/shlibs.default.
 Le premier trouv est utilis. Voyez le
 .I Debian packaging manual
 pour des dtails sur le format des fichiers qui traitent des dpendances 
@@ -845,9 +845,7 @@
 version 2 ou suprieure pour le copyright. Il n'y a
 .B pas
 de garantie. Voyez
-.B /usr/share/doc/dpkg/copyright
-et
-.B /usr/share/common-licenses/GPL
+.B @PREFIX@/share/doc/dpkg/copyright
 pour des prcisions.
 .SH TRADUCTION
 Philippe Batailler, Octobre 2003.
diff -urN dpkg-1.10.21.orig/man/fr/dpkg-split.8 dpkg-1.10.21/man/fr/dpkg-split.8
--- dpkg-1.10.21.orig/man/fr/dpkg-split.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/fr/dpkg-split.8	2012-07-13 02:13:27.000000000 +0200
@@ -162,7 +162,7 @@
 .BI --depotdir " rpertoire"
 Indique un rpertoire diffrent pour la file comprenant les parties en attente
 d'une recomposition automatique. Par dfaut, c'est le rpertoire
-.BR /var/lib/dpkg .
+.BR @PREFIX@/var/lib/dpkg .
 .TP
 .BI --partsize\fR|\fB-S " kbytes"
 Indique (en kilooctets (1024 octets)) la taille maximum d'une partie lors 
@@ -233,7 +233,7 @@
 pas prsente dans les fichiers produits.
 .SH FICHIERS
 .TP
-.B /var/lib/dpkg/parts
+.B @PREFIX@/var/lib/dpkg/parts
 Le rpertoire par dfaut de la file contenant les fichiers qui attendent une
 recomposition automatique.
 
@@ -254,7 +254,9 @@
 Ils ont t dits sous la  GNU General Public Licence  ; il n'y a
 PAS de GARANTIE.
 Voyez
-.B /usr/share/dpkg/copyright
+.B @PREFIX@/share/dpkg/copyright
 et
-.B /usr/share/common-licenses/GPL
+.B @PREFIX@/share/common-licenses/GPL
 pour des prcisions.
+.PP
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
diff -urN dpkg-1.10.21.orig/man/fr/dpkg-statoverride.8 dpkg-1.10.21/man/fr/dpkg-statoverride.8
--- dpkg-1.10.21.orig/man/fr/dpkg-statoverride.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/fr/dpkg-statoverride.8	2012-07-13 02:13:27.000000000 +0200
@@ -55,10 +55,10 @@
 .TP
 .I --admindir
 Changer le rpertoire de la base de donnes de dpkg, o se trouve aussi le
-fichier statoverride. par dfaut, c'est /var/lib/dpkg.
+fichier statoverride. par dfaut, c'est @PREFIX@/var/lib/dpkg.
 .SH FICHIERS
 .TP
-.I /var/lib/dpkg/statoverride
+.I @PREFIX@/var/lib/dpkg/statoverride
 Ce fichier contient la liste actuelle des annulations concernant le systme.
 Il se trouve dans le rpertoire d'administration de Dpkg, avec les autres 
 fichiers importants comme \ status\  ou \ available\ .
@@ -76,4 +76,6 @@
 C'est un logiciel libre ; voyez la licence publique gnrale du projet GNU
 version 2 ou suprieure pour les droits de copie. Il n'y a PAS de garantie.
 .SH TRADUCTEUR
-Philippe Batailler, Aot 2001.
\ No newline at end of file
+Philippe Batailler, Aot 2001.
+.PP
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
diff -urN dpkg-1.10.21.orig/man/fr/dpkg.8 dpkg-1.10.21/man/fr/dpkg.8
--- dpkg-1.10.21.orig/man/fr/dpkg.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/fr/dpkg.8	2012-07-13 02:13:27.000000000 +0200
@@ -165,7 +165,7 @@
 configuration. Si l'on donne l'option \fB-a\fP ou \fB--pending\fP  la 
 place d'un nom de paquet, tous les paquets non dpaquets, mais qui sont
 marqus comme devant tre supprims ou purgs
-dans le file \fI/var/lib/dpkg/status\fP, sont respectivement
+dans le file \fI@PREFIX@/var/lib/dpkg/status\fP, sont respectivement
 supprims et purgs.
 
 La suppression des paquets comporte les tapes suivantes : 
@@ -188,7 +188,7 @@
 proviennent de \fIfichier-paquet\fP. Le \fIfichier-paquet\fP
 distribu avec Debian est appel simplement \fIpaquet\fP.
 \fBdpkg\fP garde son propre enregistrement des paquets disponibles dans
-\fI/var/lib/dpkg/available\fP.
+\fI@PREFIX@/var/lib/dpkg/available\fP.
 .TP
 \fBdpkg -A\fP | \fB--record-avail\fP \fIfichier-paquet\fP ...
 Met  jour les ides de \fBdpkg\fP et de \fBdselect\fP sur les paquets
@@ -306,7 +306,7 @@
 
 .SH OPTIONS
 On peut spcifier une option  la fois sur la ligne de commande et dans le
-fichier de configuration de dpkg, \fI/etc/dpkg/dpkg.cfg\fP. Chaque ligne de
+fichier de configuration de dpkg, \fI@PREFIX@/etc/dpkg/dpkg.cfg\fP. Chaque ligne de
 ce fichier est soit une option (identique  une option en ligne de commande
 mais sans tiret), soit un commentaire, commenant par \fB#\fR.
 .br
@@ -479,14 +479,14 @@
 .TP
 \fB--root=\fP\fIrep\fP | \fB--admindir=\fP\fIrep\fP | \fB--instdir=\fP\fIrep\fP
 Changer les rpertoires par dfaut. \fBadmindir\fP est par dfaut 
-\fI/var/lib/dpkg\fP et contient beaucoup de fichiers qui donnent des
+\fI@PREFIX@/var/lib/dpkg\fP et contient beaucoup de fichiers qui donnent des
 informations sur l'tat des paquets installs ou non installs, etc. 
 \fBinstdir\fP est par dfaut \fI/\fP et se rfre au rpertoire o les 
 paquets doivent tre installs. \fBinstdir\fP est aussi le rpertoire 
 donn  \fBchroot\fP(2) avant que ne soient lances les scripts d'installation
 du \fIpaquet\fP, ce qui signifie que ces scripts voient \fBinstdir\fP 
 comme le rpertoire de root. Changer \fBroot\fP change \fBinstdir\fP en
-\fIrep\fP et \fBadmindir\fP en \fIrep\fP\fB/var/lib/dpkg\fP.
+\fIrep\fP et \fBadmindir\fP en \fIrep\fP\fB@PREFIX@/var/lib/dpkg\fP.
 .TP
 \fB-O\fP | \fB--selected-only\fP
 Traiter seulement les paquets qui sont slectionns pour l'installation. 
@@ -505,16 +505,16 @@
 
 .SH FICHIERS
 .TP
-.I /etc/dpkg/dpkg.cfg
+.I @PREFIX@/etc/dpkg/dpkg.cfg
 Fichier de configuration contenant les options par dfaut.
 .P
 Les autres fichiers rpertoris ici sont dans leur rpertoire par dfaut, voyez
 l'option \fB--admindir\fP pour savoir changer l'emplacement de ces fichiers.
 .TP
-.I /var/lib/dpkg/available
+.I @PREFIX@/var/lib/dpkg/available
 Liste des paquets disponibles.
 .TP
-.I /var/lib/dpkg/status
+.I @PREFIX@/var/lib/dpkg/status
 tats des paquets disponibles. Ce fichier contient des informations qui
 permettent de savoir si un paquet est marqu comme devant tre supprim
 ou pas, devant tre install ou pas, etc. Voyez la section
@@ -621,7 +621,7 @@
 .SH AUTEURS
 .nf
 \fBdpkg\fP fut d'abord crit par Ian Jackson, puis mis  jour par beaucoup
-d'autres gens. Voyez le fichier \fB/usr/share/doc/dpkg/THANKS.gz\fP pour la 
+d'autres gens. Voyez le fichier \fB@PREFIX@/share/doc/dpkg/THANKS.gz\fP pour la 
 liste des personnes qui ont contribu  \fBdpkg\fP.
 .fi
 .SH "TRADUCTION"
diff -urN dpkg-1.10.21.orig/man/fr/install-info.8 dpkg-1.10.21/man/fr/install-info.8
--- dpkg-1.10.21.orig/man/fr/install-info.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/fr/install-info.8	2012-07-13 02:13:27.000000000 +0200
@@ -157,7 +157,7 @@
 dans
 .IR rep-info . 
 Par dfaut, c'est
-.BR /usr/info .
+.BR @PREFIX@/share/info .
 .TP
 .BI \-\-align= nnn " [dconseill]"
 Prcise que l'espace d'indentation de la premire ligne de la description
@@ -272,6 +272,8 @@
 emacs(1), info(1), gzip(1)
 .SH "TRADUCTION"
 Philippe Batailler. Dec 2000
+.PP
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
 .SH COPYRIGHT
 Copyright 1994, Ian Jackson.
 .B install\-info
diff -urN dpkg-1.10.21.orig/man/fr/update-alternatives.8 dpkg-1.10.21/man/fr/update-alternatives.8
--- dpkg-1.10.21.orig/man/fr/update-alternatives.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/fr/update-alternatives.8	2012-07-13 02:13:27.000000000 +0200
@@ -4,7 +4,7 @@
 .\" it under the terms of the GNU General Public License as published
 .\" by the Free Software Foundation; either version 2 of the License, or
 .\" (at your option) any later version.  There is NO WARRANTY.  You can
-.\" find the GNU GPL in /usr/share/common-licenses/GPL on any Debian system.
+.\" find the GNU GPL in @PREFIX@/share/common-licenses/GPL on any Debian system.
 .\" traduction de la rvision CVS 1.8
 .TH UPDATE-ALTERNATIVES 8 "19 January 1998" "Debian Project" "dpkg utilities"
 .SH NOM
@@ -81,11 +81,11 @@
 .BR nvi (1)
 sont tous les deux installs, le systme des \ alternatives\  fait que le 
 nom gnrique 
-.I /usr/bin/editor
+.I @PREFIX@/bin/editor
 renvoie par dfaut 
-.I /usr/bin/nvi.
+.I @PREFIX@/bin/nvi.
 L'administrateur systme peut remplacer cette assignation par
-.I /usr/bin/ed
+.I @PREFIX@/bin/ed
 et le systme des \ alternatives\  ne la changera pas tant qu'on ne lui
 aura pas demand explicitement de le faire.
 .PP
@@ -96,7 +96,7 @@
 lequel nom est  son tour un lien symbolique vers le fichier rellement
 vis. Les modifications faites par l'administrateur systme sont ainsi
 confines dans le rpertoire 
-.I /etc :
+.I @PREFIX@/etc :
 le FHS (lisez-le) donne de Bonnes Raisons de faire ainsi.
 .PP
 Chaque fois qu'un paquet proposant un fichier pour une fonction dtermine,
@@ -117,9 +117,9 @@
 de 
 .BR vi (1) 
 sont installes, la page de manuel qui est vise par
-.I /usr/share/man/man1/vi.1
+.I @PREFIX@/share/man/man1/vi.1
 devrait correspondre  
-.IR /usr/bin/vi.
+.IR @PREFIX@/bin/vi.
 .B update-alternatives
 gre ce problme avec les liens
 .I principaux ( master )
@@ -175,7 +175,7 @@
 .TP
 nom gnrique
 C'est un nom, par exemple
-.IR /usr/bin/editor,
+.IR @PREFIX@/bin/editor,
 qui renvoie,  travers le systme des  alternatives ,  l'un des fichiers qui
 remplissent des fonctions similaires.
 .TP
@@ -190,13 +190,13 @@
 rpertoire des alternatives 
 C'est le rpertoire qui contient les liens symboliques ; il s'agit 
 par dfaut de
-.IR /etc/alternatives.
+.IR @PREFIX@/etc/alternatives.
 .TP
 rpertoire administratif
 C'est le rpertoire qui contient des renseignements sur l'tat de
 .BR update-alternatives. 
 Il s'agit par dfaut de
-.IR /var/lib/dpkg/alternatives.
+.IR @PREFIX@/var/lib/dpkg/alternatives.
 .TP
 groupe de liens
 C'est un ensemble de liens symboliques corrls, de manire qu'on puisse les
@@ -387,12 +387,12 @@
 est dsactiv.
 .SH FICHIERS
 .TP
-.I /etc/alternatives/
+.I @PREFIX@/etc/alternatives/
 Le rpertoire des  alternatives  par dfaut.
 Peut tre remplac avec l'option
 .B --altdir.
 .TP
-.I /var/lib/dpkg/alternatives/
+.I @PREFIX@/var/lib/dpkg/alternatives/
 Le rpertoire administratif par dfaut.
 Peut tre remplac avec l'option
 .B --admindir
@@ -432,7 +432,7 @@
 version 2 ou suprieure pour les conditions du copyright. Il n'y a
 AUCUNE garantie.
 .PP
-On peut trouver la licence GNU GPL dans /usr/share/common-licenses/GPL 
+On peut trouver la licence GNU GPL dans @PREFIX@/share/doc/dpkg/copyright 
 sur tous les systmes Debian.
 .\" .SH REMERCIEMENTS
 .SH "VOIR AUSSI"
diff -urN dpkg-1.10.21.orig/man/ja/cleanup-info.8 dpkg-1.10.21/man/ja/cleanup-info.8
--- dpkg-1.10.21.orig/man/ja/cleanup-info.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/ja/cleanup-info.8	2012-07-13 02:13:27.000000000 +0200
@@ -37,7 +37,7 @@
 
 .SH 
 .TP
-.I "/usr/info/dir  <>/dir"
+.I "@PREFIX@/share/info/dir  <>/dir"
 info  ".lock" 
 
 .SH 
@@ -47,6 +47,8 @@
 .BR info (1).
 .SH 
 Copyright (C) 1996 Kim-Minh Kaplan.
+.PP
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
 .sp
 This is free software; see the GNU General Public Licence
 version 2 or later for copying conditions.  There is NO warranty.
diff -urN dpkg-1.10.21.orig/man/ja/dpkg-deb.1 dpkg-1.10.21/man/ja/dpkg-deb.1
--- dpkg-1.10.21.orig/man/ja/dpkg-deb.1	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/ja/dpkg-deb.1	2012-07-13 02:13:27.000000000 +0200
@@ -260,9 +260,9 @@
  Ian Jackson 
 (Copyright (C)1995-1996)GNU 
 
-.B /usr/share/doc/dpkg/copyright
+.B @PREFIX@/share/doc/dpkg/copyright
 
-.B /usr/share/common-licenses/GPL
+.B @PREFIX@/share/common-licenses/GPL
 
 
 (
@@ -271,10 +271,13 @@
 Copyright (C)1995-1996
 by him and released under the GNU General Public Licence; there is NO
 WARRANTY.  See
-.B /usr/share/doc/dpkg/copyright
+.B @PREFIX@/share/doc/dpkg/copyright
 and
-.B /usr/share/common-licenses/GPL
+.B @PREFIX@/share/common-licenses/GPL
 for details.
+.PP
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
+.PP
 )
 .SH 
  <kise@fuyuneko.jp>
diff -urN dpkg-1.10.21.orig/man/ja/dpkg-divert.8 dpkg-1.10.21/man/ja/dpkg-divert.8
--- dpkg-1.10.21.orig/man/ja/dpkg-divert.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/ja/dpkg-divert.8	2012-07-13 02:13:27.000000000 +0200
@@ -86,6 +86,7 @@
 overriding a package's version of a file" 
 .SH 
 Copyright (C) 1995 Ian Jackson.
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
 .sp
 This is free software; see the GNU General Public Licence
 version 2 or later for copying conditions.  There is NO warranty.
diff -urN dpkg-1.10.21.orig/man/ja/dpkg-scanpackages.8 dpkg-1.10.21/man/ja/dpkg-scanpackages.8
--- dpkg-1.10.21.orig/man/ja/dpkg-scanpackages.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/ja/dpkg-scanpackages.8	2012-07-13 02:13:27.000000000 +0200
@@ -103,6 +103,8 @@
 .I newmaintainer
 
 .PP
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
+.PP
  Packages  override 
 Debian 
 .I indices
diff -urN dpkg-1.10.21.orig/man/ja/dpkg-statoverride.8 dpkg-1.10.21/man/ja/dpkg-statoverride.8
--- dpkg-1.10.21.orig/man/ja/dpkg-statoverride.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/ja/dpkg-statoverride.8	2012-07-13 02:13:27.000000000 +0200
@@ -99,14 +99,14 @@
 .TP
 .I --admindir
 .\"O Change the directory of the dpkg database where the statoverride file is
-.\"O also stored. Defaults to /var/lib/dpkg.
+.\"O also stored. Defaults to @PREFIX@/var/lib/dpkg.
 dpkg 
 statoverride 
- /var/lib/dpkg
+ @PREFIX@/var/lib/dpkg
 .\"O .SH FILES
 .SH 
 .TP
-.I /var/lib/dpkg/statoverride
+.I @PREFIX@/var/lib/dpkg/statoverride
 .\"O File which contains the current list of stat overrides of the system. It
 .\"O is located in the dpkg administration directory, along with other files
 .\"O important to dpkg, such as `status' or `available'.
@@ -127,6 +127,8 @@
 .UR mailto:wakkerma@debian.org
 <wakkerma@debian.org>
 .UE
+.PP
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
 .sp
 This is free software; see the GNU General Public Licence version 2 or
 later for copying conditions.  There is NO warranty.
diff -urN dpkg-1.10.21.orig/man/ja/dpkg.8 dpkg-1.10.21/man/ja/dpkg.8
--- dpkg-1.10.21.orig/man/ja/dpkg.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/ja/dpkg.8	2012-07-13 02:13:27.000000000 +0200
@@ -188,7 +188,7 @@
 \fB--remove\fP (
 \fIconffiles\fP )
  \fB-a\fP  \fB--pending\fP 
-\fI/var/lib/dpkg/status\fP  remove 
+\fI@PREFIX@/var/lib/dpkg/status\fP  remove 
 purge  remove 
 purge 
 
@@ -211,7 +211,7 @@
 
 Debian  \fIPackages-file\fP 
 \fIPackages\fP \fBdpkg\fP 
-\fI/var/lib/dpkg/available\fP 
+\fI@PREFIX@/var/lib/dpkg/available\fP 
 .TP
 \fBdpkg -A\fP | \fB--record-avail\fP \fIpackage_file\fP ...
 \fBdpkg\fP  \fBdselect\fP 
@@ -326,7 +326,7 @@
 
 .SS 
  \fBdpkg\fP 
- \fI/etc/dpkg/dpkg.cfg\fP 
+ \fI@PREFIX@/etc/dpkg/dpkg.cfg\fP 
 1  1 (
 )( \fB#\fR )
 
@@ -492,13 +492,13 @@
 \fBadmindir\fP 
 
 
-\fI/var/lib/dpkg\fP \fBinstdir\fP 
+\fI@PREFIX@/var/lib/dpkg\fP \fBinstdir\fP 
  \fI/\fP 
 \fBinstdir\fP 
  \fBchroot\fP(2) 
  \fBinstdir\fP 
 \fBroot\fP \fBinstdir\fP  \fIdir\fP \fBadmindir\fP
- \fIdir\fP\fB/var/lib/dpkg\fP 
+ \fIdir\fP\fB@PREFIX@/var/lib/dpkg\fP 
 .TP
 \fB-O\fP | \fB--selected-only\fP
 ()
@@ -516,17 +516,17 @@
 
 .SH 
 .TP
-.I /etc/dpkg.cfg
+.I @PREFIX@/etc/dpkg.cfg
 
 .P
 
 \fB--admindir\fP 
 
 .TP
-.I /var/lib/dpkg/available
+.I @PREFIX@/var/lib/dpkg/available
 
 .TP
-.I /var/lib/dpkg/status
+.I @PREFIX@/var/lib/dpkg/status
 
 
 \fB \fP 
diff -urN dpkg-1.10.21.orig/man/ja/install-info.8 dpkg-1.10.21/man/ja/install-info.8
--- dpkg-1.10.21.orig/man/ja/install-info.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/ja/install-info.8	2012-07-13 02:13:27.000000000 +0200
@@ -292,12 +292,12 @@
 .\"O be located in
 .\"O .IR infodir .
 .\"O The default is
-.\"O .BR /usr/info .
+.\"O .BR @PREFIX@/share/info .
 .B dir
  Info 
 .I infodir
 
-.B /usr/info
+.B @PREFIX@/share/info
 
 .TP
 .\"O .BI \-\-align= nnn " [deprecated]"
@@ -485,6 +485,8 @@
 later for copying conditions.  There is
 .I no
 warranty.
+.PP
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
 .SH 
   <sekido@mbox.kyoto-inet.or.jp>
 .SH 
diff -urN dpkg-1.10.21.orig/man/ja/update-alternatives.8 dpkg-1.10.21/man/ja/update-alternatives.8
--- dpkg-1.10.21.orig/man/ja/update-alternatives.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/ja/update-alternatives.8	2012-07-13 02:13:27.000000000 +0200
@@ -4,7 +4,7 @@
 .\" it under the terms of the GNU General Public License as published
 .\" by the Free Software Foundation; either version 2 of the License, or
 .\" (at your option) any later version.  There is NO WARRANTY.  You can
-.\" find the GNU GPL in /usr/share/common-licenses/GPL on any Debian system.
+.\" find the GNU GPL in @PREFIX@/share/common-licenses/GPL on any Debian system.
 .\"
 .\" Original manpage cvs revision 1.8.2.2
 .\"WORD:	action		
@@ -87,11 +87,11 @@
 .BR nvi (1)
 
 
-.I /usr/bin/editor
+.I @PREFIX@/bin/editor
 
-.I /usr/bin/nvi
+.I @PREFIX@/bin/nvi
 
-.I /usr/bin/ed
+.I @PREFIX@/bin/ed
 
 
 alternatives 
@@ -101,7 +101,7 @@
 
 
 
-.I /etc
+.I @PREFIX@/etc
 
  FHS 
 .PP
@@ -120,9 +120,9 @@
 
 .BR vi (1)
 
-.I /usr/share/man/man1/vi.1
+.I @PREFIX@/share/man/man1/vi.1
  man 
-.I /usr/bin/vi
+.I @PREFIX@/bin/vi
 
 .B update-alternatives
 
@@ -179,7 +179,7 @@
 
 .TP
  (generic name)
-.I /usr/bin/editor
+.I @PREFIX@/bin/editor
  alternatives 
 
 .TP
@@ -194,12 +194,12 @@
 .TP
 alternatives 
 symlink 
-.IR /etc/alternatives 
+.IR @PREFIX@/etc/alternatives 
 .TP
 administrative 
 .B update-alternatives
 
-.IR /var/lib/dpkg/alternatives 
+.IR @PREFIX@/var/lib/dpkg/alternatives 
 .TP
 
  symlink 
@@ -384,12 +384,12 @@
 
 .SH 
 .TP
-.I /etc/alternatives/
+.I @PREFIX@/etc/alternatives/
  alternatives 
 .B --altdir
 
 .TP
-.I /var/lib/dpkg/alternatives/
+.I @PREFIX@/var/lib/dpkg/alternatives/
  administration 
 .B --admindir
 
@@ -425,7 +425,9 @@
 This is free documentation; see the GNU General Public Licence
 version 2 or later for copying conditions.  There is NO WARRANTY.
 .PP
-You can find the GNU GPL in /usr/share/common-licenses/GPL on any Debian system.
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
+.PP
+You can find the GNU GPL in @PREFIX@/share/common-licenses/GPL on any Debian system.
 .SH 
 .BR ln (1),
 FHS, the Filesystem Hierarchy Standard.
diff -urN dpkg-1.10.21.orig/man/pt_BR/update-alternatives.8 dpkg-1.10.21/man/pt_BR/update-alternatives.8
--- dpkg-1.10.21.orig/man/pt_BR/update-alternatives.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/pt_BR/update-alternatives.8	2012-07-13 02:13:27.000000000 +0200
@@ -4,7 +4,7 @@
 .\" sob os termos da Lincena Pblica Geral GNU como publicado pela
 .\" Free Software Foundation; verso 2 da Licena ou (a sua escolha)
 .\" qualquer verso posterior. NO existe garantia. Voc pode encontrar a
-.\" GNU GPL em /usr/share/common-licenses/GPL em qualquer sistema Debian.
+.\" GNU GPL em @PREFIX@/share/common-licenses/GPL em qualquer sistema Debian.
 .TH UPDATE-ALTERNATIVES 8 "19 de Janeiro de 1998" "Projeto Debian" "utilitrios dpkg"
 .SH NOME
 update-alternatives \- mantm ligaes simblicas determinando comandos padres
@@ -66,12 +66,12 @@
 .BR nvi (1)
 estejam ambos instalados no sistema, o sistema de alternativas far com
 que o nome genrico
-.I /usr/bin/editor
+.I @PREFIX@/bin/editor
 refira-se a
-.I /usr/bin/nvi
+.I @PREFIX@/bin/nvi
 por padro. O administrador do sistema pode sobreescrever isto e fazer com
 que refira-se a
-.I /usr/bin/ed
+.I @PREFIX@/bin/ed
 e o sistema de alternativas no ir alterar esta configurao at que
 explicitamente requisitado a faz-lo.
 .PP
@@ -82,7 +82,7 @@
 o qual , por sua vez, uma ligao simblica para o arquivo atualmente
 referenciado. Isto  feito para que as mudanas do administrador do
 sistema possam ser confinadas dentro do diretrio
-.I /etc
+.I @PREFIX@/etc
 : a FHS (q.v.) d razes de porqu isto  um Boa Coisa.
 .PP
 Quando cada pacote provendo um arquivo com uma funcionalidade particular
@@ -102,9 +102,9 @@
 verses do editor
 .BR vi (1)
 esto instaladas, a pgina de manual referenciada por
-.I /usr/share/man/man1/vi.1
+.I @PREFIX@/share/man/man1/vi.1
 dever corresponder ao executvel referenciado por
-.IR /usr/bin/vi .
+.IR @PREFIX@/bin/vi .
 .B update-alternatives
 gerencia isso por meio de ligaes
 .I master
@@ -164,7 +164,7 @@
 nome genrico
 Um nome,  como
 A name, like
-.IR /usr/bin/editor ,
+.IR @PREFIX@/bin/editor ,
 o qual refere-se, atravs do sistema de alternativas, a um ou a diversos
 arquivos de funo similar.
 .TP
@@ -179,12 +179,12 @@
 .TP
 diretrio de alternativas
 Um diretrio, por padro
-.IR /etc/alternatives ,
+.IR @PREFIX@/etc/alternatives ,
 contendo as ligaes simblicas.
 .TP
 diretrio administrativo
 Um diretrio, por padro
-.IR /var/lib/dpkg/alternatives ,
+.IR @PREFIX@/var/lib/dpkg/alternatives ,
 contendo informao de estado de
 .BR update-alternatives .
 .TP
@@ -318,11 +318,11 @@
 Exibe todos os alvos de uma ligao em grupo.
 .SH ARQUIVOS
 .TP
-.I /etc/alternatives/
+.I @PREFIX@/etc/alternatives/
 O diretrio de alternativas padro. Pode ser sobreescrito pela opo
 .B --altdir
 .TP
-.I /var/lib/dpkg/alternatives/
+.I @PREFIX@/var/lib/dpkg/alternatives/
 O diretrio de administrao padro. Pode ser sobreescrito pela opo
 .B --admindir
 .SH "STATUS DE SADA"
@@ -358,7 +358,9 @@
 Isto  documentao livre; veja a Licena Pblica Geral GNU verso 2 ou
 posterior para condies de cpia. NO existe garantia.
 .PP
-Voc pode encontrar a GNU GPL em /usr/share/common-licenses/GPL em
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
+.PP
+Voc pode encontrar a GNU GPL em @PREFIX@/share/common-licenses/GPL em
 qualquer sistema Debian.
 .SH "VEJA TAMBM"
 .BR ln (1),
diff -urN dpkg-1.10.21.orig/man/ru/dpkg.8 dpkg-1.10.21/man/ru/dpkg.8
--- dpkg-1.10.21.orig/man/ru/dpkg.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/ru/dpkg.8	2012-07-13 02:13:27.000000000 +0200
@@ -232,7 +232,7 @@
  
 .B --pending,
   , ,    
-.I /var/lib/dpkg/status
+.I @PREFIX@/var/lib/dpkg/status
     , ,  
  .
 
@@ -258,7 +258,7 @@
    
 .IR  ,
    
-.IR /var/lib/dpkg/available .
+.IR @PREFIX@/var/lib/dpkg/available .
 
 .TP
 .BR "dpkg --update-avail" " | " "--merge-avail \fP\fI< Packages>"
@@ -279,7 +279,7 @@
    Debian GNU/Linux.
 .B dpkg
      
-.IR /var/lib/dpkg/available .
+.IR @PREFIX@/var/lib/dpkg/available .
 
 .TP
 .BR "dpkg -A" " | "  "--record-avail \fP\fI<  >" ...
@@ -309,7 +309,7 @@
  ,   .  
 .I    
  ,     
-.BR /var/lib/dpkg/available . 
+.BR @PREFIX@/var/lib/dpkg/available . 
  
 .I    
       .  (
@@ -454,7 +454,7 @@
        ,   
  
 .BR dpkg \~--
-.IR /etc/dpkg/dpkg.cfg .
+.IR @PREFIX@/etc/dpkg/dpkg.cfg .
          (
     ,    ),  
  (  
@@ -639,7 +639,7 @@
 \fB--root=\fP\fIdir\fP | \fB--admindir=\fP\fIdir\fP | \fB--instdir=\fP\fIdir\fP
    .   admindir  
 
-.B /var/lib/dpkg 
+.B @PREFIX@/var/lib/dpkg 
    ,       
      .\~. 
 
@@ -660,7 +660,7 @@
  
 .BR admindir \~--
  
-.IB dir /var/lib/dpkg \P.
+.IB dir @PREFIX@/var/lib/dpkg \P.
 
 .TP
 .BR -O " | " --selected-only
@@ -688,7 +688,7 @@
 .SH 
 
 .TP
-.I /etc/dpkg/dpkg.cfg
+.I @PREFIX@/etc/dpkg/dpkg.cfg
      .
 .P
         ,
@@ -697,11 +697,11 @@
  ,     .
 
 .TP
-.I /var/lib/dpkg/available
+.I @PREFIX@/var/lib/dpkg/available
   .
 
 .TP
-.I /var/lib/dpkg/status
+.I @PREFIX@/var/lib/dpkg/status
   .      ,
       ,    , 
 .\~.  . 
@@ -756,14 +756,14 @@
 .br
 
         
-.BR /var/lib/dpkg/available :
+.BR @PREFIX@/var/lib/dpkg/available :
 .br
 \fB     dpkg --print-avail elvis vim | less\fP
 .br
 
    :
 .br
-\fB     less /var/lib/dpkg/available\fP
+\fB     less @PREFIX@/var/lib/dpkg/available\fP
 .br
 
 
@@ -814,8 +814,9 @@
 
 .SH 
 .
-.BR /usr/share/doc/dpkg/THANKS ,
+.BR @PREFIX@/share/doc/dpkg/THANKS ,
    ,    
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
 .BR dpkg .
 
 .SH 
diff -urN dpkg-1.10.21.orig/man/sv/dpkg-deb.1 dpkg-1.10.21/man/sv/dpkg-deb.1
--- dpkg-1.10.21.orig/man/sv/dpkg-deb.1	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/sv/dpkg-deb.1	2012-07-13 02:13:27.000000000 +0200
@@ -248,8 +248,9 @@
 och denna manualsida skrevs av Ian Jackson.
 De r upphovsrttsskyddade 1995-1996 av honom och slppta under
 GNU General Public Licence; det finns INGEN garanti.
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
 Se
-.B /usr/share/doc/dpkg/copyright
+.B @PREFIX@/share/doc/dpkg/copyright
 och
-.B /usr/share/common-licenses/GPL
+.B @PREFIX@/share/common-licenses/GPL
 fr detaljer.
diff -urN dpkg-1.10.21.orig/man/sv/dpkg-query.8 dpkg-1.10.21/man/sv/dpkg-query.8
--- dpkg-1.10.21.orig/man/sv/dpkg-query.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/sv/dpkg-query.8	2012-07-13 02:13:27.000000000 +0200
@@ -16,7 +16,7 @@
 \fB-l\fP | \fB--list\fP \fIpaketnamnsmnster\fP ...
 Lista paket som matchar det givna mnstret.
 Om inget \fIpaketnamnsmnster\fP anges listas alla paket i
-\fI/var/lib/dpkg/available\fP.
+\fI@PREFIX@/var/lib/dpkg/available\fP.
 Skalets normala jokertecken tillts i \fIpaketnamnsmnster\fP.
 Observera att du sannolikt mste skriva \fIpaketnamnsmnster\fP inom
 citationstecken fr att frhindra att skalet expanderar filnamnet.
@@ -49,7 +49,7 @@
 .TP
 \fB-p\fP |\fB--print-avail\fP paket
 Visar detaljer om \fIpaket\fP frn
-\fI/var/lib/dpkg/available\fP.
+\fI@PREFIX@/var/lib/dpkg/available\fP.
 .TP
 \fB--licence\fP | \fB--license\fP
 Visar licensvillkor och upphovsrttsinformation.
@@ -61,7 +61,7 @@
 .TP
 \fB--admindir=\fIkat\fP
 ndra platsen fr \fBdpkg\fR-databasen.
-Frval r \fI/var/lib/dpkg\fP.
+Frval r \fI@PREFIX@/var/lib/dpkg\fP.
 .TP
 \fB--showformat=\fP\fIformat\fR
 Denna flagga anvnds fr att ange formatet p det utdata \fB--show\fP
@@ -85,6 +85,7 @@
 .UR mailto:wakkerma@debian.org
 <wakkerma@debian.org>
 .UE
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
 .sp
 Detta r fri programvara; se GNU General Public License version 2 eller
 senare fr kopieringsvillkor. Det finns INGEN garanti.
diff -urN dpkg-1.10.21.orig/man/sv/dpkg-split.8 dpkg-1.10.21/man/sv/dpkg-split.8
--- dpkg-1.10.21.orig/man/sv/dpkg-split.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/sv/dpkg-split.8	2012-07-13 02:13:27.000000000 +0200
@@ -169,7 +169,7 @@
 Anger en alternativ katalog fr kn av delar som vntar p automatisk
 sammanslagning.
 Frvalet r
-.BR /var/lib/dpkg .
+.BR @PREFIX@/var/lib/dpkg .
 .TP
 .BI --partsize\fR|\fB-S " kbyte"
 Anger maximal storlek vid delning, i kilobyte (1024 byte).
@@ -239,7 +239,7 @@
 som genereras.
 .SH FILER
 .TP
-.B /var/lib/dpkg/parts
+.B @PREFIX@/var/lib/dpkg/parts
 Frvald k-katalog fr delfiler som vntar p automatisk sammanslagning.
 
 Filnamnen som anvnds i denna katalog r i ett internt format fr
@@ -256,10 +256,11 @@
 och denna manualsida skrevs av Ian Jackson.
 Upphovsrtten  1995-1996 ligger hos honom och de r slppta under GNU
 General Public Licence; det finns INGEN GARANTI.
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
 Se
-.B /usr/share/dpkg/copyright
+.B @PREFIX@/share/dpkg/copyright
 och
-.B /usr/share/common-licenses/GPL
+.B @PREFIX@/share/common-licenses/GPL
 fr ytterligare detaljer.
 
 Denna manualsida versattes av Peter Karlsson.
diff -urN dpkg-1.10.21.orig/man/sv/dpkg.8 dpkg-1.10.21/man/sv/dpkg.8
--- dpkg-1.10.21.orig/man/sv/dpkg.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/sv/dpkg.8	2012-07-13 02:13:27.000000000 +0200
@@ -157,7 +157,7 @@
 \fB-P\fP eller \fB--purge\fP tar bort allting, inklusive
 konfigurationsfiler.
 Om \fB-a\fP eller \fB--pending\fP anges istllet fr ett paketnamn kommer
-alla uppackade paket som i filen \fI/var/lib/dpkg/status\fP markerats fr
+alla uppackade paket som i filen \fI@PREFIX@/var/lib/dpkg/status\fP markerats fr
 att tas bort eller rensas att tas bort eller rensas, respektive.
 
 Borttagning av ett paket bestr av fljande steg:
@@ -174,7 +174,7 @@
 .TP
 .BI "dpkg  -p|--print-avail " paket
 Visar detaljer om \fIpaket\fP frn
-\fI/var/lib/dpkg/available\fP.
+\fI@PREFIX@/var/lib/dpkg/available\fP.
 .TP
 \fBdpkg --update-avail\fP | \fB--merge-avail\fP \fIPackages-fil\fP
 Uppdatera \fBdpkg\fPs och \fBdselect\fPs lista ver vilka paket som finns
@@ -186,7 +186,7 @@
 \fIPackages-filerna\fP som medfljer Debian heter helt enkelt
 \fIPackages\fP.
 \fBdpkg\fP behller sin lista ver tillgngliga paket i
-\fI/var/lib/dpkg/available\fP.
+\fI@PREFIX@/var/lib/dpkg/available\fP.
 .TP
 \fBdpkg -A\fP | \fB--record-avail\fP \fIpaketfil\fP ...
 Uppdatera \fBdpkg\fPs och \fBdselect\fPs lista ver vilka paket som finns
@@ -205,7 +205,7 @@
 \fBdpkg -l\fP | \fB--list\fP \fIpaketnamnsmnster\fP ...
 Lista paket som matchar det givna mnstret.
 Om inget \fIpaketnamnsmnster\fP anges listas alla paket i
-\fI/var/lib/dpkg/available\fP.
+\fI@PREFIX@/var/lib/dpkg/available\fP.
 Skalets normala jokertecken tillts i \fIpaketnamnsmnster\fP.
 (Du mste sannolikt skriva \fIpaketnamnsmnster\fP inom citationstecken
 fr att frhindra att skalet expanderar filnamnet.
@@ -310,7 +310,7 @@
 
 .SH FLAGGOR
 Alla flaggorna kan ges bde p kommandoraden och i \fBdpkg\fPs
-konfigurationsfil \fI/etc/dpkg/dpkg.cfg\fP.
+konfigurationsfil \fI@PREFIX@/etc/dpkg/dpkg.cfg\fP.
 En rad i konfigurationsfilen r antingen en flagga (precis samma som p
 kommandoraden, men utan inledande bindestreck) eller en kommentar (om den
 brjar med ett \fB#\fR).
@@ -472,13 +472,13 @@
 .TP
 \fB--root=\fP\fIkat\fP | \fB--admindir=\fP\fIkat\fP | \fB--instdir=\fP\fIkat\fP
 ndra standardkataloger.
-Frval fr \fBadmindir\fP r \fI/var/lib/dpkg\fP, och innehller filer som
+Frval fr \fBadmindir\fP r \fI@PREFIX@/var/lib/dpkg\fP, och innehller filer som
 ger information om status fr installerade och ej installerade paket, osv.
 Frval fr \fBinstdir\fP r \fI/\fP och r den katalog som skickas som
 parameter till \fBchroot\fP(2) innan paketets installationsfiler krs,
 vilket betyder att skripten ser \fBinstdir\fP som rotkatalog.
 Om du ndrar \fBroot\fP ndrar du \fBinstdir\fP till \fIkat\fP och
-\fBadmindir\fP till \fIkat\fP\fB/var/lib/dpkg\fP.
+\fBadmindir\fP till \fIkat\fP\fB@PREFIX@/var/lib/dpkg\fP.
 .TP
 \fB-O\fP | \fB--selected-only\fP
 Hantera endast paket som markerats fr installation.
@@ -496,17 +496,17 @@
 
 .SH FILER
 .TP
-.I /etc/dpkg/dpkg.cfg
+.I @PREFIX@/etc/dpkg/dpkg.cfg
 Konfigurationsfil med frvalda instllningar.
 .P
 vriga filer som listas hr finns i sina frvalda kataloger, se flaggan
 \fB--admindir\fP fr information om hur du ndrar placeringen av dessa
 filer.
 .TP
-.I /var/lib/dpkg/available
+.I @PREFIX@/var/lib/dpkg/available
 Lista ver tillgngliga paket.
 .TP
-.I /var/lib/dpkg/status
+.I @PREFIX@/var/lib/dpkg/status
 Status fr tillgngliga paket.
 Denna fil innehller information om huruvida ett paket r markerat fr
 borttagning eller ej, om det r installerat eller ej, osv.
@@ -555,14 +555,14 @@
 \fB     dpkg -l '*vi*'\fP
 .br
 
-Fr att se posterna i \fI/var/lib/dpkg/available\fP fr tv paket:
+Fr att se posterna i \fI@PREFIX@/var/lib/dpkg/available\fP fr tv paket:
 .br
 \fB     dpkg --print-avail elvis vim | less\fP
 .br
 
 Fr att sjlv ska i paketlistan:
 .br
-\fB     less /var/lib/dpkg/available\fP
+\fB     less @PREFIX@/var/lib/dpkg/available\fP
 .br
 
 Fr att ta bort det installerade paketet elvis:
@@ -609,6 +609,7 @@
 
 .SH FRFATTARE
 .nf
-Se filen \fB/usr/share/doc/dpkg/THANKS\fP fr en lista ver personer som
+Se filen \fB@PREFIX@/share/doc/dpkg/THANKS\fP fr en lista ver personer som
 bidragit till \fBdpkg\fP .
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
 .fi
diff -urN dpkg-1.10.21.orig/man/sv/dpkg.cfg.5 dpkg-1.10.21/man/sv/dpkg.cfg.5
--- dpkg-1.10.21.orig/man/sv/dpkg.cfg.5	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/sv/dpkg.cfg.5	2012-07-13 02:13:27.000000000 +0200
@@ -10,10 +10,11 @@
 Kommentarer r tilltna genom att inleda en rad med nummertecken
 ("\fB#\fR").
 .SH FILER
-.I /etc/dpkg/dpkg.cfg
+.I @PREFIX@/etc/dpkg/dpkg.cfg
 ~/.dpkg.cfg
 .SH FRFATTARE
-Se \fB/usr/share/doc/dpkg/THANKS\fP fr listan ver personer som har
+Se \fB@PREFIX@/share/doc/dpkg/THANKS\fP fr listan ver personer som har
 bidragit till \fBdpkg\fP .
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
 .SH SE VEN
 .BR dpkg (8)
diff -urN dpkg-1.10.21.orig/man/sv/dselect.8 dpkg-1.10.21/man/sv/dselect.8
--- dpkg-1.10.21.orig/man/sv/dselect.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/sv/dselect.8	2012-07-13 02:13:27.000000000 +0200
@@ -39,7 +39,7 @@
 programmet.
 .SH FLAGGOR
 Alla flaggorna kan ges bde p kommandoraden och i \fBdselect\fPs
-konfigurationsfil \fI/etc/dpkg/dselect.cfg\fP.
+konfigurationsfil \fI@PREFIX@/etc/dpkg/dselect.cfg\fP.
 En rad i konfigurationsfilen r antingen en flagga (precis samma som p
 kommandoraden, men utan inledande bindestreck) eller en kommentar (om den
 brjar med ett \fB#\fR).
@@ -48,7 +48,7 @@
 .B --admindir <katalog>
 ndrar namnet p katalogen dr dpkg letar efter filerna "status", "available"
 m.fl.
-Frval r \fI/var/lib/dpkg\fP
+Frval r \fI@PREFIX@/var/lib/dpkg\fP
 och du br normalt sett inte behva ndra det.
 .TP
 .B --debug <fil> | -D<fil>
@@ -465,3 +465,6 @@
 Josip Rodin och Joost Kooij.
 .br
 Dselect, och denna manualsida, r versatt av Peter Karlsson.
+.br
+Paths modified by Carsten Klapp to reflect fink distribution,
+December 2002.
diff -urN dpkg-1.10.21.orig/man/sv/dselect.cfg.5 dpkg-1.10.21/man/sv/dselect.cfg.5
--- dpkg-1.10.21.orig/man/sv/dselect.cfg.5	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/man/sv/dselect.cfg.5	2012-07-13 02:13:27.000000000 +0200
@@ -10,10 +10,11 @@
 Kommentarer r tilltna genom att inleda en rad med nummertecken
 ("\fB#\fR").
 .SH FILER
-.I /etc/dpkg/dselect.cfg
+.I @PREFIX@/etc/dpkg/dselect.cfg
 ~/.dselect.cfg
 .SH FRFATTARE
-Se \fB/usr/share/doc/dpkg/THANKS\fP fr listan ver personer som har
+Se \fB@PREFIX@/share/doc/dpkg/THANKS\fP fr listan ver personer som har
 bidragit till \fBdselect\fP .
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
 .SH SE VEN
 .BR dselect (8)
diff -urN dpkg-1.10.21.orig/origin.fink dpkg-1.10.21/origin.fink
--- dpkg-1.10.21.orig/origin.fink	1970-01-01 01:00:00.000000000 +0100
+++ dpkg-1.10.21/origin.fink	2012-07-13 02:13:27.000000000 +0200
@@ -0,0 +1,3 @@
+Vendor: Fink
+Vendor-URL: http://fink.sourceforge.net/
+Bugs: http://fink.sourceforge.net/
diff -urN dpkg-1.10.21.orig/scripts/cleanup-info.8 dpkg-1.10.21/scripts/cleanup-info.8
--- dpkg-1.10.21.orig/scripts/cleanup-info.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/scripts/cleanup-info.8	2012-07-13 02:13:27.000000000 +0200
@@ -34,7 +34,7 @@
 Output version and exit successfully.
 .SH FILES
 .TP
-.I "/usr/info/dir or <dirname>/dir"
+.I "@PREFIX@/share/info/dir or <dirname>/dir"
 The info directory file. The lock file is named the same, with ".lock" suffix.
 .SH BUGS
 Probably many.
@@ -43,6 +43,7 @@
 .BR info (1).
 .SH AUTHOR
 Copyright (C) 1996 Kim-Minh Kaplan.
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
 .sp
 This is free software; see the GNU General Public Licence
 version 2 or later for copying conditions.  There is NO warranty.
diff -urN dpkg-1.10.21.orig/scripts/dpkg-divert.8 dpkg-1.10.21/scripts/dpkg-divert.8
--- dpkg-1.10.21.orig/scripts/dpkg-divert.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/scripts/dpkg-divert.8	2012-07-13 02:13:27.000000000 +0200
@@ -37,7 +37,7 @@
 .SH OPTIONS
 .TP
 .I --admindir <directory>
-Set the dpkg data directory to <directory> (default: /var/lib/dpkg).
+Set the dpkg data directory to <directory> (default: @PREFIX@/var/lib/dpkg).
 .TP
 .I --divert <divert-to>
 <divert-to> is the name used by other packages' versions.
@@ -76,7 +76,7 @@
 pointing at the diverted library.
 .SH FILES
 .TP
-.I /var/lib/dpkg/diversions
+.I @PREFIX@/var/lib/dpkg/diversions
 File which contains the current list of diversions of the system. It is
 located in the dpkg administration directory, along with other files
 important to dpkg, such as `status' or `available'.
@@ -90,6 +90,7 @@
 overriding a package's version of a file" for more information.
 .SH AUTHOR
 Copyright (C) 1995 Ian Jackson.
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
 .sp
 This is free software; see the GNU General Public Licence
 version 2 or later for copying conditions.  There is NO warranty.
diff -urN dpkg-1.10.21.orig/scripts/dpkg-name.sh dpkg-1.10.21/scripts/dpkg-name.sh
--- dpkg-1.10.21.orig/scripts/dpkg-name.sh	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/scripts/dpkg-name.sh	2012-07-13 02:13:27.000000000 +0200
@@ -10,6 +10,7 @@
 license () {
 echo "# ${prog} ${version} -- ${purpose}
 # Copyright (C) 1995,1996 Erick Branderhorst <branderh@debian.org>.
+# Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
 
 # This is free software; you can redistribute it and/or modify it
 # under the terms of the GNU General Public License as published by the
@@ -19,7 +20,7 @@
 # This is distributed in the hope that it will be useful, but
 # WITHOUT ANY WARRANTY; without even the implied warranty of
 # MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the file
-# /usr/share/common-licenses/GPL for more details."
+# @PREFIX@/share/common-licenses/GPL for more details."
 }
 
 stderr () {
diff -urN dpkg-1.10.21.orig/scripts/dpkg-scanpackages.8 dpkg-1.10.21/scripts/dpkg-scanpackages.8
--- dpkg-1.10.21.orig/scripts/dpkg-scanpackages.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/scripts/dpkg-scanpackages.8	2012-07-13 02:13:27.000000000 +0200
@@ -41,7 +41,7 @@
 .PP
 .I binarydir
 is the name of the binary tree to process (for example,
-.BR contrib/binary-i386 ).
+.BR main/binary-darwin-powerpc ).
 It is best to make this relative to the root of the Debian archive,
 because every Filename field in the new Packages file will start with
 this string.
@@ -114,4 +114,6 @@
 .SH SEE ALSO
 .BR dpkg (8),
 .BR dselect (8),
-.BR dpkg-scansources (8).
\ No newline at end of file
+.BR dpkg-scansources (8).
+.SH AUTHOR
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
diff -urN dpkg-1.10.21.orig/scripts/dpkg-source.1 dpkg-1.10.21/scripts/dpkg-source.1
--- dpkg-1.10.21.orig/scripts/dpkg-source.1	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/scripts/dpkg-source.1	2012-07-13 02:13:27.000000000 +0200
@@ -806,6 +806,7 @@
 .BR pgp (1).
 .SH AUTHOR
 The utilities and this manpage were written by Ian Jackson.
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
 .SH COPYRIGHT
 Copyright (C) 1995-1996 Ian Jackson
 .br
@@ -813,7 +814,7 @@
 .br
 This is free software; see the GNU General Public Licence version 2 or later
 for copying conditions. There is NO WARRANTY.  See
-.B /usr/share/doc/dpkg/copyright
+.B @PREFIX@/share/doc/dpkg/copyright
 and
-.B /usr/share/common-licenses/GPL
+.B @PREFIX@/share/common-licenses/GPL
 for details.
diff -urN dpkg-1.10.21.orig/scripts/dpkg-statoverride.8 dpkg-1.10.21/scripts/dpkg-statoverride.8
--- dpkg-1.10.21.orig/scripts/dpkg-statoverride.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/scripts/dpkg-statoverride.8	2012-07-13 02:13:27.000000000 +0200
@@ -51,10 +51,10 @@
 .TP
 .I --admindir
 Change the directory of the dpkg database where the statoverride file is
-also stored. Defaults to /var/lib/dpkg.
+also stored. Defaults to @PREFIX@/var/lib/dpkg.
 .SH FILES
 .TP
-.I /var/lib/dpkg/statoverride
+.I @PREFIX@/var/lib/dpkg/statoverride
 File which contains the current list of stat overrides of the system. It
 is located in the dpkg administration directory, along with other files
 important to dpkg, such as `status' or `available'.
@@ -68,6 +68,7 @@
 .UR mailto:wakkerma@debian.org
 <wakkerma@debian.org>
 .UE
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
 .sp
 This is free software; see the GNU General Public Licence version 2 or
 later for copying conditions.  There is NO warranty.
diff -urN dpkg-1.10.21.orig/scripts/install-info.8 dpkg-1.10.21/scripts/install-info.8
--- dpkg-1.10.21.orig/scripts/install-info.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/scripts/install-info.8	2012-07-13 02:13:27.000000000 +0200
@@ -156,7 +156,7 @@
 be located in
 .IR infodir .
 The default is
-.BR /usr/info .
+.BR @PREFIX@/share/info .
 .TP
 .BI \-\-align= nnn " [deprecated]"
 Specifies that the first line of the description should be indented at
@@ -266,6 +266,8 @@
 processing steps are shown.
 .SH "SEE ALSO"
 emacs(1), info(1), gzip(1)
+.SH AUTHOR
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
 .SH COPYRIGHT
 Copyright 1994, Ian Jackson.
 .B install\-info
diff -urN dpkg-1.10.21.orig/scripts/install-info.pl dpkg-1.10.21/scripts/install-info.pl
--- dpkg-1.10.21.orig/scripts/install-info.pl	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/scripts/install-info.pl	2012-07-13 02:13:27.000000000 +0200
@@ -29,11 +29,11 @@
 END
 }
 
-$infodir='/usr/share/info';
+$infodir='@PREFIX@/share/info';
 $maxwidth=79;
 $Text::Wrap::columns=$maxwidth;
-$backup='/var/backups/infodir.bak';
-$default='/usr/share/base-files/info.dir';
+$backup='@PREFIX@/share/info/dir.bak';
+$default='@PREFIX@/share/base-files/dir-base';
 
 $menuentry="";
 $description="";
diff -urN dpkg-1.10.21.orig/scripts/update-alternatives.8 dpkg-1.10.21/scripts/update-alternatives.8
--- dpkg-1.10.21.orig/scripts/update-alternatives.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/scripts/update-alternatives.8	2012-07-13 02:13:27.000000000 +0200
@@ -4,7 +4,7 @@
 .\" it under the terms of the GNU General Public License as published
 .\" by the Free Software Foundation; either version 2 of the License, or
 .\" (at your option) any later version.  There is NO WARRANTY.  You can
-.\" find the GNU GPL in /usr/share/common-licenses/GPL on any Debian system.
+.\" find the GNU GPL in @PREFIX@/share/common-licenses/GPL on any Debian system.
 .TH UPDATE-ALTERNATIVES 8 "19 January 1998" "Debian Project" "dpkg utilities"
 .SH NAME
 update-alternatives \- maintain symbolic links determining default commands
@@ -79,13 +79,13 @@
 .BR nvi (1)
 are both installed on the system, the alternatives system will cause
 the generic name
-.I /usr/bin/editor
+.I @PREFIX@/bin/editor
 to refer to
-.I /usr/bin/nvi
+.I @PREFIX@/bin/nvi
 by default.  The system administrator can override this and cause
 it
 to refer to
-.I /usr/bin/ed
+.I @PREFIX@/bin/ed
 instead,
 and the alternatives system will not alter this setting until explicitly
 requested to do so.
@@ -97,7 +97,7 @@
 which in turn is a symbolic link to the actual file referenced.
 This is done so that the system administrator's changes can be confined
 within the
-.I /etc
+.I @PREFIX@/etc
 directory: the FHS (q.v.) gives reasons why this is a Good Thing.
 .PP
 When each package
@@ -117,9 +117,9 @@
 of the
 .BR vi (1)
 editor are installed, the man page referenced by
-.I /usr/share/man/man1/vi.1
+.I @PREFIX@/share/man/man1/vi.1
 should correspond to the executable referenced by
-.IR /usr/bin/vi .
+.IR @PREFIX@/bin/vi .
 .B update-alternatives
 handles this by means of
 .I master
@@ -182,7 +182,7 @@
 .TP
 generic name
 A name, like
-.IR /usr/bin/editor ,
+.IR @PREFIX@/bin/editor ,
 which refers, via the alternatives system, to one of a number of
 files of similar function.
 .TP
@@ -197,12 +197,12 @@
 .TP
 alternatives directory
 A directory, by default
-.IR /etc/alternatives ,
+.IR @PREFIX@/etc/alternatives ,
 containing the symlinks.
 .TP
 administrative directory
 A directory, by default
-.IR /var/lib/dpkg/alternatives ,
+.IR @PREFIX@/var/lib/dpkg/alternatives ,
 containing
 .BR update-alternatives '
 state information.
@@ -401,13 +401,13 @@
 mode.
 .SH FILES
 .TP
-.I /etc/alternatives/
+.I @PREFIX@/etc/alternatives/
 The default alternatives directory.
 Can be overridden by the
 .B --altdir
 option.
 .TP
-.I /var/lib/dpkg/alternatives/
+.I @PREFIX@/var/lib/dpkg/alternatives/
 The default administration directory.
 Can be overridden by the
 .B --admindir
@@ -439,12 +439,13 @@
 Debian update-alternatives is copyright 1995
 Ian Jackson.  It is free software; see the GNU General Public Licence
 version 2 or later for copying conditions.  There is NO warranty.
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
 .PP
 This manual page is copyright 1997/98 Charles Briscoe-Smith.
 This is free documentation; see the GNU General Public Licence
 version 2 or later for copying conditions.  There is NO WARRANTY.
 .PP
-You can find the GNU GPL in /usr/share/common-licenses/GPL on any Debian system.
+You can find the GNU GPL in @PREFIX@/share/common-licenses/GPL on any Debian system.
 .SH "SEE ALSO"
 .BR ln (1),
 FHS, the Filesystem Hierarchy Standard.
diff -urN dpkg-1.10.21.orig/scripts/update-alternatives.pl dpkg-1.10.21/scripts/update-alternatives.pl
--- dpkg-1.10.21.orig/scripts/update-alternatives.pl	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/scripts/update-alternatives.pl	2012-07-13 02:13:27.000000000 +0200
@@ -59,7 +59,7 @@
 sub quit { print STDERR "update-alternatives: @_\n"; exit(2); }
 sub badusage { print STDERR "update-alternatives: @_\n\n"; &usageversion; exit(2); }
 
-$altdir= '/etc/alternatives';
+$altdir= '@PREFIX@/etc/alternatives';
 $admindir= $admindir . '/alternatives';
 $testmode= 0;
 $verbosemode= 0;
diff -urN dpkg-1.10.21.orig/split/Makefile.in dpkg-1.10.21/split/Makefile.in
--- dpkg-1.10.21.orig/split/Makefile.in	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/split/Makefile.in	2012-07-13 02:13:27.000000000 +0200
@@ -42,7 +42,7 @@
 	$(INSTALL_DATA) $(srcdir)/dpkg-split.8 $(DESTDIR)/$(man8dir)
 
 dpkg-split: $(SPLIT_OBJECTS) 
-	$(CC) $(LDFLAGS) -o $@ $(SPLIT_OBJECTS) $(LIBS) $(NLS_LIBS)
+	$(CC) $(LDFLAGS) $(EXEFLAGS) -o $@ $(SPLIT_OBJECTS) $(LIBS) $(NLS_LIBS)
 
 split.o: split.c
 	$(CC) $(ALL_CFLAGS) -DMKSPLITSCRIPT=\"$(dpkglibdir)/mksplit\" -c $<
diff -urN dpkg-1.10.21.orig/split/dpkg-split.8 dpkg-1.10.21/split/dpkg-split.8
--- dpkg-1.10.21.orig/split/dpkg-split.8	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/split/dpkg-split.8	2012-07-13 02:13:27.000000000 +0200
@@ -162,7 +162,7 @@
 .BI --depotdir " directory"
 Specifies an alternative directory for the queue of parts awaiting
 automatic reassembly.  The default is
-.BR /var/lib/dpkg .
+.BR @PREFIX@/var/lib/dpkg .
 .TP
 .BI --partsize\fR|\fB-S " kbytes"
 Specifies the maximum part size when splitting, in kilobytes (1024
@@ -234,7 +234,7 @@
 is not present in the filenames generated.
 .SH FILES
 .TP
-.B /var/lib/dpkg/parts
+.B @PREFIX@/var/lib/dpkg/parts
 The default queue directory for part files awaiting automatic
 reassembly.
 
@@ -253,7 +253,8 @@
 Copyright (C) 1995-1996
 by him and released under the GNU General Public Licence; there is NO
 WARRANTY.  See
-.B /usr/share/dpkg/copyright
+.B @PREFIX@/share/dpkg/copyright
 and
-.B /usr/share/common-licenses/GPL
+.B @PREFIX@/share/common-licenses/GPL
 for details.
+Paths modified by Carsten Klapp to reflect fink distribution, December 2002.
diff -urN dpkg-1.10.21.orig/utils/Makefile.in dpkg-1.10.21/utils/Makefile.in
--- dpkg-1.10.21.orig/utils/Makefile.in	2012-07-13 02:12:44.000000000 +0200
+++ dpkg-1.10.21/utils/Makefile.in	2012-07-13 02:13:27.000000000 +0200
@@ -72,9 +72,9 @@
 	$(INSTALL_DATA) $(srcdir)/$(MD5_MANPAGES) $(DESTDIR)/$(man1dir)
 
 start-stop-daemon: $(SSD_OBJECTS) ../lib/libdpkg.a
-	$(CC) $(LDFLAGS) -o $@ $(SSD_OBJECTS) $(LIBS) $(SSD_LIBS)
+	$(CC) $(LDFLAGS) $(EXEFLAGS) -o $@ $(SSD_OBJECTS) $(LIBS) $(SSD_LIBS)
 
 md5sum-static: LDFLAGS += -static
 md5sum-static: ZLIB_LIBS = $(ZLIBS_LIBS_ALSO_STATIC)
 md5sum md5sum-static: $(MD5_OBJECTS) ../lib/libdpkg.a
-	$(CC) $(LDFLAGS) -o $@ $(MD5_OBJECTS) $(LIBS) $(NLS_LIBS)
+	$(CC) $(LDFLAGS) $(EXEFLAGS) -o $@ $(MD5_OBJECTS) $(LIBS) $(NLS_LIBS)
