Package: dpkg
Version: 1.13.18
Revision: 11
Description: The Debian package manager
License: GPL
Maintainer: Fink Core Group <fink-core@lists.sourceforge.net>

Depends: gettext, libiconv, gzip, tar
Essential: yes
GCC: 3.3

Source: http://debian.ethz.ch/debian/pool/main/d/%n/%n_%v.tar.gz
Source2: http://alioth.debian.org/download.php/1556/po4a-0.25.tar.gz
SourceDirectory: dpkg-%v
Source-MD5: eb8353d0adfb4231fc4b40225a32758e
Source2-MD5: e868a14e5e5212d1e1d78e0905f01fe5
PatchScript: <<
	#!/bin/sh -ev
	sed 's|@PREFIX@|%p|g' <%a/dpkg.patch | patch -p0
	find man -type f | xargs perl -pi -e 's,/usr,%p,g; s,/var,%p/var,g; s,/etc,%p/etc,g;'
	ls scripts/*.pl* scripts/*.sh | xargs perl -i -pe 's,([\047`"])/(etc|var),$1%p/$2,g; s,([\047`"])/usr,$1/%p,g; s,([\047`"])(dpkg[\w-]*|822-date|md5sum|gpg)([\s\047`"]),$1%p/bin/$2$3,g'
<<

SetCFLAGS: -I%p/include
SetCPPFLAGS: -fconstant-cfstrings
SetLDFLAGS: -Wl,-framework,CoreFoundation
ConfigureParams: --without-start-stop-daemon --without-sgml-doc --with-admindir=%p/var/lib/dpkg --mandir=%p/share/man --infodir=%p/share/info --srcdir=%b --disable-linker-optimisations --without-dselect
CompileScript: <<
#!/bin/sh -ev

	%p/bin/fink -y install gettext-bin gettext-dev gettext-tools libiconv-dev
	export PERL5LIB=`pwd`/../po4a-0.25/lib:"$PERL5LIB"
	export PATH=`pwd`/../po4a-0.25:"$PATH"
	chmod a+x ../po4a-0.25/po4a*
	mv getopt/obstack.* lib/
	PERL=/usr/bin/perl ./configure --build=%m-apple-darwin %c
	make
<<

InstallScript: <<
#!/bin/sh -ev

	export PERL5LIB=`pwd`/../po4a-0.25/lib:"$PERL5LIB"
	export PATH=`pwd`/../po4a-0.25:"$PATH"
	chmod a+x ../po4a-0.25/po4a*
	mkdir -p %i/share/doc/dpkg
	make install DESTDIR=%d
	for lang in de es ja sv; do
		install -d -m 755 %i/share/man/$lang/man1
		install -c -m 644 man/$lang/md5sum.1 %i/share/man/$lang/man1/
	done
	install -d -m 755 %i/var/backups
	rm -rf %i/lib/dpkg/methods/*
<<

PostInstScript: <<
if [ ! -f %p/var/lib/dpkg/diversions ]; then
  touch %p/var/lib/dpkg/diversions
  chmod 644 %p/var/lib/dpkg/diversions
fi
<<

Homepage: http://packages.qa.debian.org/d/dpkg.html
DescDetail: <<
dpkg installs and removes binary packages; it is the base of the
distribution. This package also contains some helper programs and
dselect, a full-screen console frontend to dpkg.
<<
DescPort: <<
1.13.18
- forward-ported changes to 1.13.18

1.13.16
- forward-ported changes to 1.13.16
- remove dselect and curses dependency (will be split into another pkg)
- remove the getopt stuff (except for obstack, move that to lib)
- ignore Fink-owned fields
- use search-and-replace for scripts and man prefix patching

1.13.11
- forward-ported changes to 1.13.11
  - md5sum was removed, had to be re-added
  - getopt was needed, but not automatically included, so had to be added to the Makefile.in's

1.10.9 
- Removed --without-zlib flag
- Gets confused about top_srcdir without the --srcdir arg.
- Fixed bug with BR manpage
- Patched update-rc.d out of the app check code, not needed on OS X.

Pre-Jaguar: Needed fixes to use the right architecture, disable code that uses
unimplemented functions on Darwin and other stuff.

Added code to support the pseudo package 'macosx' and 'darwin'.

Fix to install-info script to prevent a certain problem with section titles.

Patched to run 'fink-virtual-pkgs' to see what packages we have outside of $prefix.

Patched to suppress warning about BuildDependsOnly control field.

Previous versions by Christoph Pfisterer.

Patched to not remove Darwin's system-critical symlinks (/etc /tmp /var)

Patched to hardcode complete paths to our component executables
instead of relying on PATH
<<

